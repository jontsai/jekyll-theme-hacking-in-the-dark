YUI.add("gallery-composite-image-canvas",function(e,t){(function(e){"use strict";var t=255,n="height",r="width",i=e.Array,s=e.namespace("Composite").Image,o=Math,u=s.dataTypes,a=u.f32,f=u.f64,l=u.s16,c=u.s32,h=u.s8,p=u.u16,d=u.u32,v=u.u8,m=s.prototype,g=e.cached,y=e.Node.create,b=i.each,w=Math.floor,E=s.prototype._init,S=o.max,x=o.min,T=e.one,N=o.round;m._init=function(){var e,t,n=this;E.apply(n,arguments),e=n.channels.length===4&&n.dimensions.length===2,e&&(t=n._dataType,n._convertFromU8=s._getConvertFromU8Method(t),n._convertToU8=s._getConvertToU8Method(t),n._fromImageData=s._getFromImageDataMethod(t),n._toImageData=s._getToImageDataMethod(t)),n.supportsCanvas=e},m.fromCanvas=function(e){var t=this,i,o=t.dimensions;return e=T(e),i=e&&s._getContext(e),t.supportsCanvas&&i&&e.get(n)===o[1]&&e.get(r)===o[0]?t._fromImageData(s._getImageData(i)):t},m.toCanvas=function(e){var t,n=this.dimensions;return e=T(e)||y('<canvas height="'+n[1]+'" width="'+n[0]+'"></canvas>'),t=s._getContext(e),t.putImageData(this._toImageData(s._getImageData(t)),0,0),e},s.fromCanvas=function(e){return e=T(e),e?new s({channels:[v,v,v,v],data:s._getImageData(s._getContext(e)).data.buffer,dimensions:[e.get(r),e.get(n)]}):null},s._getContext=function(e){return e.getDOMNode().getContext("2d")},s._getConvertFromU8Method=g(function(e){switch(e){case a:case f:return function(e){return e/t};case l:case c:case p:case d:case v:return function(e){return e};case h:return function(e){return w(e/2)}}return function(e,t){return t in u?s._getConvertFromU8Method(t)(e):0}}),s._getConvertToU8Method=g(function(e){switch(e){case a:case f:return function(e){return S(0,x(t,N(e*t)))};case l:case c:return function(e){return S(0,x(t,e))};case h:return function(e){return S(0,N(e*t/127))};case p:case d:return function(e){return x(t,e)};case v:return function(e){return e}}return function(e,t){return t in u?s._getConvertToU8Method(t)(e):0}}),s._getFromImageDataMethod=g(function(e){return e?e===v?function(e){return this._data=e.data,this}:function(e){var t=this,n=t._dataView;return b(e.data,function(e,r){n[r]=t._convertFromU8(e)}),t}:function(e){var t=e.data,n=this,r=n.channels,i=n.channels.length;return n.eachPixelIndex(function(e){b(r,function(r,s){n._setValue(e,s,n._convertFromU8(t[e*i+s],r))})})}}),s._getImageData=function(e){var t=e.canvas;return e.getImageData(0,0,t.width,t.height)},s._getToImageDataMethod=g(function(e){return e?e===v?function(e){return e.data.set(this._dataView),e}:function(e){var t=e.data,n=this;return b(n._dataView,function(e,r){t[r]=n._convertToU8(e)}),e}:function(e){var t=e.data,n=this,r=n.channels,i=n.channels.length;return n.eachPixelIndex(function(e){b(r,function(r,s){t[e*i+s]=n._convertToU8(n._getValue(e,s),r)})}),e}})})(e)},"gallery-2013.05.29-23-38",{requires:["gallery-composite-image","node-base"]});
