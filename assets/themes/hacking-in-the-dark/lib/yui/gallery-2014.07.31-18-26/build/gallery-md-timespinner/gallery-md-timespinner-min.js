YUI.add("gallery-md-timespinner",function(e,t){"use strict";var n=e.Spinner,r=e.Lang,i="contentBox",s="boundingBox",o="Change",u="value",a="ui",f="showAmPm",l="interval",c="showSeconds",h="running",p="after",d="wrapped",v="hours",m="minutes",g="seconds",y="ampm";e.TimeSpinner=e.Base.create("timeSpinner",e.Widget,[e.MakeNode],{_hourSp:null,_minSp:null,_secSp:null,_ampmSp:null,_timer:null,_offset:0,_frozenTime:0,_spFact:function(t,r,i){var o=(new n(e.merge({min:0,max:59,wraparound:!0,"strings.input":this.get("strings."+t)},r))).render(i);return o.get(s).addClass(this._classNames[t]),o},renderUI:function(){var e=this.get(i);this._hourSp=this._spFact(v,this.get(f)?{min:1,max:12}:{max:23},e),this._minSp=this._spFact(m,null,e)},bindUI:function(){this._eventHandles=[this._hourSp.after(u+o,this._afterValueChange,this),this._minSp.after(u+o,this._afterValueChange,this),this._minSp.after(d,this._afterWrapped,this)]},destroy:function(){this._timer&&this._timer.cancel(),e.each([].concat(this._eventHandles,this._secondsEventHandles,this._ampmEventHandle),function(e){e&&e.detach()}),e.TimeSpinner.superclass.destroy.call(this)},_uiSetShowSeconds:function(t){t?(this._secSp=this._spFact(g,{value:this.get(u).getSeconds()}),this._minSp.get(s).insert(this._secSp.get(s),p),this._secondsEventHandles=[this._secSp.after(u+o,this._afterValueChange,this),this._secSp.after(d,this._afterWrapped,this)]):this._secSp&&this._secSp&&(e.each(this._secondsEventHandles,function(e){e.detach()}),this._secSp.destroy(),this._secSp=null)},_uiSetShowAmPm:function(e){e?(this._ampmSp=this._spFact(y,{max:1,formatter:function(e){return e?"PM":"AM"},parser:function(e){switch(e.toUpperCase()){case"AM":return 0;case"PM":return 1;default:return!1}}}),(this._secSp?this._secSp.get(s):this._minSp.get(s)).insert(this._ampmSp.get(s),p),this._ampmEventHandle=this._ampmSp.after(u+o,this._afterValueChange,this),this._hourSp.setAttrs({max:12,min:1}),this._uiSetValue(this.get(u))):(this._hourSp.setAttrs({max:23,min:0}),this._ampmSp&&(this._ampmEventHandle.detach(),this._ampmSp.destroy(),this._ampmSp=null))},_uiSetValue:function(e,t){if(t===a)return;this._setting=!0;var n=e.getHours();this._ampmSp?(this._hourSp.set(u,n%12||12),this._ampmSp.set(u,n>=12?1:0)):this._hourSp.set(u,n),this._minSp.set(u,e.getMinutes()),this._secSp&&this._secSp.set(u,e.getSeconds()),this._setting=!1},_uiSetInterval:function(t){this._timer&&this._timer.cancel(),t&&(this._timer=e.later(t,this,this._updateTime,[],!0))},_uiSetRunning:function(e){this._uiSetInterval(e&&this.get(l)),this._frozenTime=Date.now()},_afterValueChange:function(){if(this._setting)return;var e=new Date;e.setHours((this._hourSp.get(u)+(this._ampmSp?12*this._ampmSp.get(u):0))%24),e.setMinutes(this._minSp.get(u)),e.setSeconds(this._secSp?this._secSp.get(u):0),this.set(u,e,{src:a})},_afterWrapped:function(e){var t=e.newVal>e.prevVal?-1:1;e.target===this._secSp&&this._minSp.set(u,this._minSp.get(u)+t),e.target===this._minSp&&this._hourSp.set(u,this._hourSp.get(u)+t)},_updateTime:function(){this._uiSetValue(this._getTime())},_getTime:function(){return this.get(h)?new Date(Date.now()-this._offset):new Date(this._frozenTime-this._offset)},_setTime:function(e){return this._offset=Date.now()-e.getTime(),e},start:function(){this.set(h,!0)},stop:function(){this.set(h,!1)}},{_CLASS_NAMES:[v,m,g,y],ATTRS:{showAmPm:{value:!1,validator:r.isBoolean},showSeconds:{value:!0,validator:r.isBoolean},value:{valueFn:function(){return new Date},validator:function(e){return e instanceof Date},getter:"_getTime",setter:"_setTime"},interval:{value:500,validator:r.isNumber},running:{value:!0,validator:r.isBoolean},strings:{value:{hours:v,minutes:m,seconds:g,ampm:"am/pm"}}},_ATTRS_2_UI:{BIND:[l,h,f,c,u],SYNC:[l,h,f,c,u]}})},"gallery-2013.01.23-21-59",{requires:["gallery-md-spinner","gallery-makenode"]});
