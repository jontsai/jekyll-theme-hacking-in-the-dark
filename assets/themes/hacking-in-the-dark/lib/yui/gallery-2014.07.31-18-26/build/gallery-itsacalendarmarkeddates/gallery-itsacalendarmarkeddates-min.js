YUI.add("gallery-itsacalendarmarkeddates",function(e,t){"use strict";function b(){}var n=e.Lang,r=e.DataType.Date,i=e.Object,s=e.Array.each,o=i.each,u=i.hasKey,a=e.ClassNameManager.getClassName,f="calendar",l="itsa",c=a(l,"markeddate"),h=a(f,l,"markeddates"),p=function(e){return new Date(e.getTime())},d=function(e,t){t.setTime(e.getTime())},v=function(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},m=function(e,t){return r.isGreater(e,t)&&!v(e,t)},g=function(e,t){e.setTime(e.getTime()+864e5*t)},y=function(e,t){var n=e.getFullYear(),r=e.getMonth()+t;n=Math.floor(n+r/12),r=(r%12+12)%12,e.setFullYear(n),e.setMonth(r)};e.mix(b.prototype,{initializer:function(){var e=this;e._markedDates={},e.get("boundingBox").addClass(h),e.after("render",function(){e._renderMarkedDates(),e._fireMarkEvent=e.after(["dateChange","markChange"],e._renderMarkedDates)})},destructor:function(){var e=this;e._fireMarkEvent&&e._fireMarkEvent.detach()},getMarkedDates:function(e,t){var i=this,o=i._markedDates,u=[],a,f,l,c;if(n.isArray(e))s(e,function(e){r.isValidDate(e)&&(a=e.getFullYear(),f=e.getMonth(),l=e.getDate(),o[a]&&o[a][f]&&o[a][f][l]&&u.push(p(e)))});else if(r.isValidDate(e)){if(!r.isValidDate(t)||m(e,t))t=p(e);c=new Date(e.getTime());do a=c.getFullYear(),f=c.getMonth(),l=c.getDate(),o[a]&&o[a][f]&&o[a][f][l]&&u.push(p(c)),g(c,1);while(!m(c,t))}return u},getMarkedDatesInWeek:function(e){var t=this,n=e.getDay(),r=p(e),i=p(e);return g(r,-n),g(i,6-n),t.getMarkedDates(r,i)},getMarkedDatesInMonth:function(e){var t=this,n=p(e),i=r.addMonths(e,1);return n.setDate(1),i.setDate(1),g(i,-1),t.getMarkedDates(n,i)},getMarkedDatesInYear:function(e){var t=this,n=new Date(e,0,1),r=new Date(e,11,31);return t.getMarkedDates(n,r)},dateIsMarked:function(e){var t=this,n=t._markedDates,r=e.getFullYear(),i=e.getMonth(),s=e.getDate(),o=n[r]&&n[r][i]&&n[r][i][s]?!0:!1;return o},markDates:function(e){var t=this;return r.isValidDate(e)?t._addDateToMarked(e):n.isArray(e)&&this._addDatesToMarked(e),t},unmarkDates:function(e){var t=this;return e?r.isValidDate(e)?t._removeDateFromMarked(e):n.isArray(e)&&t._removeDatesFromMarked(e):t.clearMarkedDates(),t},clearMarkedDates:function(e){var t=this,n;return t._markedDates={},e?t.get("contentBox").all("."+c).removeClass(c):(n=t._getMarkedDatesList(),t._fireMarkChange(n)),t},_fireMarkChange:function(e){var t=this;t.fire("markChange",{newVal:t._getMarkedDatesList(),prevVal:e})},_getMarkedDatesList:function(){var e=this,t=[];return o(e._markedDates,function(n){o(n,function(n){o(n,function(e){t.push(e)},e)},e)},e),t},_addDateToMarked:function(e,t){var i=this,s=e.getFullYear(),o=e.getMonth(),a=e.getDate(),f;!r.isValidDate(e)||(n.isValue(t)||(f=i._getMarkedDatesList()),u(i._markedDates,s)?u(i._markedDates[s],o)?i._markedDates[s][o][a]=p(e):(i._markedDates[s][o]={},i._markedDates[s][o][a]=p(e)):(i._markedDates[s]={},i._markedDates[s][o]={},i._markedDates[s][o][a]=p(e)),n.isValue(t)||i._fireMarkChange(f))},_addDatesToMarked:function(e){var t=this,n=t._getMarkedDatesList();s(e,t._addDateToMarked,t),t._fireMarkChange(n)},_addDateRangeToMarked:function(e,t){var n=this,r=(t.getTimezoneOffset()-e.getTimezoneOffset())*6e4,i=e.getTime(),s=t.getTime(),o=n._getMarkedDatesList(),u,a,f;i>s?(u=i,i=s,s=u+r):s-=r;for(a=i;a<=s;a+=864e5)f=new Date(a),f.setHours(12),n._addDateToMarked(f);n._fireMarkChange(o)},_removeDateFromMarked:function(e,t){var i=this,s=e.getFullYear(),o=e.getMonth(),a=e.getDate(),f;!r.isValidDate(e)||u(i._markedDates,s)&&u(i._markedDates[s],o)&&u(i._markedDates[s][o],a)&&(n.isValue(t)?delete i._markedDates[s][o][a]:(f=i._getMarkedDatesList(),delete i._markedDates[s][o][a],i._fireMarkChange(f)))},_removeDatesFromMarked:function(e){var t=this,n=t._getMarkedDatesList();s(e,t._removeDateFromMarked,t),t._fireMarkChange(n)},_removeDateRangeFromMarked:function(e,t){var n=this,r=e.getTime(),i=t.getTime(),s=n._getMarkedDatesList(),o;for(o=r;o<=i;o+=864e5)n._removeDateFromMarked(new Date(o));n._fireMarkChange(s)},_renderMarkedDates:function(){var t=this,n=new Date(0),i=t.get("contentBox"),o,u,a,f,l,h;t.get("contentBox").all("."+c).removeClass(c);for(o=0;o<t._paneNumber;o++){u=r.addMonths(t.get("date"),o),a=t._getMarkedDatesInMonth(u),s(a,e.bind(t._renderMarkedDatesHelper,t));if(t.get("showPrevMonth")){d(u,n),n.setDate(1),l=t._getDateColumn(n)-1,h=0,f=i.one("#"+t._calendarId+"_pane_"+o+"_"+l+"_"+h);while(f)g(n,-1),t.dateIsMarked(n)&&f.addClass(c),l--,h--,f=i.one("#"+t._calendarId+"_pane_"+o+"_"+l+"_"+h)}if(t.get("showNextMonth")){d(u,n),y(n,1),g(n,-1),l=t._getDateColumn(n)+1,h=n.getDate()+1,f=i.one("#"+t._calendarId+"_pane_"+o+"_"+l+"_"+h);while(f)f.hasClass("yui3-calendar-column-hidden")||g(n,1),t.dateIsMarked(n)&&f.addClass(c),l++,h++,f=i.one("#"+t._calendarId+"_pane_"+o+"_"+l+"_"+h);l=0,h=30,f=i.one("#"+t._calendarId+"_pane_"+o+"_"+l+"_"+h);while(f)f.hasClass("yui3-calendar-column-hidden")||g(n,1),t.dateIsMarked(n)&&f.addClass(c),l++,h++,f=i.one("#"+t._calendarId+"_pane_"+o+"_"+l+"_"+h)}}},_getDateColumn:function(e){var t=e.getDate(),n=0,r=t%7,i=(12+e.getMonth()-this.get("date").getMonth())%12,s=this._calendarId+"_pane_"+i,o=this._paneProperties[s].cutoffCol;switch(r){case 0:o>=6?n=12:n=5;break;case 1:n=6;break;case 2:o>0?n=7:n=0;break;case 3:o>1?n=8:n=1;break;case 4:o>2?n=9:n=2;break;case 5:o>3?n=10:n=3;break;case 6:o>4?n=11:n=4}return n},_renderMarkedDatesHelper:function(e){this._dateToNode(e).addClass(c)},_getMarkedDatesInMonth:function(e){var t=this,n=e.getFullYear(),r=e.getMonth();return u(t._markedDates,n)&&u(t._markedDates[n],r)?i.values(t._markedDates[n][r]):[]}},!0),e.Calendar.ITSACalendarMarkedDates=b,e.Base.mix(e.Calendar,[b])},"gallery-2013.07.03-22-52",{requires:["base-build","node-base","calendar-base","datatype-date","datatype-date-math"],skinnable:!0});
