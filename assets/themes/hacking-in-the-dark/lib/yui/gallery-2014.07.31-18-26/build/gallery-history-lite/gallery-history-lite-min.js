YUI.add("gallery-history-lite",function(E){var N=E.config.win,I=E.config.doc.documentMode,L=encodeURIComponent,K=N.location,F=N.onhashchange!==undefined&&(I===undefined||I>7),G,D,C,O="history-lite:change";function B(R){var Q=[];E.each(R,function(T,S){if(E.Lang.isValue(T)){Q.push(L(S)+"="+L(T));}});return"#"+Q.join("&");}function A(Q){return decodeURIComponent(Q.replace(/\+/g," "));}var H;if(E.UA.gecko){H=function(){var Q=/#.*$/.exec(K.href);return Q&&Q[0]?Q[0]:"";};}else{H=function(){return K.hash;};}function P(Q){K.hash=Q;}function M(U){var V=C.parseQuery(G),R=C.parseQuery(U),T={},S={},Q;E.each(R,function(X,W){if(X!==V[W]){T[W]=X;Q=true;}});E.each(V,function(X,W){if(!R.hasOwnProperty(W)){S[W]=X;Q=true;}});if(Q){C.fire(O,{changed:T,newVal:U,prevVal:G,removed:S});}}function J(Q){G=Q.newVal;}E.HistoryLite=C={add:function(S,Q){var R=B(E.merge(C.parseQuery(H()),E.Lang.isString(S)?C.parseQuery(S):S));if(Q){J({newVal:R});}P(R);},get:function(Q){var R=C.parseQuery(H());return Q?R[Q]:R;},parseQuery:function(T){var S=T.match(/([^\?#&]+)=([^&]+)/g)||[],V={},R,Q,U;for(R=0,Q=S.length;R<Q;++R){U=S[R].split("=");V[A(U[0])]=A(U[1]);}return V;}};E.augment(C,E.EventTarget,true,null,{emitFacade:true});C.publish(O,{broadcast:2,defaultFn:J});G=H();if(F){E.Node.DOM_EVENTS.hashchange=true;E.on("hashchange",function(){M(H());},N);}else{D=D||E.later(50,C,function(){var Q=H();if(Q!==G){M(Q);}},null,true);}},"gallery-2009.12.15-22",{requires:["event-custom","event-custom-complex","node"]});