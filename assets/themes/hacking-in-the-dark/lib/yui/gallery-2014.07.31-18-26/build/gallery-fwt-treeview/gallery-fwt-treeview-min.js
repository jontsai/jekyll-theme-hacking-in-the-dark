YUI.add("gallery-fwt-treeview",function(e,t){"use strict";var n=e.Lang,r,i,s="#",o=e.ClassNameManager.getClassName,u=function(e){return o("fw-treeview",e)},a="contentBox",f="expanded",l="selectionEnabled",c="selected",h="Change",p=0,d=1,v=2;r=e.Base.create(t,e.FlyweightTreeManager,[],{_visibleSequence:null,_visibleIndex:null,initializer:function(e){this._domEvents=["click"],this._loadConfig(e.tree)},_initNodes:function(e){r.superclass._initNodes.call(this,e),e[c]=e[c]?v:p},renderUI:function(){r.superclass.renderUI.apply(this,arguments),this.get(a).set("role","tree")},bindUI:function(){r.superclass.bindUI.apply(this,arguments),this._eventHandles.push(this.get(a).on("keydown",this._onKeyDown,this))},_onKeyDown:function(t){var n=this,r=t.keyCode,i=this._focusedINode,o=this._visibleSequence,u=this._visibleIndex,a,l=function(r){a=n._poolFetch(i),t.container=t.target,t.target=e.one(s+i.id),n.fire(r,{domEvent:t,node:a}),a.fire(r)};if(i){switch(r){case 38:o||(o=this._rebuildSequence(),u=o.indexOf(i)),u-=1,u>=0?(i=o[u],n._visibleIndex=u):i=null;break;case 39:a=n._poolFetch(i),a.get(f)?i.children&&i.children.length?i=i.children[0]:i=null:(a.set(f,!0),i=null);break;case 40:o||(o=n._rebuildSequence(),u=o.indexOf(i)),u+=1,u<o.length?(i=o[u],n._visibleIndex=u):i=null;break;case 37:a=n._poolFetch(i),a.get(f)&&i.children?(a.set(f,!1),i=null):(i=i._parent,i===n._tree&&(i=null));break;case 36:i=n._tree.children&&n._tree.children[0];break;case 35:u=n._tree.children&&n._tree.children.length,u?i=n._tree.children[u-1]:i=null;break;case 13:l("enterkey"),i=null;break;case 32:l("spacebar"),i=null;break;case 106:n.expandAll();break;default:i=null}a&&n._poolReturn(a);if(i)return n._focusOnINode(i),t.halt(),!1}return!0},_afterFocus:function(e){var t=this._findINodeByElement(e.domEvent.target);this._focusOnINode(t),this._visibleSequence&&(this._visibleIndex=this._visibleSequence.indexOf(t))},_rebuildSequence:function(){var e=[],t=this.getRoot(),n=function(t){t.get(f)&&t.forSomeChildren(function(t){e.push(t._iNode),n(t)})};return n(t),t.release(),this._visibleSequence=e},CONTENT_TEMPLATE:"<ul></ul>"},{ATTRS:{defaultType:{value:"FWTreeNode"},toggleOnLabelClick:{value:!1,validator:n.isBoolean}}}),e.FWTreeView=r,i=e.Base.create("fw-treenode",e.FlyweightTreeNode,[],{initializer:function(){this._root._eventHandles.push(this.after("click",this._afterClick),this.after(c+h,this._afterSelectedChange),this.after("spacebar",this.toggleSelection),this.after(f+h,this._afterExpandedChanged),this.after("selectionEnabled"+h,this._afterSelectionEnabledChange))},_afterExpandedChanged:function(){this._root._visibleSequence=null},_afterClick:function(e){var t=e.domEvent.target,n=i.CNAMES;t.hasClass(n.CNAME_TOGGLE)?this.toggle():t.hasClass(n.CNAME_SELECTION)?this.toggleSelection():(t.hasClass(n.CNAME_LABEL)||t.hasClass(n.CNAME_ICON))&&this.get("root").get("toggleOnLabelClick")&&this.toggle()},toggleSelection:function(){this.set(c,this._iNode[c]?p:v)},_afterLabelChange:function(t){var n=e.one(s+this._iNode.id+" ."+i.CNAMES.CNAME_LABEL);n&&n.setHTML(t.newVal)},_afterSelectedChange:function(t){var n=t.newVal,r=i.CNAMES.CNAME_SEL_PREFIX+"-",o;if(!this.get(l))return;this.isRoot()||(o=e.one(s+this.get("id")),o&&(o.replaceClass(r+t.prevVal,r+n),o.set("aria-checked",this._ariaCheckedGetter())),this.get("propagateUp")&&t.src!=="propagatingDown"&&this.getParent()._childSelectedChange().release(),this.get("propagateDown")&&t.src!=="propagatingUp"&&this.forSomeChildren(function(e){e.set(c,n,{src:"propagatingDown"})}))},_afterSelectionEnabledChange:function(t){var n=this._iNode[c],r=e.one(s+this.get("id")),o=i.CNAMES.CNAME_SEL_PREFIX+"-";t.newVal?r.replaceClass(o+"null",o+n):r.replaceClass(o+n,o+"null")},_ariaCheckedGetter:function(){return["false","mixed","true"][this.get(c)||0]},_selectedSetter:function(e){return e?v:p},_selectedGetter:function(e){return this.get(l)?e||0:null},_propagateGetter:function(e){return this.get(l)?e!==!1:!1},_dynamicLoadReturn:function(){i.superclass._dynamicLoadReturn.apply(this,arguments);if(this.get("propagateDown")){var e=this.get(c);this.forSomeChildren(function(t){t.set(c,e,{src:"propagatingDown"})})}this._root._visibleSequence=null},_childSelectedChange:function(){var e=0,t=0,n,r=this._iNode[c];return this.forSomeChildren(function(n){e+=2,t+=n.get(c)}),n=t===0?p:t===e?v:d,this._iNode[c]=n,this._afterSelectedChange({prevVal:r,newVal:n,src:"propagatingUp"}),this}},{OUTER_TEMPLATE:'<li id="{id}" class="{CNAME_NODE} {CNAME_SEL_PREFIX}-{selected}" role="treeitem" aria-expanded="{expanded}" aria-checked="{_aria_checked}">{INNER_TEMPLATE}<ul class="{CNAME_CHILDREN}" role="group">{children}</ul></li>',INNER_TEMPLATE:'<div tabIndex="{tabIndex}" class="{CNAME_CONTENT}"><div class="{CNAME_TOGGLE}"></div><div class="{CNAME_ICON}"></div><div class="{CNAME_SELECTION}"></div><div class="{CNAME_LABEL}">{label}</div></div>',CNAMES:{CNAME_TOGGLE:u("toggle"),CNAME_ICON:u("icon"),CNAME_SELECTION:u("selection"),CNAME_SEL_PREFIX:u("selected-state"),CNAME_LABEL:u("label")},NOT_SELECTED:p,PARTIALLY_SELECTED:d,FULLY_SELECTED:v,ATTRS:{selected:{value:p,setter:"_selectedSetter",getter:"_selectedGetter"},_aria_checked:{readOnly:!0,getter:"_ariaCheckedGetter"},selectionEnabled:{value:!0,validator:n.isBoolean},propagateUp:{value:!0,validator:n.isBoolean,getter:"_propagateGetter"},propagateDown:{value:!0,validator:n.isBoolean,getter:"_propagateGetter"}}}),e.FWTreeNode=i},"gallery-2012.12.12-21-11",{requires:["gallery-flyweight-tree","widget","base-build"],skinnable:!0});
