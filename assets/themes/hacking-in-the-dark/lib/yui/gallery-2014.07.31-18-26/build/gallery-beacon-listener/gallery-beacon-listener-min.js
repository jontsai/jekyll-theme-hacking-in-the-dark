YUI.add("gallery-beacon-listener",function(e,t){"use strict";var n=1,r="beaconlistener:found",i="beaconlistener:lost",s=e.Lang,o=e.DOM,u="top",a="right",f="bottom",l="left";e.BeaconListener=e.Base.create("beaconListener",e.Base,[],{_isListening:!1,_timerHandle:null,_pollInterval:100,_region:null,_beaconList:null,_beaconStates:[],_beaconDOMNodes:[],_fullyInside:!1,initializer:function(t){t=t||{beacons:".beacon",region:null};var n=this,s=t.beacons,o=t.region;n.publish(r,{context:n,broadcast:!0,emitFacade:!0}),n.publish(i,{context:n,broadcast:!0,emitFacade:!0}),n.after("beaconlistener:beaconsChange",n._handleBeaconsChange),s&&n._handleBeaconsChange(),n.after("beaconlistener:regionChange",n._handleRegionChange),o&&n._handleRegionChange(),n.after("beaconlistener:pollIntervalChange",n._handlePollIntervalChange),e.on("windowresize",function(){n._handleRegionChange()}),n.after("beaconlistener:fullyInsideChange",n._handleFullyInsideChange),n._handleFullyInsideChange(),n.get("autoStart")&&(n.start(),e.later(n.get("pollInterval"),n,n.check,null,!1))},stop:function(){var e=this;e._isListening===!0&&e._timerHandle!==null&&(e._timerHandle.cancel(),e._timerHandle=null,e._isListening=!1)},start:function(){var t=this;s.isUndefined(t._timerHandler)&&!s.isUndefined(t._beaconList)&&t._beaconList!==null&&(t._isListening=!0,t._timerHandle=e.later(t.get("pollInterval"),t,t.check,null,!0))},check:function(){var e=this,t=e._region,n;t===null?n=o.inViewportRegion:(e._handleRegionChange(),t=e._region,n=o.inRegion),e._beaconList.each(function(s,o){var u=e._beaconDOMNodes[o],a,f;t===null?f=[u,e._fullyInside]:f=[u,t,e._fullyInside],a=n.apply(e,f),a&&!e._beaconStates[o]?(e._beaconStates[o]=!0,e.fire(r,{listener:e,beacon:s})):!a&&e._beaconStates[o]&&(e._beaconStates[o]=!1,e.fire(i,{listener:e,beacon:s}))})},isListening:function(){return this._isListening},_handleFullyInsideChange:function(){var e=this;e._fullyInside=e.get("fullyInside")},_handleRegionChange:function(){var e=this,t=e.get("region");e.recalcRegion(t)},recalcRegion:function(t){var n=this,r;e.Lang.isUndefined(t)&&(t=n._region);if(s.isObject(t)){if(s.isNumber(t[u])&&s.isNumber(t[a])&&s.isNumber(t[f])&&s.isNumber(t[l])){n._region=t;return}t=e.one(t);if(t){t.getDOMNode?r=o.region(t.getDOMNode()):r=o.region(t);if(r){n._region=r;return}}}n._region=null},_handleBeaconsChange:function(){var e=this,t=e.get("beacons");e._beaconStates=[],e._beaconDOMNodes=[],e._beaconList=e._getList(t),e._beaconList&&e._beaconList.size()>0&&e._beaconList.each(function(t,n){e._beaconStates[n]=!1,e._beaconDOMNodes[n]=t.getDOMNode()})},_getList:function(t){var n;return s.isString(t)?e.all(t):s.isObject(t)&&t.nodes?t:(n=e.one(t),n?new e.NodeList(n):null)},_handlePollIntervalChange:function(){var e=this;e._pollInterval=e.get("pollInterval")}},{ATTRS:{pollInterval:{value:100,validator:function(e){return s.isNumber(e)&&e>n}},region:{value:null,validator:function(t){return t===null||e.one(t)}},beacons:{value:".beacon",validator:function(e){return!s.isUndefined(e)&&e!==null}},fullyInside:{value:!1,validator:function(e){return s.isBoolean(e)}},autoStart:{value:!1,validator:function(e){return s.isBoolean(e)}}}})},"gallery-2013.06.20-02-07",{requires:["node","event-custom","event-resize","base-build","dom"]});
