YUI.add("gallery-datatable-footerview",function(a){a.FooterView=a.Base.create("tableFooter",a.View,[],{TMPL_td:'<td class="yui3-datatable-even {tdClass}">{content}</td>',TMPL_th:'<th colspan="{colspan}" class="{thClass}">{content}</th>',TMPL_tr:"<tr>{th_content}{td_content}</tr>",TMPL_tfoot:'<tfoot class="{footClass}"><tr>{th_content}{td_content}</tr></tfoot>',TMPL_table_fixed:'<table cellspacing="0" aria-hidden="true" class="{className}"></table>',dateFormat:"%D",timeFormat:"%T",fnReplace:a.Lang.sub,node_cols:null,_subscr:null,_dt:null,initializer:function(b){b||(b={});this._dt=(b.source)?b.source:b.host;this._subscr=[];if(b.footerConfig&&b.footerConfig.fixed&&this._dt.get("scrollable")){this._subscr.push(a.Do.after(this._buildFixedFooter,this._dt,"_syncScrollUI",this._dt));}this._subscr.push(this._dt.data.after(["*:change","*:add","*:create","*:remove","*:reset"],a.bind("refreshFooter",this)));},destructor:function(){a.Array.each(this._subscr,function(b){b.detach();});this._dt._tfootNode.empty();if(this._dt._yScrollFooter){this._dt._yScrollFooter.empty();}},render:function(){var q=this.get("container"),l=this._dt,c=l.get("columns"),s=l.get("data"),t=l.get("footerConfig"),e=t.columns,k="",m="",r=1;this.node_cols=[];this.dateFormat=(t&&t.dateFormat)?t.dateFormat:(l.get("dateFormat"))?l.get("dateFormat"):this.dateFormat;this.timeFormat=(t&&t.timeFormat)?t.timeFormat:(l.get("timeFormat"))?l.get("timeFormat"):this.timeFormat;var d={ROW_COUNT:s.size(),COL_COUNT:c.length,DATE:a.DataType.Date.format(new Date(),{format:this.dateFormat}),TIME:a.DataType.Date.format(new Date(),{format:this.timeFormat})};a.Object.each(d,function(v,i,u){u[i.toLowerCase()]=v;});if(t.heading){r=t.heading.colspan||r;k=this.fnReplace(this.TMPL_th,{colspan:r,thClass:" "+(t.heading.className||""),content:this.fnReplace(t.heading.content,d)});var n={index:0,key:0,td:null,th:t.heading,className:t.heading.className||"",formatter:"",content:null};this.node_cols.push(n);}var h=c.length-r;var p=[];for(var o=r;o<c.length;o++){var j=c[o];p.push({index:o,key:j.key,td:null,th:null,className:j.className||"",formatter:j.formatter||"",content:null});}a.Array.each(e,function(i){var u=-1;a.Array.some(p,function(w,v){if(w.key===i.key){u=v;return true;}});if(u!==-1){p[u].td=this.formatFootCell(p[u],i);p[u].content=i.content||null;p[u].foot_cfg=i;if(i.formatter){p[u].formatter=i.formatter;}if(i.className){p[u].className=i.className;}}},this);a.Array.each(p,function(i){i.td=i.td||"";i.content=i.content||null;m+=this.fnReplace(this.TMPL_td,{tdClass:i.className||"",content:i.td});this.node_cols.push(i);},this);var f=this._dt.getClassName("footer");tr_tmpl=this.TMPL_tfoot;var b=this.fnReplace(tr_tmpl,{footClass:f,th_content:k,td_content:m});var g=q.append(a.Node.create(b));this.fire("renderFooter");return this;},calcDatasetValue:function(d,c){var f=this._dt.get("data"),e=0;if(a.Lang.isString(c)){var b=c.toLowerCase(),h=b.search(/{average}|{avg}|{mean}/i);if(b.search(/{row_count}/)!==-1){return f.size();}if(b.search(/{col_count}/)!==-1){return this._dt.get("columns").length;}if(b.search(/{date}/)!==-1){return a.DataType.Date.format(new Date(),{format:this.dateFormat});}if(b.search(/{time}/)!==-1){return a.DataType.Date.format(new Date(),{format:this.timeFormat});}if(b.search(/{min}|{max}/)!==-1){e=parseFloat(f.item(0).get(d));}f.each(function(i){var j=i.get(d),k=+j;if(b.search(/{sum}/)!==-1||h!==-1){e+=k;}else{if(b.search(/{min}/)!==-1){e=Math.min(e,k);}else{if(b.search(/{max}/)!==-1){e=Math.max(e,k);}else{e=c;}}}});if(h!==-1){e=(!f.isEmpty())?(parseFloat(e)/parseFloat(f.size())):0;}return parseFloat(e);}if(a.Lang.isNumber(c)){return c;}if(a.Lang.isFunction(c)){var g=c.call(this,f);return g;}},formatFootCell:function(e,g){if(!g.content){return"";}var f=this.calcDatasetValue(g.key,g.content);var d=(g.formatter&&a.Lang.isFunction(g.formatter))?g.formatter:(e.formatter&&a.Lang.isFunction(e.formatter))?e.formatter:null;f=(d&&d.call)?d.call(this,{value:f,column:e}):f;if(a.Lang.isFunction(g.content)){return f;}else{var b=g.content.match(/{.*}/)[0]||null,c=g.content;if(b&&a.Lang.isString(b)){c=c.replace(b,f);}return c;}},refreshFooter:function(){var b=this._dt,d=b._tfootNode,c=d.all("th,td");a.Array.each(this.node_cols,function(h,g){var f;if(h.th){var e={ROW_COUNT:b.data.size(),COL_COUNT:b.get("columns").length,DATE:a.DataType.Date.format(new Date(),{format:this.get("dateFormat")}),TIME:a.DataType.Date.format(new Date(),{format:this.get("timeFormat")})};a.Object.each(e,function(k,i,j){j[i.toLowerCase()]=k;});f=this.fnReplace(h.th.content,e);}if(!h.th&&h.content){f=this.formatFootCell(h,h.foot_cfg);}if(f){c.item(g).setHTML(f);}},this);this.fire("refreshFooter");return this;},resizeFooter:function(){var b=this._dt,f=b.get("contentBox").one("."+b.getClassName("scroll","columns")),e=this._dt._tfootNode,d=e.all("th,td");if(b._yScroll){function g(i,h){var h=i.getComputedStyle(h),j=(h)?+(h.replace(/px/,"")):0;return j;}var c=f.all("th");a.Array.each(this.node_cols,function(k,m){var n=0,l;if(k.th){for(var h=0;h<k.th.colspan;h++){l=c.item(k.index+h);n+=g(l,"width");}n+=k.th.colspan-1;}else{l=c.item(k.index);n=g(l,"width")-20;}d.item(m).setStyle("width",n+"px");});}this.fire("resizeFooter");return this;},_buildFixedFooter:function(){var c=this._yScrollFooter,f=this._tfootNode,e=this._yScrollHeader,g=this._yScrollContainer;if(!c){var b='<table cellspacing="0" aria-hidden="true" class="{className}"></table>';c=a.Node.create(a.Lang.sub(this._Y_SCROLL_FOOTER_TEMPLATE||this.foot.TMPL_table_fixed||b,{className:this.getClassName("footer")}));this._yScrollFooter=c;g.append(c);var d=this.get("contentBox").one("table > tfoot");this._tfootNode=d;if(d){this._yScrollFooter.append(d);this.foot.resizeFooter();}}}});},"gallery-2012.08.22-20-00",{skinnable:true,requires:["base-build","datatable-base","view"]});