YUI.add("gallery-itsacalendarmodellist",function(e,t){"use strict";function m(){}function g(){}var n=e.Lang,r=e.Array,i=e.Object,s=i.hasKey,o=e.DataType.Date,u=o.isValidDate,a=function(e){return new Date(e.getTime())},f=function(e,t){t.setTime(e.getTime())},l=function(e,t){e.setTime(e.getTime()+6e4*t)},c=function(e,t){var n=e.getFullYear(),r=e.getMonth()+t;n=Math.floor(n+r/12),r=(r%12+12)%12,e.setFullYear(n),e.setMonth(r)},h=function(e,t){e.setTime(e.getTime()+864e5*t)},p=function(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},d=function(e,t){return o.isGreater(e,t)&&!p(e,t)},v=function(e,t){return o.isGreater(e,t)||p(e,t)};e.mix(m.prototype,{getModelAttr:function(e,t){return e&&(e.get&&n.type(e.get)==="function"?e.get(t):e[t])},setModelAttr:function(e,t,r,i){var s=this,o,u;e&&(o=!e.get||n.type(e.get)!=="function",o?(u=s.revive(e),e[t]=r,u&&(u._set("clientId",e.clientId,{silent:!0}),u.set(t,r,i),s.free(u))):e.set(t,r,i))},getModelToJSON:function(e){return e.get&&n.type(e.get)==="function"?e.toJSON():e}},!0),e.ITSAModellistAttrExtention=m,e.Base.mix(e.ModelList,[m]),g.ATTRS={modelList:{value:null,lazyAdd:!1,validator:function(e){return e===null||e.getByClientId},setter:"_setModelList"},modelConfig:{value:null,validator:function(e){return e===null||n.isObject(e)},setter:"_setModelConfig"}},e.mix(g.prototype,{initializer:function(){var e=this;e._modelConfigInitiated=!1,e._modelListInitiated=!1,e._internalUpdate=!1,e._storedModelDates={},e._fireModelsEvent=e.after("selectionChange",e._fireSelectedModels)},getModels:function(e,t){var i=this,s=[],u,f,l,c,p,v;if(n.isArray(e))s=i._getSelectedModelList({newSelection:e,validateDate:!0});else if(o.isValidDate(e)){v=function(e){r.indexOf(s,e)===-1&&s.push(e)};if(!o.isValidDate(t)||d(e,t))t=a(e);c=new Date(e.getTime());do u=c.getFullYear(),f=c.getMonth(),l=c.getDate(),p=i._storedModelDates[u]&&i._storedModelDates[u][f]&&i._storedModelDates[u][f][l]||[],r.each(p,v),h(c,1);while(!d(c,t))}return s},dateHasModels:function(e){var t=this,n=t._storedModelDates,r=e.getFullYear(),i=e.getMonth(),s=e.getDate(),o=n[r]&&n[r][i]&&n[r][i][s]||[],u=o.length>0;return u},getModelsInDate:function(e){var t=this;return t.getModels(e)},getModelsInWeek:function(e){var t=this,n=e.getDay(),r=a(e),i=a(e);return h(r,-n),h(i,6-n),t.getModels(r,i)},getModelsInMonth:function(e){var t=this,n=a(e),r=o.addMonths(e,1);return n.setDate(1),r.setDate(1),h(r,-1),t.getModels(n,r)},getModelsInYear:function(e){var t=this,n=new Date(e,0,1),r=new Date(e,11,31);return t.getModels(n,r)},destructor:function(){var e=this;e._clearSyncSubscriptionModelList(),e._fireModelsEvent&&e._fireModelsEvent.detach(),e._afterRenderEvent&&e._afterRenderEvent.detach()},_clearSyncSubscriptionModelList:function(){var e=this;e._syncModelListEvent&&e._syncModelListEvent.detach(),e._syncModelListCheckEvent&&e._syncModelListCheckEvent.detach()},_setModelConfig:function(e){var t=this;t._modelConfigInitiated&&!t._internalUpdate?t._syncModelList(null,null,e):t._modelConfigInitiated=!0},_setModelList:function(e){var t=this,r=t.get("modelConfig")||{},s=r.date,o,u;!s&&e&&e.size()>0&&(o=e.item(0),i.some(o.getAttrs(),function(e,t){return u=n.isDate(e),u&&(s=t),u}),u&&(t._internalUpdate=!0,r.date=s,t.set("modelConfig",r),t._internalUpdate=!1)),t._clearSyncSubscriptionModelList(),e&&(t._syncModelListEvent=e.after(["add","remove","reset"],t._syncModelList,t),t._syncModelListCheckEvent=e.after("*:change",t._checkSyncModelList,t)),t._modelListInitiated||e?t._syncModelList(null,e):t._modelListInitiated=!0},_checkSyncModelList:function(t){var n=this,r=n.get("modelConfig")||{},i=r.date||"",s=r.enddate||"",o=r.count||"",u=r.intervalMinutes||"",a=r.intervalHours||"",f=r.intervalDays||"",l=r.intervalMonths||"";if(t.changed[i]||t.changed[s]||t.changed[o]||t.changed[u]||t.changed[a]||t.changed[f]||t.changed[l])n.get("rendered")?n._doSyncModelList():n._afterRenderEvent=n.after("render",e.bind(n._doSyncModelList,n))},_syncModelList:function(t,n,r){var i=this;i.get("rendered")?i._doSyncModelList(n,r):i._afterRenderEvent=i.after("render",e.bind(i._doSyncModelList,i,n,r))},_doSyncModelList:function(e,t){var r=this,s=e||r.get("modelList"),o=t||r.get("modelConfig")||{},m=o&&o.date,g=o&&o.enddate,y=o&&o.count,b=o&&o.intervalMinutes,w=o&&o.intervalHours,E=o&&o.intervalDays,S=o&&o.intervalMonths,x=[],T,N,C,k,L;r.clearMarkedDates(s&&m),L=i.size(r._storedModelDates),r._storedModelDates={},s&&m?(!g&&!y?T=function(e){var t=s.getModelAttr(e,m);u(t)&&(x.push(t),r._storeModelDate(e,t))}:g&&!y?T=function(e){var t=s.getModelAttr(e,m),n=s.getModelAttr(e,g)||t;if(u(t)){u(n)||(n=t),N=a(t);do x.push(a(N)),r._storeModelDate(e,N),h(N,1);while(v(n,N))}}:!g&&y?T=function(e){var t=s.getModelAttr(e,m),i=s.getModelAttr(e,y)||1,o=b&&s.getModelAttr(e,b),h=w&&s.getModelAttr(e,w),d=E&&s.getModelAttr(e,E),v=S&&s.getModelAttr(e,S),g;if(u(t)){n.isNumber(i)||(i=1),n.isNumber(o)||(o=0),n.isNumber(h)||(h=0),n.isNumber(d)||(d=0),n.isNumber(v)||(v=0),g=1440*d+60*h+o,g===0&&v===0&&(g=1440),N=a(t),k=new Date(0);for(C=0;C<i;C++)p(N,k)||(x.push(a(N)),r._storeModelDate(e,N)),f(N,k),g>0&&l(N,g),v>0&&c(N,v)}}:g&&y&&(N=new Date(0),T=function(e){var t=s.getModelAttr(e,m),i=s.getModelAttr(e,g)||t,o=s.getModelAttr(e,y)||1,p=b&&s.getModelAttr(e,b),T=w&&s.getModelAttr(e,w),L=E&&s.getModelAttr(e,E),A=S&&s.getModelAttr(e,S),O,M,_;if(u(t)){u(i)||(i=t),n.isNumber(o)||(o=1),n.isNumber(p)||(p=0),n.isNumber(T)||(T=0),n.isNumber(L)||(L=0),n.isNumber(A)||(A=0),O=1440*L+60*T+p,O===0&&A===0&&(O=1440),M=a(t),_=a(i),k=new Date(0);for(C=0;C<o;C++){f(M,N);do d(N,k)&&(x.push(a(N)),r._storeModelDate(e,N)),h(N,1);while(v(_,N));f(N,k),h(k,-1),O>0&&(l(M,O),l(_,O)),A>0&&(c(M,A),c(_,A))}}}),s.each(T),r.markDates(x),r._fireSelectedModels()):L>0&&r._fireSelectedModels()},_storeModelDate:function(e,t){var n=this,r=t.getFullYear(),i=t.getMonth(),o=t.getDate();s(n._storedModelDates,r)||(n._storedModelDates[r]={}),s(n._storedModelDates[r],i)||(n._storedModelDates[r]
[i]={}),s(n._storedModelDates[r][i],o)||(n._storedModelDates[r][i][o]=[]),n._storedModelDates[r][i][o].push(e)},_fireSelectedModels:function(e){var t=this;t.fire("modelSelectionChange",{newModelSelection:t._getSelectedModelList(e),selectedDates:e&&e.newSelection||t.get("selectedDates")})},_getSelectedModelList:function(e){var t=this,n=e&&e.newSelection||t.get("selectedDates"),i=[];return r.each(n,function(n){if(e&&!e.validateDate||o.isValidDate(n)){var s=n.getFullYear(),u=n.getMonth(),a=n.getDate(),f=t._storedModelDates[s]&&t._storedModelDates[s][u]&&t._storedModelDates[s][u][a]||[];r.each(f,function(e){r.indexOf(i,e)===-1&&i.push(e)})}}),i}},!0),e.Calendar.ITSACalendarModelList=g,e.Base.mix(e.Calendar,[g])},"gallery-2013.07.03-22-52",{requires:["base-build","node-base","calendar-base","model","model-list","lazy-model-list","datatype-date-math","gallery-itsacalendarmarkeddates"]});
