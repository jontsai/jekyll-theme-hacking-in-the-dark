YUI.add("gallery-itsascrollviewkeynav",function(e,t){"use strict";var n=e.Lang,r=e.Array,i="itsa-model",s=i+"-focus",o=function(e,t){return parseInt(e.getStyle(t),10)};e.namespace("Plugin").ITSAScrollViewKeyNav=e.Base.create("itsascrollviewkeynav",e.Plugin.Base,[],{_eventhandlers:[],host:null,initializer:function(){var t=this,n;t.host=n=t.get("host"),n instanceof e.ScrollView&&t._bindUI()},destructor:function(){this._clearEventhandlers()},_bindUI:function(){var t=this;t._eventhandlers.push(e.on("keydown",e.rbind(t._handleKeyDown,t)))},_handleKeyDown:function(t){var n=this,r=n.host,u=t.keyCode,a=r.itsainfiniteview,f=e.rbind(r.scrollTo,r),l=r.get("boundingBox"),c=l.getX(),h=l.getY(),p=l.get("offsetHeight")+o(l,"borderTopWidth")+o(l,"borderBottomWidth")+o(l,"paddingTop")+o(l,"paddingBottom"),d=l.get("offsetWidth")+o(l,"borderLeftWidth")+o(l,"borderRightWidth")+o(l,"paddingLeft")+o(l,"paddingRight"),v=parseInt(l.getStyle("borderRightWidth"),10),m=parseInt(l.getStyle("borderBottomWidth"),10),g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct;k=function(e,t,n,r,i,s){var o=e.getXY(),u=t.getXY(),a=o[0],f=o[1],l=a+e.get("offsetWidth"),c=f+e.get("offsetHeight"),h=u[0]+(n||0),p=u[1]+(r||0),d=u[0]+(i||0)+t.get("offsetWidth"),v=u[1]+(s||0)+t.get("offsetHeight");return a>=h&&l<=d&&f>=p&&c<=v},ot=function(e,t){var n,r;return t?(n=e.getY()+e.get("offsetHeight")+o(e,"marginBottom"),r=h+p):(n=e.getX()+e.get("offsetWidth")+o(e,"marginRight"),r=c+d),r-n},ut=function(e,t){var n;return t?n=e.getY()-o(e,"marginTop"):n=e.getX()-o(e,"marginLeft"),n-(t?h:c)},tt=function(e){return e&&k(e,l)},Z=function(e){var t=e.next("."+i)||!1;return t&&k(t,l)},et=function(e){var t=e.previous("."+i)||!1;return t&&k(t,l)},R=function(e){return!r._itmsAvail&&k(e.item(e.size()-1),l,0,0,v,m)},nt=function(e){var t;return e.some(function(e){return t=tt(e)&&e.hasClass(i)&&e,t}),t},rt=function(e){var t=!1,n;return e.some(function(e){var r=tt(e);return r&&(t=!0,e.hasClass(i)&&(n=e)),t&&!r}),n},Q=function(){r.scrollIntoView(0),b?f(null,0):f(0,null)},G=function(){r.scrollIntoView(K.size()-1)},st=function(e){var t=K&&e&&K.getByClientId(e.getData("modelClientId"));t&&r.scrollIntoView(t)};if(r.get("focused")){D=r.get("modelsSelectable"),C=r._viewNode||r.get("srcNode").one("*"),P=r.pages,P&&(U=e.rbind(P.scrollToIndex,P)),g=r.get("axis"),y=g.x,b=g.y,I=u===36,q=u===35,w=u===37&&y,E=u===39&&y,S=u===38&&b,x=u===40&&b,L=u===33&&y&&!b,A=u===34&&y&&!b,O=u===33&&b,M=u===34&&b,_=u===13||u===32,(_||w||E||S||x||L||A||O||M||I||q)&&t.preventDefault();if(D){K=r.getModelListInUse();if(I)Q();else if(q)G();else if(_||w||E||S||x||L||A||O||M){J=C.one("."+s);if(J)if(w||E||S||x)J=x||E?J.next("."+i):J.previous("."+i),J&&st(J),(S||w)&&!J&&Q();else if(A||M){at=Z(J);if(!tt(J)&&!at)it=J.next("."+i),st(it||J);else if(at)F=C.get("children"),st(rt(F));else{it=J.next("."+i),W=ot(J,M);while(it&&k(it,l,0,(M?p:d)-W,0,(M?p:d)-W))J=it,it=J.next("."+i);st(J)}}else if(L||O){at=et(J);if(!tt(J)&&!at)it=J.previous("."+i),st(it||J);else if(at)F=C.get("children"),st(nt(F));else{it=J.previous("."+i);if(!it)Q();else{W=ut(J,O);while(it&&k(it,l,0,-(O?p:d)+W,0,-(O?p:d)+W))J=it,it=J.previous("."+i);st(J)}}}else _&&(lt=J.getData("modelClientId"),ct=K.getByClientId(lt),r.modelIsSelected(ct)?r.unselectModels(ct):r.selectModels(ct));else if(x||E||M||A)F=C.get("children"),x||E?st(nt(F)):st(rt(F))}}else if(P){H=P.get("index"),B=P.get("total"),F=C.get("children"),(w||S)&&P.prev();if(O&&H>0){T=!0;for(N=H-1;T&&N>=0;N--)j=F.item(N),T=N===H-1||k(j,l,0,-p);ft=N+2,H===ft?U(0):U(ft)}if(L&&H>0){T=!0;for(N=H-1;T&&N>=0;N--)j=F.item(N),T=N===H-1||k(j,l,-d,0);ft=N+2,H===ft?U(0):U(ft)}I&&U(0),(E||x)&&!R(F)&&(ft=H+1,ft=Math.min(ft,n._getMaxPaginatorGotoIndex(ft,0)),U(ft));if((M||A)&&!R(F)){T=!0;for(N=H+1;T&&N<B;N++)j=F.item(N),T=k(j,l);ft=N-1,ft=Math.min(ft,n._getMaxPaginatorGotoIndex(ft,0)),U(ft)}q&&!R(F)&&(a&&r._itmsAvail&&(r.itsainfiniteview.loadAllItems(),B=P.get("total")),ft=B-1,ft=Math.min(ft,n._getMaxPaginatorGotoIndex(ft)),U(ft))}else z=r.get(b?"scrollY":"scrollX"),V=e.rbind(n._saveScrollTo,n),w||S||E||x||L||O||A||M?(w||S||E||x?X=n.get("step"):X=b?p:d,$=A||M||E||x,b?V(null,z+($?X:-X)):V(z+($?X:-X),null),a&&$&&a.checkExpansion()):I?b?f(null,0):f(0,null):q&&(a&&a.loadAllItems(),b?V(null,r._maxScrollY):V(r._maxScrollX,null))}},_paginatorScrollToIndex:function(e){var t=this.host,n=t&&t.pages,r=t&&t.itsainfiniteview;n&&(r?n.scrollToIndex(Math.min(e,t._getMaxPaginatorGotoIndex(0))):n.scrollToIndex(e))},_saveScrollTo:function(e,t){var n=this.host;e&&(e=Math.max(0,e),e=Math.min(e,n._maxScrollX)),t&&(t=Math.max(0,t),t=Math.min(t,n._maxScrollY)),n.scrollTo(e,t)},_focusHost:function(){var e=this,t=this.host;t&&t.get("rendered")?e._focusHostSave():e.afterHostEvent("render",e._focusHostSave,e)},_getMaxPaginatorGotoIndex:function(e,t){var n=this.host,r=n.hasPlugin("pages"),i=n.hasPlugin("itsainfiniteview"),s=n.get("axis"),u=s.y,a=n.get("boundingBox").get(u?"offsetHeight":"offsetWidth"),f=0,l=n.getModelListInUse(),c=n._viewNode||n.get("srcNode").one("*"),h=c.get("children"),p=l&&l.size()||h.size(),d,v;if(r&&p>0){d=l?n.getNodeFromIndex(Math.min(e,p-1),t):h.item(p-1),u?v=d.get("offsetHeight")+o(d,"marginTop")+o(d,"marginBottom"):v=d.get("offsetWidth")+o(d,"marginLeft")+o(d,"marginRight"),l&&i&&(h=c.get("children")),f=h.size();while(d&&--f>=0&&v<a)d=h.item(f),u?v+=d.get("offsetHeight")+o(d,"marginTop")+o(d,"marginBottom"):v+=d.get("offsetWidth")+o(d,"marginLeft")+o(d,"marginRight");v>=a&&f++}return f},_focusHostSave:function(){var e=this.host;e&&e.focus&&e.focus()},_clearEventhandlers:function(){r.each(this._eventhandlers,function(e){e.detach()})}},{NS:"itsasvkeynav",ATTRS:{initialFocus:{value:!0,lazyAdd:!1,validator:function(e){return n.isBoolean(e)},setter:"_focusHost"},step:{value:10,validator:function(e){return n.isNumber(e)}}}})},"gallery-2013.04.10-22-48",{requires:["base-build","plugin","pluginhost-base","node","scrollview","dom-screen"]});
