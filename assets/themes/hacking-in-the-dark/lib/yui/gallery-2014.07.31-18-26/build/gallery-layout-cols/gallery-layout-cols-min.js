YUI.add("gallery-layout-cols",function(e,t){"use strict";function r(t,n){var r=t;return n.hd&&(r-=n.hd.get("offsetHeight")),n.ft&&(r-=n.ft.get("offsetHeight")),r-=n.bd.vertMarginBorderPadding(),Math.max(r,e.PageLayout.min_module_height)}function i(e,t,n,r,i,s){return s.mbp=i.vertMarginBorderPadding(),Math.max(1,Math.floor(e*t[n][r]/100)-s.mbp)}var n=0<e.UA.ie&&e.UA.ie<8;e.namespace("PageLayoutCols"),e.PageLayoutCols.collapse_classes={vert_parent_class:e.PageLayout.module_class,horiz_parent_class:e.PageLayout.module_cols_class,collapse_parent_pattern:"("+e.PageLayout.expand_left_nub_class+"|"+e.PageLayout.expand_right_nub_class+")"},e.PageLayoutCols.resize=function(t,s,o){var u=this.get("matchColumnHeights"),a=this.body_info.outers.size();if(t===e.PageLayout.FIT_TO_VIEWPORT){var f=[],l=[];for(var c=0;c<a;c++){var h=this.body_info.inner_sizes[c].slice(0);f.push(h),l.push(o);var p=0,d=0,v=this.body_info.modules[c],m=v.size();for(var g=0;g<m;g++){var y=v.item(g);y.hasClass(e.PageLayout.collapsed_vert_class)?(y.setStyle("height","auto"),h[g]=-y.get("offsetHeight"),l[c]-=y.totalHeight()):h[g]>0&&(p++,d+=h[g])}if(p<m)for(var g=0;g<m;g++)h[g]>0&&(h[g]*=100/d)}}var b={},w=this.body_info.outer_sizes.slice(0),p=0,d=0;for(var c=0;c<a;c++){var E=this.body_info.outers.item(c),S=E.hasClass(e.PageLayout.collapsed_horiz_class),v=this.body_info.modules[c];if(S||w[c]<0){w[c]=0;if(S)E.setStyle("width","auto"),v.item(0).setStyle("width","auto");else if(n){var x=v.item(0)._page_layout.children;if(x.bd){var T=x.bd.totalWidth()+v.item(g).horizMarginBorderPadding();x.root.setStyle("width",T+"px"),E.setStyle("width",T+"px")}}s-=E.totalWidth()}else p++,d+=w[c],v.size()==1&&v.item(0).setStyle("height","auto")}if(p<a)for(var c=0;c<a;c++)w[c]*=100/d;var N=0,C=0,k=[];for(var c=0;c<a;c++){if(w[c]==0){var y=this.body_info.modules[c].item(0),x=y._page_layout.children;if(t===e.PageLayout.FIT_TO_VIEWPORT){var L=i(l[c],f,c,0,y,b);y.setStyle("height",L+"px");if(x.bd){var A=r(L,x),O=x.bd.insideWidth();this.fire("beforeResizeModule",{bd:x.bd,height:A,width:O}),x.bd.setStyle("height",A+"px"),this.fire("afterResizeModule",{bd:x.bd,height:A,width:O})}}else x.bd&&(this.fire("beforeResizeModule",{bd:x.bd,height:"auto",width:"auto"}),x.root.setStyle("height","auto"),x.bd.setStyle("height","auto"),u?k.push([[x.bd,x.bd.insideWidth()]]):this.fire("afterResizeModule",{bd:x.bd,height:x.bd.insideHeight(),width:x.bd.insideWidth()}));continue}C++;var M=Math.max(1,Math.floor(s*w[c]/100));N+=M,C==p&&(M+=s-N),M=Math.max(1,M-this.body_info.outers.item(c).horizMarginBorderPadding()),this.body_info.outers.item(c).setStyle("width",M+"px"),M=Math.max(1,M-this.body_info.modules[0].item(0).horizMarginBorderPadding());var v=this.body_info.modules[c];if(t===e.PageLayout.FIT_TO_VIEWPORT){var _=0,D=v.size(),m=D;for(var g=0;g<m;g++){var L=f[c][g];L<0&&(_+=v.item(g).totalHeight(),D--)}var P=0;for(var g=0;g<m;g++){var y=v.item(g),x=y._page_layout.children;if(f[c][g]<0){var A=x.bd.insideHeight(),O=M-x.root.horizMarginBorderPadding()-x.bd.horizMarginBorderPadding();this.fire("beforeResizeModule",{bd:x.bd,height:A,width:O}),y.setStyle("width",M+"px"),this.fire("afterResizeModule",{bd:x.bd,height:A,width:O});continue}P++;if(x.bd){var L=i(l[c],f,c,g,y,b),A=r(L,x);_+=L+b.mbp,P==D&&(A+=o-_);var O=Math.max(1,M-x.bd.horizMarginBorderPadding());this.fire("beforeResizeModule",{bd:x.bd,height:A,width:O}),this._setWidth(x,M),x.bd.setStyle("height",A+"px"),this.fire("afterResizeModule",{bd:x.bd,height:A,width:O})}}}else{k.push([]);var m=v.size();for(var g=0;g<m;g++){var x=v.item(g)._page_layout.children;if(x.bd){var O=Math.max(1,M-x.bd.horizMarginBorderPadding());this.fire("beforeResizeModule",{bd:x.bd,height:"auto",width:O}),this._setWidth(x,M),x.root.setStyle("height","auto"),x.bd.setStyle("height","auto"),u?k[c].push([x.bd,O]):this.fire("afterResizeModule",{bd:x.bd,height:x.bd.insideHeight(),width:O})}}}}if(t===e.PageLayout.FIT_TO_CONTENT&&u){var L=0;for(var c=0;c<a;c++)L=Math.max(L,this.body_info.outers.item(c).get("offsetHeight"));for(var c=0;c<a;c++){var v=this.body_info.modules[c],m=v.size(),y=null,O=0;for(var g=m-1;g>=0;g--){var H=v.item(g);if(m==1||!y&&!H.hasClass(e.PageLayout.collapsed_vert_class)&&this.body_info.inner_sizes[c][g]>0)y=H,O=k[c][g][1];else{var B=k[c][g][0];this.fire("afterResizeModule",{bd:B,height:B.insideHeight(),width:k[c][g][1]})}}if(y){var j=L-this.body_info.outers.item(c).get("offsetHeight");if(j>0&&y.get("parentNode").hasClass(e.PageLayout.collapsed_horiz_class))y.setStyle("height",y.insideHeight()+j+"px");else{var x=y._page_layout.children;if(x.bd){var A=x.bd.insideHeight()+j;y.setStyle("height","auto"),x.bd.setStyle("height",A+"px"),this.fire("afterResizeModule",{bd:x.bd,height:A,width:O})}}}}}}},"gallery-2013.06.13-01-19",{requires:["gallery-layout"]});
