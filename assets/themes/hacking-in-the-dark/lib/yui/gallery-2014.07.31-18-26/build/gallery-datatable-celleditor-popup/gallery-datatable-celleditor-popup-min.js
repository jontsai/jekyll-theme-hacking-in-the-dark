YUI.add("gallery-datatable-celleditor-popup",function(e,t){var n=27,r=13,i=9,s=38,o=40,u=39,a=37;e.DataTable.BaseCellPopupEditor=e.Base.create("celleditor",e.View,[],{template:'<div class="yui3-widget yui3-overlay {classOverlay}" tabindex="1"></div>',btnTemplate:'<button class="yui3-button {classButton}" data-button={name}>{value}</button>',overlay:null,_classInput:"yui3-datatable-editor-input",_classItem:"yui3-datatable-editor-input-item",_classOverlay:"yui3-datatable-editor-overlay",_classOverlayBtn:"yui3-datatable-editor-overlay-button",_classEditing:"editing",_inputNode:null,_subscr:[],initializer:function(){return this._createUI(),this._bindUI(),this},destructor:function(){this.cancelEditor(),this._unbindUI(),this.fire("editorDestroyed")},_bindUI:function(){this.publish({editorSave:{defaultFn:this._defEditorSaveFn,emitFacade:!0,preventable:!0},editorCancel:{defaultFn:this._defEditorCancelFn,emitFacade:!0,preventable:!0},editorCreated:{emitFacade:!0,preventable:!0},editorDestroyed:{emitFacade:!0,preventable:!0}}),this._inputNode&&this._subscr.push(this._inputNode.on("keydown",this.processKeyDown,this),this._inputNode.on("keypress",this.processKeyPress,this)),this._subscr.push(this.on("xyChange",this._setEditorXY))},_createUI:function(){var t=this.get("overlayConfig"),n=this.get("templateObject"),r;r=this._createOverlay(),t&&t.buttons&&this._createOverlayButtons(r),n&&e.Lang.isObject(n)&&this._createTemplateContent(r),this._inputNode=r.get("contentBox").one("."+this._classInput),this.overlay=r,r.render(),this.fire("editorCreated",{inputNode:this._inputNode,container:r}),this.set("container",r),this.overlay=r},_unbindUI:function(){e.Array.each(this._subscr,function(e){e&&e.detach&&e.detach()}),this._subscr=null,this.widget&&this.widget.destroy({remove:!0}),this.overlay&&(this.overlay.destroy({remove:!0}),this.overlay=null)},showEditor:function(e){e=e||this.get("cell").td;var t=this.get("cell"),n=e.getXY(),r=this.get("offsetXY"),i=+e.getComputedStyle("width").replace(/px/,""),s=this._isZeroOr(t.value)?t.value:this.get("value");e.addClass(this._classEditing),this.overlay.show(),this._clearDOMSelection(),r&&(n[0]+=r[0],n[1]+=r[1]),this.overlay.set("xy",n),i=this.get("inputWidth")||i,this._inputNode&&this._inputNode.setStyle("width",i),this._set("visible",!0),this._set("hidden",!1),this._setInputValue(s),this.fire("editorShow",{td:e,cell:t,inputNode:this._inputNode,value:s})},cancelEditor:function(){this.fire("editorCancel",{td:this.get("cell").td,cell:this.get("cell"),oldValue:this.get("lastValue")})},saveEditor:function(e){var t=this.get("cell"),n;e=e!==undefined&&e!==null?e:this.get("value")||this._inputNode.get("value");if(e!==undefined&&e!==null){n=this.get("saveFn"),e=n?n.call(this,e):e;if(e===undefined){this.cancelEditor();return}e&&this.set("lastValue",this.get("value")),this.fire("editorSave",{td:t.td,cell:t,oldValue:this.get("lastValue"),newValue:e})}},hideEditor:function(e){var t;this.overlay&&this.overlay.hide(),t=this.get("cell"),t&&t.td&&t.td.removeClass(this._classEditing),e===!0&&this._set("hidden",!0),this._set("visible",!1),this.fire("editorHide")},processKeyPress:function(t){var n=t.keyCode,i=t.target||this._inputNode,s=i.get("value"),o=this.get("keyFiltering"),u=String.fromCharCode(n),a=!0,f;n===r&&this.get("saveKeyRTN")&&(t.preventDefault(),this.saveEditor(s)),o instanceof RegExp?a=u.match(o)?a:!1:e.Lang.isFunction(o)&&(f=o.call(this,t),a=f?!0:!1),a||t.preventDefault()},processKeyDown:function(e){var t=e.keyCode,r;switch(t){case n:e.preventDefault(),this.hideEditor();break;case s:r=e.ctrlKey?[-1,0]:null;break;case o:r=e.ctrlKey?[1,0]:null;break;case a:r=e.ctrlKey?[0,-1]:null;break;case u:r=e.ctrlKey?[0,1]:null;break;case i:r=e.shiftKey?[0,-1]:[0,1]}r&&(this.get("inputKeys")===!0&&this._set("keyDir",r),e.preventDefault())},_defEditorSaveFn:function(e){this.set("value",e.newValue),this.hideEditor()},_defEditorCancelFn:function(){this.hideEditor()},_createOverlay:function(){var t=this.get("overlayConfig"),n,r;return n=e.Lang.sub(this.get("template"),{classOverlay:this._classOverlay+" "}),this.get("overlayWidth")&&(t.width=this.get("overlayWidth")),t=e.merge(t,{contentBox:e.Node.create(n),bodyContent:" ",zIndex:99,visible:!1,render:!0}),r=new e.Overlay(t),e.Plugin.Drag&&r.plug(e.Plugin.Drag),r.hide(),this._inputNode=r.get("contentBox").one("."+this._classInput),r},_createOverlayButtons:function(t){var n=this.get("overlayConfig"),r=n.buttons,i=t.get("contentBox"),s=i.appendChild(e.Node.create('<div class="yui3-widget-ft"></div>')),o,u;e.Array.each(r,function(t){o=e.Lang.sub(this.btnTemplate,{classButton:this._classOverlayBtn+(t.name?"-"+t.name:""),name:t.name||"btn",value:t.value||"unknown label"}),u=s.appendChild(e.Node.create(o)),u&&t.action&&e.Lang.isFunction(t.action)&&this._subscr.push(u.on("click",e.bind(t.action,this)))},this)},_createTemplateContent:function(t){var n=e.merge(this.get("templateObject")),r=this.get("name"),i=this.get(r+"Options")||n.options,s,o,u,a,f;s=this.get("templateEngine"),o=new e.Template(s),f=n.html,/<%|\{\{/.test(f)&&(n.classInput=this._classInput,n.propValue=this.get("propValue")||n.propValue||"value",n.propText=this.get("propText")||n.propText||"text",n.propTitle=this.get("propTitle")||n.propTitle,e.Lang.isArray(i)?(n.options=[],e.Array.each(i,function(t){a={},e.Lang.isObject(t)?a={value:t[n.propValue],text:t[n.propText],title:n.propTitle?t[n.propTitle]||n.propTitle:null,raw:t}:a={value:t,text:t,title:null,raw:t},n.options.push(a)},this)):e.Lang.isObject(i)&&(i=e.merge(i),n.options=[],e.Object.each(i,function(t,r,i){this._isZeroOr(t)&&this._isZeroOr(r)&&(a={value:e.Lang.isString(r)&&/^\d*$/.test(r)?+r:r,text:t,title:n.propTitle?n.propTitle:null,raw:i},n.options.push(a))},this)),u=o.compile(n.html),u&&(f=u(n))),f&&t.set("bodyContent",f)},_setEditorXY:function(e){this.overlay&&e.newVal&&this.overlay.set("xy",e.newVal)},_isZeroOr:function(e){return e!==undefined&&e!==null?!0:!1},_mouseLeave:function(){this.cancelEditor()},_setInputValue:function(
e){var t;e=e||this.get("cell").value||this.get("value");if(!e)return;return t=this.get("prepFn"),e=t?t.call(this,e):e,this._inputNode&&this._inputNode.set("value",e),e},_clearDOMSelection:function(){var t=e.config.win.getSelection?e.config.win.getSelection():e.config.doc.selection?e.config.doc.selection:null;t&&t.empty&&t.empty(),t&&t.removeAllRanges&&t.removeAllRanges()}},{ATTRS:{name:{value:null,validator:e.Lang.isString},template:{valueFn:function(){return this.template},validator:e.Lang.isString},overlayConfig:{value:{},validator:e.Lang.isObject},inputWidth:{value:null},overlayWidth:{value:null},inputKeys:{value:!0,validator:e.Lang.isBoolean},templateEngine:{value:null},templateObject:{value:null},cell:{value:{}},hostDT:{value:null,validator:function(t){return t instanceof e.DataTable}},value:{value:null},lastValue:{value:null},prepFn:{value:null,validator:e.Lang.isFunction},saveFn:{value:null,validator:e.Lang.isFunction},keyDir:{value:[],readOnly:!0,validator:e.Lang.isArray},visible:{value:!1,readOnly:!0,validator:e.Lang.isBoolean},hidden:{value:!1,readOnly:!0,validator:e.Lang.isBoolean},offsetXY:{value:[0,0],validator:e.Lang.isArray},xy:{value:null,validator:e.Lang.isArray},saveKeyRTN:{value:!0,validator:e.Lang.isBoolean},keyFiltering:{value:null},validator:{value:null}}}),e.DataTable.EditorOptions.text={BaseViewClass:e.DataTable.BaseCellPopupEditor,name:"text",templateObject:{html:'<input type="text" title="inline cell editor" class="<%= this.classInput %>"  />'},inputKeys:!0,after:{editorShow:function(e){e.inputNode.focus()}}},e.DataTable.EditorOptions.textarea={BaseViewClass:e.DataTable.BaseCellPopupEditor,name:"textarea",templateObject:{html:'<textarea title="inline cell editor" class="<%= this.classInput %>"></textarea>'},inputKeys:!0,saveKeyRTN:!1,overlayConfig:{buttons:[{name:"save",value:"Save",action:function(){var e=this._inputNode?this._inputNode.get("value"):null;this.saveEditor(e)}},{name:"cancel",value:"Cancel",action:function(){this.cancelEditor()}}]},after:{editorShow:function(e){e.inputNode.focus()}}},e.DataTable.EditorOptions.number={BaseViewClass:e.DataTable.BaseCellPopupEditor,name:"number",templateObject:{html:'<input type="text" title="inline cell editor" class="<%= this.classInput %>"  />'},inputKeys:!0,validator:/^\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*$/,keyFiltering:/\.|\d|\-/,saveFn:function(e){var t=this.get("validator"),n;return t instanceof RegExp?n=t.test(e)?+e:undefined:n=+e,n},after:{editorShow:function(e){e.inputNode.focus(),e.inputNode.select()}}},e.DataTable.EditorOptions.date={BaseViewClass:e.DataTable.BaseCellPopupEditor,name:"date",templateObject:{html:'<input type="text" title="inline cell editor" class="<%= this.classInput %>"  />'},inputKeys:!0,inputWidth:75,keyFiltering:/\/|\d|\-/,prepFn:function(t){var n=this.get("dateFormat")||"%D";return e.DataType.Date.format(t,{format:n})},saveFn:function(t){return e.DataType.Date.parse(t)||undefined}},e.DataTable.EditorOptions.calendar={BaseViewClass:e.DataTable.BaseCellPopupEditor,name:"calendar",inputKeys:!0,templateObject:{html:'Enter Date: &nbsp; <input type="text" title="inline cell editor" class="<%= this.classInput %>"  /><br/><div class="yui3-dt-editor-calendar"></div>'},overlayConfig:{buttons:[{name:"save",value:"Save",action:function(){var e=this._inputNode?this._inputNode.get("value"):null;this.saveEditor(e)}},{name:"cancel",value:"Cancel",action:function(){this.cancelEditor()}}]},inputWidth:75,keyFiltering:/\/|\d|\-/,prepFn:function(t){var n=this.get("dateFormat")||"%D"||"%m/%d/%Y";return e.DataType.Date.format(t,{format:n})},saveFn:function(t){return e.DataType.Date.parse(t)||undefined},after:{editorCreated:function(){var t=this.overlay.get("contentBox").one(".yui3-dt-editor-calendar"),n,r={height:"215px",width:"200px",showPrevMonth:!0,showNextMonth:!0,after:{selectionChange:function(e){var t=e.newSelection[0],n=this.editor,r=n.get("prepFn"),i=n._inputNode;i.set("value",r?r.call(this,t):t)},dateClick:function(e){var t=e.date,n=this.editor;n.saveEditor(t)}}},i=this.get("calendarConfig")||{};t&&e.Calendar&&(r=e.merge(r,i),r.srcNode=t,n=(new e.Calendar(r)).render(),e.Plugin.Calendar&&e.Plugin.Calendar.JumpNav&&this.plug(e.Plugin.Calendar.JumpNav,{yearStart:1988,yearEnd:2021})),n.editor=this,this.widget=n},editorDestroyed:function(){this.widget&&this.widget.destroy({remove:!0})},editorShow:function(t){var n=t.value;this.widget&&(this.widget.show(),e.Lang.isDate(n)&&(this.widget.set("date",n),this.widget.selectDates(n))),this._setInputValue(n),t.inputNode.focus()},editorHide:function(){this.widget&&this.widget.hide()},editorSave:function(){this.widget&&this.widget.hide()}}},e.DataTable.EditorOptions.autocomplete={BaseViewClass:e.DataTable.BaseCellPopupEditor,name:"autocomplete",templateObject:{html:'<input type="text" title="inline cell editor" class="<%= this.classInput %>" />'},inputKeys:!0,after:{editorCreated:function(t){var n=t.inputNode,r=this.get("autocompleteConfig")||{},i=this;n&&e.Plugin.AutoComplete&&(r=e.merge(r,{alwaysShowList:!0,render:!0}),n.plug(e.Plugin.AutoComplete,r),n.ac.editor=i)}}},e.DataTable.EditorOptions.radio={BaseViewClass:e.DataTable.BaseCellPopupEditor,name:"radio",templateObject:{html:'<div class="myradios "><% Y.Array.each( this.options, function(r) { %>  <input type="radio" name="dt-editor-radio" value="<%= r.value %>" <% (r.title) ? \'title="r.title"\' :  %> /> <%= r.text %><% },this); %></div>'},after:{editorCreated:function(){var e=this.overlay.get("contentBox");this._subscr.push(e.delegate("click",function(e){var t=e.target,n=t.get("value");this._isZeroOr(n)&&this.saveEditor(n)},'input[type="radio"]',this))},editorShow:function(t){var n=this.overlay.get("contentBox").one(".myradios").all('input[type="radio"]'),r=t.value||this.get("value"),i=e.Lang.isString(r),s,o;n.each(function(e){o=e&&e.get?e.get("value"):null,o=!i&&/^\d*$/.test(o)?+o:o;if(o===r)return s=e,!0;e.set("checked",!1)}),s&&s.set("checked",!0)}}},e.DataTable.EditorOptions.dropdown={BaseViewClass:e.DataTable
.BaseCellPopupEditor,name:"dropdown",templateObject:{html:'<select class="myselect"><% Y.Array.each( data.options, function(r){ %><option value="<%= r.value %>" <% (r.title) ? \'title="r.title"\' :  %>><%= r.text %></option><% },this); %></select>'},after:{editorCreated:function(){var e=this.overlay.get("contentBox");this._subscr.push(e.delegate("change",function(e){var t=e.currentTarget.get("value");this._isZeroOr(t)&&this.saveEditor(t)},"select",this))},editorShow:function(e){var t=this.overlay.get("contentBox").one(".myselect"),n=t.get("options"),r=e.value||this.get("value"),i;n.some(function(e){if(e&&e.get("value")==r)return i=e,!0}),i&&i.set("selected",!0)}}},e.DataTable.EditorOptions.select=e.DataTable.EditorOptions.dropdown,e.DataTable.EditorOptions.combobox=e.DataTable.EditorOptions.dropdown,e.DataTable.EditorOptions.checkbox={BaseViewClass:e.DataTable.BaseCellPopupEditor,name:"checkbox",templateObject:{html:'<input type="checkbox" title="inline cell editor" />'},after:{editorCreated:function(){var e=this.overlay.get("contentBox");this._subscr.push(e.delegate("click",function(e){var t=e.currentTarget,n=t.get("checked")||!1,r=this.get("checkboxHash")||{"true":!0,"false":!1},i=r[n];this._isZeroOr(i)&&this.saveEditor(i)},'input[type="checkbox"]',this))},editorShow:function(e){var t=this.overlay.get("contentBox").one('input[type="checkbox"]'),n=e.value||this.get("value"),r=this.get("checkboxHash")||this.get("checkboxOptions")||{"true":!0,"false":!1},i=!1;t&&n!==undefined&&(i=n===r["true"]?!0:!1,i=n===r["false"]?!1:i,t.set("checked",i))}}}},"gallery-2013.01.16-21-05",{supersedes:[""],skinnable:"true",requires:["gallery-datatable-editable","base-build","view","cssbutton","event-outside","overlay","dd-plugin","template"],optional:[""]});
