YUI.add("gallery-model-sync-socket",function(e,t){function a(){}var n=e.Lang,r=n.sub,i=n.isValue,s=n.isString,o=n.isNumber,u=n.isFunction;a._NON_ATTRS_CFG=["root","url"],a.prototype={root:"",url:function(){var e=this.root,t;return this._isYUIModelList||this.isNew()?e:(t=this.getAsURL("id"),e&&e.charAt(e.length-1)==="/"&&(t+="/"),this._joinURL(t))},initializer:function(e){e||(e={}),i(e.url)&&(this.url=e.url)},onSocket:function(e,t,n,r){var i=this._ioEvents||(this._ioEvents={}),s=this._getURL()+":"+e,o=this;u(t)&&(r=n,n=t,t=window.socket||this.socket);var a={type:e,global:s,localCallback:n,globalCallback:function(t){o.fire(e,t)}};return this.on(a.type,a.localCallback,r||o),t.on(a.global,a.globalCallback),i[a.name]?i[a.name].push(a):i[a.name]=[a],this},detachSocket:function(t,n,r){var i=this._ioEvents||(this._ioEvents={}),s=this._getURL()+":"+t,o=this;u(n)&&(r=n,n=this.socket||window.socket||e.socket);var a=i[t];if(e.isEmpty(a)){if(r&&u(r)){for(var f=0,l=a.length;f<l;f++)r==a[f].localCallback&&(this.detach(a[f].type,a[f].localCallback),n.removeListener(a[f].global,a[f].globalCallback),a[f]=!1);a=e.Array.filter(a)}else this.detach(t),n.removeAllListeners(s);a.length===0&&delete i[t]}return this},detachAllSockets:function(t){var n=this._ioEvents||(this._ioEvents={});t||(t=this.socket||window.socket||e.socket);for(var r in n)this.detachSocket(r,t);return this},sync:function(t,n,r){var i=this._getURL().split("/"),s=i[0]!==""?i[0]:i[1];t=t==="create"?"construct":t;var o=e.mix(n,{req:s+":"+t});o.data||(o.data=this.toJSON()||{});var u=window.socket||e.Socket;u.emit(s+":"+t,o.data,function(e,t){e?r(e):r(null,t)})},_getURL:function(){var t=this.url;return u(t)?this.url():(t.charAt(0)==="/"&&(t=t.substring(1)),this._isYUIModel&&(data={},e.Object.each(this.toJSON(),function(e,t){if(s(e)||o(e))data[t]=encodeURIComponent(e)}),t=r(t,data)),t||this.root)},_joinURL:function(e){var t=this.root;return e.charAt(0)==="/"&&(e=e.substring(1)),t.charAt(0)==="/"&&(t=t.substring(1)),t&&t.charAt(t.length-1)==="/"?t+e:t+"/"+e}},e.namespace("ModelSync").Socket=a},"gallery-2013.09.25-18-27",{supersedes:[""],skinnable:"false",requires:["model","model-list","json-stringify"],optional:[""]});
