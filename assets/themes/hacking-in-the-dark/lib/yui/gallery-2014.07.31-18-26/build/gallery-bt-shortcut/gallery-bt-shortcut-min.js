YUI.add("gallery-bt-shortcut",function(e,t){var n=e.one("body"),r=e.one(".bt-shortcut-mask")||n.appendChild(e.Node.create('<div class="bt-shortcut-mask"></div>')),i="widthChange",s="heightChange",o="visibleChange",u=e.Bottle.Device.getPositionFixedSupport(),a,f,l=[],c,h,p={unveil:1,push:1},d={top:[0,-1,.5,0],bottom:[0,1,.5,1],left:[-1,0,0,.5],right:[1,0,1,.5]},v={"true":1,"false":1},m=e.Base.create("btshortcut",e.Widget,[e.WidgetParent,e.WidgetStack,e.Bottle.PushPop],{initializer:function(){a||(a=e.Bottle.Page.getCurrent(),a&&(f=a.get("boundingBox"),a.set("zIndex",m.ZINDEX_PAGE))),l.push(this),this._bscEventHandlers=new e.EventHandle([this.after(i,this._updatePositionShow),this.after(s,this._updatePositionShow),this.before(o,this._beforeShowHide),this.after(o,this._doShowHide)]),this.get("contentBox").setStyle("display","block"),this._updatePositionHide(),this._updatePositionShow()},destructor:function(){this._bscEventHandlers.detach(),delete this._bscEventHandlers},renderUI:function(){this.syncWH()},scResize:function(t){var n=!1;if(!this.get("visible")&&!t)return;if(t||this.get("width")!==e.Bottle.Device.getBrowserWidth()||this.get("height")===e.Bottle.Device.getBrowserHeight())n=this._updateFullSize();(t||n||this.get("showFrom").match(/right|bottom/))&&this._updatePositionShow()},_updateFullSize:function(){if(this.get("nativeScroll"))return;return this.get("fullHeight")&&this.set("height",e.Bottle.Device.getBrowserHeight(),{noAlign:!0}),this.get("fullWidth")&&this.set("width",e.Bottle.Device.getBrowserWidth(),{noAlign:!0}),!0},getShowHidePosition:function(t){var n=t?0:1,r=this.get("nativeScroll"),i=d[this.get("showFrom")];return[Math.floor(i[2]*e.Bottle.Device.getBrowserWidth()+(n*i[0]-i[2])*this.get("width")),(r?0:Math.floor(i[3]*e.Bottle.Device.getBrowserHeight())+(n*i[1]-(r?0:i[3]))*this.get("height"))+(e.Bottle.get(!r)?0:e.Bottle.Device.getScrollY())]},_updatePositionShow:function(e){var t=e&&e.showFrom?e.showFrom:this.get("showFrom"),n=e&&e.visible!==undefined?e.visible:this.get("visible"),r=e&&e.noAlign?!0:!1,i=d[t],s;if(!n)return;if(r)return;f.setStyles({left:-i[0]*(e&&e.attrName==="width"?e.newVal:this.get("width"))+"px",top:-i[1]*(e&&e.attrName==="height"?e.newVal:this.get("height"))+"px"}),s=this.getShowHidePosition(!0),this.absMove(s[0],s[1])},_updatePositionHide:function(e){var t=this.get("action")==="unveil",n=e&&e.visible!==undefined?e.visible:this.get("visible"),r=this.getShowHidePosition(n||t);this.absMove(r[0],r[1])},_displayMask:function(e){r.setStyle("display",e?"block":"none")},_doTransition:function(t,n,r,i,s){var o=this,u=e.merge(this.get("scTrans"),{left:n+"px"});u[s?"bottom":"top"]=r+"px",e.later(1,this,function(){t.transition(u,function(){i&&i.apply(o)})})},_beforeShowHide:function(e){if(!c||!e.newVal||c===this)return;h=this,e.halt(),c.hide()},_doneShowHide:function(){var t=this.get("visible"),n=this.get("mask"),r;t&&this.get("nativeScroll")&&(e.Bottle.Page.getCurrent().resetScroll(this.get("boundingBox")),r=this.getShowHidePosition(!0),this.absMove(r[0],r[1])),n&&this._displayMask(t),this.set("disabled",t?!1:!0),this.set("zIndex",t?m.ZINDEX_SHOW:m.ZINDEX_HIDE),h&&(h.show(),h=undefined)},_doShowHide:function(t){var n=t.newVal,r=n?-1:0,i=d[this.get("showFrom")],s=this.get("boundingBox"),o;n?(this.enable(),this._updateFullSize(),this._updatePositionHide({visible:!1}),c=this):(this.get("nativeScroll")&&e.Bottle.Page.getCurrent().resetScroll(),this._updatePositionShow({visible:!0}),this.get("mask")&&this._displayMask(!1),c=undefined),this.set("zIndex",m.ZINDEX_HIDE),o=[r*i[0]*this.get("width"),r*i[1]*this.get("height")],u&&a.get("nativeScroll")&&a.each(function(e){e.get("headerFixed")&&this._doTransition(e.get("headerNode"),o[0],o[1]),e.get("footerFixed")&&this._doTransition(e.get("footerNode"),o[0],-o[1],null,!0)},this),this._doTransition(f,o[0],o[1],this._doneShowHide),this.get("action")!=="unveil"&&(o=this.getShowHidePosition(n),this._doTransition(s,o[0],o[1]))}},{ATTRS:{action:{value:"unveil",lazyAdd:!1,validator:function(e){return p[e]?!0:!1},setter:function(e){return e!==this.get("action")&&this._updatePositionShow({action:e}),e}},showFrom:{value:"left",lazyAdd:!1,validator:function(e){return d[e]?!0:!1},setter:function(e){var t,n=this.get("contentBox"),r=d[e][0];return e===this.get("showFrom")?e:(this._updatePositionShow({showFrom:e}),t=n.getData("full-height"),v[t]?this.set("fullHeight",t==="true"):this.set("fullHeight",r!==0?!0:!1),t=n.getData("full-width"),v[t]?this.set("fullWidth",t==="true"):this.set("fullWidth",r===0),e)}},mask:{value:!0,validator:e.Lang.isBoolean,setter:function(e){return this.get("visible")&&this._displayMask(e),e}},scTrans:{value:{duration:.5}},fullHeight:{validator:e.Lang.isBoolean,lazyAdd:!1,setter:function(e){return e&&this.scResize(),e}},fullWidth:{validator:e.Lang.isBoolean,lazyAdd:!1,setter:function(e){return e&&this.scResize(),e}}},HTML_PARSER:{mask:function(e){return e.getData("mask")==="false"?!1:!0},action:function(e){return e.getData("action")},showFrom:function(e){return e.getData("show-from")},scTrans:function(t){try{return e.JSON.parse(t.getData("cfg-sc-trans"))}catch(n){}}},ZINDEX_PAGE:100,ZINDEX_SHOW:200,ZINDEX_HIDE:10,getInstances:function(){return l},getCurrent:function(){return c}});e.Bottle.ShortCut=m,r.on(e.Bottle.Device.getTouchSupport()?"gesturemoveend":"click",function(){c.hide()}),r.on("gesturemovestart",function(e){e.preventDefault()})},"gallery-2013.04.10-22-48",{requires:["gallery-bt-page"]});
