YUI.add("gallery-paginator-view",function(e,t){e.PaginatorModel=e.Base.create("paginatorModel",e.Model,[],{_npages:null,_subscr:null,initializer:function(){return this._recalcPagnParams(),this._subscr=[],this._subscr.push(this.after("totalItemsChange",this._recalcPagnParams)),this._subscr.push(this.after("itemsPerPageChange",this._recalcPagnParams)),this._subscr.push(this.on("pageChange",this._changePage)),this},destructor:function(){e.Array.each(this._subscr,function(e){e.detach()}),this._subscr=null},_changePage:function(e){var t=e.newVal,n=!0;if(t<1||!this.get("totalPages")||!this.get("itemsPerPage"))n=!1;return n&&this.get("totalPages")&&t>this.get("totalPages")&&(n=!1),n?this.set("lastPage",e.prevVal):e.preventDefault(),!0},_recalcPagnParams:function(){var e=this.get("itemsPerPage"),t=this.get("totalItems");return e&&e>0?(np=Math.floor(t/e),t%e>0&&np++,t===0&&(np=1),this._npages=np,np<this.get("page")&&this.set("page",1),!0):!1},_getItemIndexStart:function(){return this.get("totalItems")>0?(this.get("page")-1)*this.get("itemsPerPage"):null},_getItemIndexEnd:function(){var e=this.get("totalItems"),t=this.get("itemIndexStart")+this.get("itemsPerPage")-1;return e>0?t>e?e:t:null}},{ATTRS:{totalItems:{value:null,validator:e.Lang.isNumber},itemsPerPage:{value:null,validator:e.Lang.isNumber},page:{value:1,validator:e.Lang.isNumber},lastPage:{value:null,validator:e.Lang.isNumber},totalPages:{value:null,validator:e.Lang.isNumber,getter:function(){return this._npages}},itemIndexStart:{value:null,validator:e.Lang.isNumber,getter:"_getItemIndexStart"},itemIndexEnd:{value:null,validator:e.Lang.isNumber,getter:"_getItemIndexEnd"}}}),e.PaginatorView=e.Base.create("paginatorView",e.View,[],{TMPL_PAGINATOR:'<a href="#" data-pglink="first" class="{pageLinkClass}" title="First Page">First</a> | <a href="#" data-pglink="prev" class="{pageLinkClass}" title="Prior Page">Prev</a> | {pageLinks} | <a href="#" data-pglink="next" class="{pageLinkClass}" title="Next Page">Next</a> | <a href="#" data-pglink="last" class="{pageLinkClass}" title="Last Page">Last</a>',TMPL_LINK:'<a href="#" data-pglink="{page}" class="{pageLinkClass}" title="Page {page}">{page}</a>',TMPL_basic:"{firstPage} {prevPage} {pageLinks} {nextPage} {lastPage}",TMPL_pglinks:"{pageLinks}",TMPL_selectRPP:'<select class="{selectRPPClass}"></select>',TMPL_selectPage:'<select class="{selectPageClass}"></select>',TMPL_inputRPP:'<input type="text" class="{inputRPPClass}" value="{itemsPerPage}"/>',TMPL_inputPage:'<input type="text" class="{inputPageClass}" value="{page}"/>',model:null,_pagHTML:null,_cssPre:"yui3-pagview",_classContainer:null,_classLinkPage:null,_classLinkPageList:null,_classLinkPageActive:null,_classSelectRPP:null,_classSelectPage:null,_classInputRPP:null,_classInputPage:null,_subscr:null,_myClassName:function(){var e,t;if(arguments&&arguments.length>0){e=this._cssPre;for(t=0;t<arguments.length;t++)e+="-"+arguments[t];return e}return""},initializer:function(){var t,n;return this._classContainer=this._myClassName("container"),this._classLinkPage=this._myClassName("link","page"),this._classLinkPageList=this._myClassName("link","page","list"),this._classLinkPageActive=this._myClassName("link","page","active"),this._classInputPage=this._myClassName("input","page"),this._classSelectPage=this._myClassName("select","page"),this._classSelectRPP=this._myClassName("select","rowsperpage"),this._classInputRPP=this._myClassName("input","rowsperpage"),t=this.get("container"),e.Lang.isString(t)&&n[0]==="#"&&this.set("container",e.one(t)),t=this.get("container"),t instanceof e.Node&&t.getHTML()?this._pagHTML=t.getHTML():t instanceof e.Node&&this.get("paginatorTemplate")&&(n=this.get("paginatorTemplate"),n&&(this._pagHTML=n[0]==="#"?e.one(n).getHTML():n)),this._bindUI(),this},_bindUI:function(){var t=this.get("container");return this._subscr=[],this.get("model")&&(this.model=this.get("model"),this._subscr.push(this.model.after("pageChange",e.bind(this._modelPageChange,this))),this._subscr.push(this.model.after("itemsPerPageChange",e.bind(this._modelStateChange,this))),this._subscr.push(this.model.after("totalItemsChange",e.bind(this._modelItemsChange,this)))),this._subscr.push(this.after("render",e.bind(this._updateRPPSelect,this))),this._subscr.push(t.delegate("click",this._clickChangePage,"."+this._classLinkPage,this)),this._subscr.push(t.delegate("change",this._selectChangeRowOptions,"."+this._classSelectRPP,this)),this._subscr.push(t.delegate("change",this._inputChangePage,"."+this._classInputPage,this)),this._subscr.push(t.delegate("change",this._selectChangeRowOptions,"."+this._classInputRPP,this)),this._subscr.push(this.after(["render","pageChange"],this.resizePaginator)),this},destructor:function(){e.Array.each(this._subscr,function(t){e.Lang.isArray(t)?e.Array.each(t,function(e){e.detach()}):t.detach()}),this._subscr=null,this.get("container").empty()},render:function(){var t=this.get("container"),n=this.get("model"),r=n.get("totalItems"),i=n.get("itemsPerPage"),s=n.get("totalPages"),o=n.get("page")||1,u="",a=this.get("pageLinkTemplate"),f=0,l=0,c,h,p;if(r<0||!i||!t)return this;r===0&&(s=1,o=1);if(this._pagHTML.search(/\{pageLinks\}/)!==-1)for(p=0;p<s;p++)plClass=this._classLinkPage+" "+this._classLinkPageList,p+1===o&&(plClass+=" "+this._classLinkPageActive),f=p*i+1,l=f+i-1,l=l>=r?r:l,u+=e.Lang.sub(a,{page:p+1,pageLinkClass:plClass||"",pageStartIndex:f,pageEndIndex:l});return c=this._pagHTML,t.setStyle("visibility","hidden"),t.setHTML(""),c='<div class="{pagClass}" tabindex="-1">'+c+"</div>",h=e.substitute(c,e.mix({pageLinks:u||"",pageLinkClass:this._classLinkPage,pagClass:this._classContainer,selectRowsPerPage:this.TMPL_selectRPP||"",selectPage:this.TMPL_selectPage||"",inputPage:this.TMPL_inputPage||"",inputRowsPerPage:this.TMPL_inputRPP||"",selectRPPClass:this._classSelectRPP,selectPageClass:this._classSelectPage,inputRPPClass:this._classInputRPP,inputPageClass:this._classInputPage},n.getAttrs()),null,!0),t.append(h),t.setStyle("visibility",""),this._processPageChange(o),this.fire("render"),this},disable:function(){this.fire("disablePaginator")},_processPageChange:function(t){var n=this.get("model"),r=n.get("totalPages"),i=n.get("lastPage"),s=this.get("maxPageLinks"),o=this.get("container"),u=this.get("linkListOffset"),a=o.all("."+this._classLinkPageList),f,l,c,h;a&&this.get("linkHighLight")&&(f=a&&t-1<a.size()?a.item(t-1):null,f&&f.addClass(this._classLinkPageActive),i&&i!==t&&(f=a&&i-1<a.size()?a.item(i-1):null,f&&f.removeClass(this._classLinkPageActive))),o.one("."+this._classInputPage)&&o.one("."+this._classInputPage).set("value",t),o.one("."+this._classInputRPP)&&o.one("."+this._classInputRPP).set("value",n.get("itemsPerPage")),n.get("totalItems")===0&&this._disablePageSelector(["1"],!1),r===1?this._disablePageSelector(["first","prev","last","next"],!1):t===1&&!this.get("circular")?(this._disablePageSelector(["first","prev"]),this._disablePageSelector(["last","next"],!0)):t===r&&!this.get("circular")?(this._disablePageSelector(["first","prev"],!0),this._disablePageSelector(["last","next"])):this._disablePageSelector(["first","prev","last","next"],!0),this.fire("pageChange",{state:n.getAttrs()});if(r<=s||!a||a&&a.size()===0)return;return l=e.Node.create('<span class="'+this._myClassName("more")+'">'+this.get("pageLinkFiller")+"</span>"),c=e.Node.create('<span class="'+this._myClassName("more")+'">'+this.get("pageLinkFiller")+"</span>"),o.all("."+this._myClassName("more")).remove(),h=this._calcOffset(t,u),a.each(function(e,t){if(t===0&&this.get("alwaysShowFirst")||t===r-1&&this.get("alwaysShowLast"))return!0;t+1<h.left||t+1>h.right?e.addClass(this._myClassName("hide")):e.removeClass(this._myClassName("hide"))},this),h.left-u>0&&a.item(h.left-1).insert(l,"before"),h.right+u<=r&&a.item(h.right-1).insert(c,"after"),!0},_calcOffset:function(e,t){var n=this.get("model").get("totalPages"),r=e-t<1?1:e-t,i=e+t>n?n:e+t;return{left:r,right:i}},_disablePageSelector:function(t,n){t=e.Lang.isArray(t)?t:[t],n=n?n:!1;var r='[data-{suffix}="{sdata}"]',i=this.get("container");e.Array.each(t,function(t){var s=i.one(e.Lang.sub(r,{suffix:"pglink",sdata:t}));s&&(n?s.removeClass(this._myClassName("disabled")):s.addClass(this._myClassName("disabled")))},this)},_setModel:function(e){if(!e)return;return this.model=e,e},_modelPageChange:function(e){var t=e.newVal;t&&this._processPageChange(t)},_modelStateChange:function(e){e.silent||this.render()},_modelItemsChange:function(){this.render()},_updateRPPSelect:function(){var t=this.get("container"),n=this.get("model"),r=t.one("."+this._classSelectRPP),i=this.get("pageOptions"),s,o;i&&r&&e.Lang.isArray(i)&&(o=r.get("options"),r.empty(),e.Array.each(i,function(e){r.append('<option value="'+e+'">'+e+"</option>")})),r&&(s=n&&n.get("itemsPerPage")===n.get("totalItems")?!0:!1,o=r.get("options"),o.each(function(e){(e.get("value")==n.get("itemsPerPage")||e.get("value").search(/all/i)!==-1&&s)&&e.set("selected",!0)},this)),t.one("."+this._classSelectPage)&&this._updatePageSelect()},_updatePageSelect:function(){},_inputChangePage:function(e){var t=e.target,n=+t.get("value")||1,r=this.get("model");if(n<1||n>r.get("totalPages"))n=1,t.set("value",n);r.set("page",n)},_clickChangePage:function(e){var t=e.target,n=this.get("model"),r,i,s;e.preventDefault();if(e.target.hasClass(this._myClassName("disabled"))||e.currentTarget.hasClass(this._myClassName("disabled")))return;r=t.getData("pglink")||e.currentTarget.getData("pglink"),i=n.get("totalPages"),s=n.get("page");if(s&&s===r)return;switch(r){case"first":r=1;break;case"last":r=i;break;case"prev":r=s?s===1?i:s-1:1;break;case"next":r=s?s===i?1:s+1:1;break;default:r=+r}n.set("page",r)},_selectChangeRowOptions:function(t){var n=t.target,r=+n.get("value")||n.get("value");e.Lang.isString(r)&&r.toLowerCase()==="all"&&(r=this.get("model").get("totalItems")),this.get("model").set("itemsPerPage",r),this.render()}},{ATTRS:{model:{value:null,setter:"_setModel"},container:{value:null},pageOptions:{value:[10,20,"All"],validator:e.Lang.isArray},paginatorTemplate:{valueFn:function(){return this.TMPL_PAGINATOR}},pageLinkTemplate:{valueFn:function(){return this.TMPL_LINK}},linkHighLight:{value:!0,validator:e.Lang.isBoolean},maxPageLinks:{value:9999,validator:e.Lang.isNumber},linkListOffset:{value:1,validator:e.Lang.isNumber},pageLinkFiller:{value:"...",validator:e.Lang.isString},alwaysShowFirst:{value:!1,validator:e.Lang.isBoolean},alwaysShowLast:{value:!1,validator:e.Lang.isBoolean},selectPageFormat:{value:"Page {page}",validator:e.Lang.isString},circular:{value:!1,validator:e.Lang.isBoolean}}})},"gallery-2012.12.12-21-11",{requires:["model","view","substitute"],skinnable:"true"});
