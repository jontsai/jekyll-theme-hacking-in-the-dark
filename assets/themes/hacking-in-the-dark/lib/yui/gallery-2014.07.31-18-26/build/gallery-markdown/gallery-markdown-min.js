YUI.add("gallery-markdown",function(b){(function(L){var f=L.Markdown=function f(S){switch(typeof S){case"undefined":this.dialect=f.dialects.Gruber;break;case"object":this.dialect=S;break;default:if(S in f.dialects){this.dialect=f.dialects[S];}else{throw new Error("Unknown Markdown dialect '"+String(S)+"'");}break;}this.em_state=[];this.strong_state=[];this.debug_indent="";};L.parse=function(U,S){var T=new f(S);return T.toTree(U);};L.toHTML=function v(V,U,T){var S=L.toHTMLTree(V,U,T);return L.renderJsonML(S);};L.toHTMLTree=function x(T,X,V){if(typeof T==="string"){T=this.parse(T,X);}var U=D(T),S={};if(U&&U.references){S=U.references;}var W=j(T,S,V);r(W);return W;};function g(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )";}function I(){var S=require("util");return"Markdown.mk_block( "+S.inspect(this.toString())+", "+S.inspect(this.trailing)+", "+S.inspect(this.lineNumber)+" )";}var h=f.mk_block=function(V,T,S){if(arguments.length==1){T="\n\n";}var U=new String(V);U.trailing=T;U.inspect=I;U.toSource=g;if(S!=undefined){U.lineNumber=S;}return U;};function H(T){var U=0,S=-1;while((S=T.indexOf("\n",S+1))!==-1){U++;}return U;}f.prototype.split_blocks=function A(U,X){var V=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,W=[],S;var T=1;if((S=/^(\s*\n)/.exec(U))!=null){T+=H(S[0]);V.lastIndex=S[0].length;}while((S=V.exec(U))!==null){W.push(h(S[1],S[2],T));T+=H(S[0]);}return W;};f.prototype.processBlock=function N(X,W){var T=this.dialect.block,S=T.__order__;if("__call__" in T){return T.__call__.call(this,X,W);}for(var V=0;V<S.length;V++){var U=T[S[V]].call(this,X,W);if(U){if(!B(U)||(U.length>0&&!(B(U[0])))){this.debug(S[V],"didn't return a proper array");}return U;}}return[];};f.prototype.processInline=function i(S){return this.dialect.inline.__call__.call(this,String(S));};f.prototype.toTree=function J(U,T){var V=U instanceof Array?U:this.split_blocks(U);var W=this.tree;try{this.tree=T||this.tree||["markdown"];V:while(V.length){var S=this.processBlock(V.shift(),V);if(!S.length){continue V;}this.tree.push.apply(this.tree,S);}return this.tree;}finally{if(T){this.tree=W;}}};f.prototype.debug=function(){var S=Array.prototype.slice.call(arguments);S.unshift(this.debug_indent);if(typeof print!=="undefined"){print.apply(print,S);}if(typeof console!=="undefined"&&typeof console.log!=="undefined"){console.log.apply(null,S);}};f.prototype.loop_re_over_block=function(V,W,U){var T,S=W.valueOf();while(S.length&&(T=V.exec(S))!=null){S=S.substr(T[0].length);U.call(this,T);}return S;};f.dialects={};f.dialects.Gruber={block:{atxHeader:function t(U,T){var S=U.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!S){return undefined;}var V=["header",{level:S[1].length}];Array.prototype.push.apply(V,this.processInline(S[2]));if(S[0].length<U.length){T.unshift(h(U.substr(S[0].length),U.trailing,U.lineNumber+2));}return[V];},setextHeader:function y(U,T){var S=U.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!S){return undefined;}var W=(S[2]==="=")?1:2;var V=["header",{level:W},S[1]];if(S[0].length<U.length){T.unshift(h(U.substr(S[0].length),U.trailing,U.lineNumber+2));}return[V];},code:function m(X,W){var U=[],V=/^(?: {0,3}\t| {4})(.*)\n?/,T;if(!X.match(V)){return undefined;}block_search:do{var S=this.loop_re_over_block(V,X.valueOf(),function(Y){U.push(Y[1]);});if(S.length){W.unshift(h(S,X.trailing));break block_search;}else{if(W.length){if(!W[0].match(V)){break block_search;}U.push(X.trailing.replace(/[^\n]/g,"").substring(2));X=W.shift();}else{break block_search;}}}while(true);return[["code_block",U.join("\n")]];},horizRule:function Q(U,T){var S=U.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!S){return undefined;}var V=[["hr"]];if(S[1]){V.unshift.apply(V,this.processBlock(S[1],[]));}if(S[3]){T.unshift(h(S[3]));}return V;},lists:(function(){var V="[*+-]|\\d+\\.",T=/[*+-]/,ab=/\d+\./,Z=new RegExp("^( {0,3})("+V+")[ \t]+"),U="(?: {0,3}\\t| {4})";function W(ac){return new RegExp("(?:^("+U+"{0,"+ac+"} {0,3})("+V+")\\s+)|"+"(^"+U+"{0,"+(ac-1)+"}[ ]{0,4})");}function S(ac){return ac.replace(/ {0,3}\t/g,"    ");}function aa(ad,aj,ai,ae){if(aj){ad.push(["para"].concat(ai));return;}var ac=ad[ad.length-1] instanceof Array&&ad[ad.length-1][0]=="para"?ad[ad.length-1]:ad;if(ae&&ad.length>1){ai.unshift(ae);}for(var ag=0;ag<ai.length;ag++){var ah=ai[ag],af=typeof ah=="string";if(af&&ac.length>1&&typeof ac[ac.length-1]=="string"){ac[ac.length-1]+=ah;}else{ac.push(ah);}}}function X(ai,ah){var ag=new RegExp("^("+U+"{"+ai+"}.*?\\n?)*$"),af=new RegExp("^"+U+"{"+ai+"}","gm"),ae=[];while(ah.length>0){if(ag.exec(ah[0])){var ad=ah.shift(),ac=ad.replace(af,"");ae.push(h(ac,ad.trailing,ad.lineNumber));}break;}return ae;}function Y(af,ae,ac){var ah=af.list;var ag=ah[ah.length-1];if(ag[1] instanceof Array&&ag[1][0]=="para"){return;}if(ae+1==ac.length){ag.push(["para"].concat(ag.splice(1)));}else{var ad=ag.pop();ag.push(["para"].concat(ag.splice(1)),ad);}}return function(ah,an){var ao=ah.match(Z);if(!ao){return undefined;}function af(ay){var az=T.exec(ay[2])?["bulletlist"]:["numberlist"];ag.push({list:az,indent:ay[1]});return az;}var ag=[],at=af(ao),ae,am=false,ax=[ag[0].list],aq;loose_search:while(true){var ac=ah.split(/(?=\n)/);var au="";tight_search:for(var av=0;av<ac.length;av++){var ad="",ap=ac[av].replace(/^\n/,function(ay){ad=ay;return"";});var ak=W(ag.length);ao=ap.match(ak);if(ao[1]!==undefined){if(au.length){aa(ae,am,this.processInline(au),ad);am=false;au="";}ao[1]=S(ao[1]);var ai=Math.floor(ao[1].length/4)+1;if(ai>ag.length){at=af(ao);ae.push(at);ae=at[1]=["listitem"];}else{var al=false;for(aq=0;aq<ag.length;aq++){if(ag[aq].indent!=ao[1]){continue;}at=ag[aq].list;ag.splice(aq+1);al=true;break;}if(!al){ai++;if(ai<=ag.length){ag.splice(ai);at=ag[ai-1].list;}else{at=af(ao);ae.push(at);}}ae=["listitem"];at.push(ae);}ad="";}if(ap.length>ao[0].length){au+=ad+ap.substr(ao[0].length);}}if(au.length){aa(ae,am,this.processInline(au),ad);am=false;au="";}var ar=X(ag.length,an);
if(ar.length>0){d(ag,Y,this);ae.push.apply(ae,this.toTree(ar,[]));}var aj=an[0]&&an[0].valueOf()||"";if(aj.match(Z)||aj.match(/^ /)){ah=an.shift();var aw=this.dialect.block.horizRule(ah,an);if(aw){ax.push.apply(ax,aw);break;}d(ag,Y,this);am=true;continue loose_search;}break;}return ax;};})(),blockquote:function M(X,V){if(!X.match(/^>/m)){return undefined;}var Z=[];if(X[0]!=">"){var T=X.split(/\n/),W=[];while(T.length&&T[0][0]!=">"){W.push(T.shift());}X=T.join("\n");Z.push.apply(Z,this.processBlock(W.join("\n"),[]));}while(V.length&&V[0][0]==">"){var S=V.shift();X=new String(X+X.trailing+S);X.trailing=S.trailing;}var U=X.replace(/^> ?/gm,""),Y=this.tree;Z.push(this.toTree(U,["blockquote"]));return Z;},referenceDefn:function K(W,V){var U=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!W.match(U)){return undefined;}if(!D(this.tree)){this.tree.splice(1,0,{});}var T=D(this.tree);if(T.references===undefined){T.references={};}var S=this.loop_re_over_block(U,W,function(X){if(X[2]&&X[2][0]=="<"&&X[2][X[2].length-1]==">"){X[2]=X[2].substring(1,X[2].length-1);}var Y=T.references[X[1].toLowerCase()]={href:X[2]};if(X[4]!==undefined){Y.title=X[4];}else{if(X[5]!==undefined){Y.title=X[5];}}});if(S.length){V.unshift(h(S,W.trailing));}return[];},para:function E(T,S){return[["para"].concat(this.processInline(T))];}}};f.dialects.Gruber.inline={__oneElement__:function e(X,T,W){var S,U,Y=0;T=T||this.dialect.inline.__patterns__;var V=new RegExp("([\\s\\S]*?)("+(T.source||T)+")");S=V.exec(X);if(!S){return[X.length,X];}else{if(S[1]){return[S[1].length,S[1]];}}var U;if(S[2] in this.dialect.inline){U=this.dialect.inline[S[2]].call(this,X.substr(S.index),S,W||[]);}U=U||[S[2].length,S[2]];return U;},__call__:function s(W,U){var S=[],T;function V(X){if(typeof X=="string"&&typeof S[S.length-1]=="string"){S[S.length-1]+=X;}else{S.push(X);}}while(W.length>0){T=this.dialect.inline.__oneElement__.call(this,W,U,S);W=W.substr(T.shift());d(T,V);}return S;},"]":function(){},"}":function(){},"\\":function u(S){if(S.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)){return[2,S[1]];}else{return[1,"\\"];}},"![":function n(U){var S=U.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(S){if(S[2]&&S[2][0]=="<"&&S[2][S[2].length-1]==">"){S[2]=S[2].substring(1,S[2].length-1);}S[2]=this.dialect.inline.__call__.call(this,S[2],/\\/)[0];var T={alt:S[1],href:S[2]||""};if(S[4]!==undefined){T.title=S[4];}return[S[0].length,["img",T]];}S=U.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/);if(S){return[S[0].length,["img_ref",{alt:S[1],ref:S[2].toLowerCase(),original:S[0]}]];}return[2,"!["];},"[":function o(ac){var Z=String(ac);var X=f.DialectHelpers.inline_until_char.call(this,ac.substr(1),"]");if(!X){return[1,"["];}var aa=1+X[0],T=X[1],Y,ab;ac=ac.substr(aa);var V=ac.match(/^\s*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(V){var S=V[1];aa+=V[0].length;if(S&&S[0]=="<"&&S[S.length-1]==">"){S=S.substring(1,S.length-1);}if(!V[3]){var U=1;for(var W=0;W<S.length;W++){switch(S[W]){case"(":U++;break;case")":if(--U==0){aa-=S.length-W;S=S.substring(0,W);}break;}}}S=this.dialect.inline.__call__.call(this,S,/\\/)[0];ab={href:S||""};if(V[3]!==undefined){ab.title=V[3];}Y=["link",ab].concat(T);return[aa,Y];}V=ac.match(/^\s*\[(.*?)\]/);if(V){aa+=V[0].length;ab={ref:(V[1]||String(T)).toLowerCase(),original:Z.substr(0,aa)};Y=["link_ref",ab].concat(T);return[aa,Y];}if(T.length==1&&typeof T[0]=="string"){ab={ref:T[0].toLowerCase(),original:Z.substr(0,aa)};Y=["link_ref",ab,T[0]];return[aa,Y];}return[1,"["];},"<":function w(T){var S;if((S=T.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))!=null){if(S[3]){return[S[0].length,["link",{href:"mailto:"+S[3]},S[3]]];}else{if(S[2]=="mailto"){return[S[0].length,["link",{href:S[1]},S[1].substr("mailto:".length)]];}else{return[S[0].length,["link",{href:S[1]},S[1]]];}}}return[1,"<"];},"`":function z(T){var S=T.match(/(`+)(([\s\S]*?)\1)/);if(S&&S[2]){return[S[1].length+S[2].length,["inlinecode",S[3]]];}else{return[1,"`"];}},"  \n":function P(S){return[3,["linebreak"]];}};function G(S,V){var U=S+"_state",W=S=="strong"?"em_state":"strong_state";function T(X){this.len_after=X;this.name="close_"+V;}return function(ae,ad){if(this[U][0]==V){this[U].shift();return[ae.length,new T(ae.length-V.length)];}else{var X=this[W].slice(),ac=this[U].slice();this[U].unshift(V);var Z=this.processInline(ae.substr(V.length));var aa=Z[Z.length-1];var Y=this[U].shift();if(aa instanceof T){Z.pop();var ab=ae.length-aa.len_after;return[ab,[S].concat(Z)];}else{this[W]=X;this[U]=ac;return[V.length,V];}}};}f.dialects.Gruber.inline["**"]=G("strong","**");f.dialects.Gruber.inline["__"]=G("strong","__");f.dialects.Gruber.inline["*"]=G("em","*");f.dialects.Gruber.inline["_"]=G("em","_");f.buildBlockOrder=function(U){var S=[];for(var T in U){if(T=="__order__"||T=="__call__"){continue;}S.push(T);}U.__order__=S;};f.buildInlinePatterns=function(W){var V=[];for(var T in W){if(T.match(/^__.*__$/)){continue;}var S=T.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");V.push(T.length==1?S:"(?:"+S+")");}V=V.join("|");W.__patterns__=V;var U=W.__call__;W.__call__=function(Y,X){if(X!=undefined){return U.call(this,Y,X);}else{return U.call(this,Y,V);}};};f.DialectHelpers={};f.DialectHelpers.inline_until_char=function(V,U){var T=0,S=[];while(true){if(V[T]==U){T++;return[T,S];}if(T>=V.length){return null;}res=this.dialect.inline.__oneElement__.call(this,V.substr(T));T+=res[0];S.push.apply(S,res.slice(1));}};f.subclassDialect=function(U){function S(){}S.prototype=U.block;function T(){}T.prototype=U.inline;return{block:new S(),inline:new T()};};f.buildBlockOrder(f.dialects.Gruber.block);f.buildInlinePatterns(f.dialects.Gruber.inline);f.dialects.Maruku=f.subclassDialect(f.dialects.Gruber);f.dialects.Maruku.processMetaHash=function l(V){var W=q(V),S={};for(var T=0;T<W.length;++T){if(/^#/.test(W[T])){S.id=W[T].substring(1);}else{if(/^\./.test(W[T])){if(S["class"]){S["class"]=S["class"]+W[T].replace(/./," ");}else{S["class"]=W[T].substring(1);
}}else{if(/\=/.test(W[T])){var U=W[T].split(/\=/);S[U[0]]=U[1];}}}}return S;};function q(U){var W=U.split(""),V=[""],S=false;while(W.length){var T=W.shift();switch(T){case" ":if(S){V[V.length-1]+=T;}else{V.push("");}break;case"'":case'"':S=!S;break;case"\\":T=W.shift();default:V[V.length-1]+=T;break;}}return V;}f.dialects.Maruku.block.document_meta=function k(X,U){if(X.lineNumber>1){return undefined;}if(!X.match(/^(?:\w+:.*\n)*\w+:.*$/)){return undefined;}if(!D(this.tree)){this.tree.splice(1,0,{});}var W=X.split(/\n/);for(p in W){var S=W[p].match(/(\w+):\s*(.*)$/),T=S[1].toLowerCase(),V=S[2];this.tree[1][T]=V;}return[];};f.dialects.Maruku.block.block_meta=function F(Z,W){var V=Z.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!V){return undefined;}var U=this.dialect.processMetaHash(V[2]);var Y;if(V[1]===""){var X=this.tree[this.tree.length-1];Y=D(X);if(typeof X==="string"){return undefined;}if(!Y){Y={};X.splice(1,0,Y);}for(a in U){Y[a]=U[a];}return[];}var T=Z.replace(/\n.*$/,""),S=this.processBlock(T,[]);Y=D(S[0]);if(!Y){Y={};S[0].splice(1,0,Y);}for(a in U){Y[a]=U[a];}return S;};f.dialects.Maruku.block.definition_list=function O(U,X){var Z=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,Y=["dl"],W;if((T=U.match(Z))){var S=[U];while(X.length&&Z.exec(X[0])){S.push(X.shift());}for(var aa=0;aa<S.length;++aa){var T=S[aa].match(Z),V=T[1].replace(/\n$/,"").split(/\n/),ab=T[2].split(/\n:\s+/);for(W=0;W<V.length;++W){Y.push(["dt",V[W]]);}for(W=0;W<ab.length;++W){Y.push(["dd"].concat(this.processInline(ab[W].replace(/(\n)\s+/,"$1"))));}}}else{return undefined;}return[Y];};f.dialects.Maruku.inline["{:"]=function C(Z,X,V){if(!V.length){return[2,"{:"];}var W=V[V.length-1];if(typeof W==="string"){return[2,"{:"];}var T=Z.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!T){return[2,"{:"];}var Y=this.dialect.processMetaHash(T[1]),S=D(W);if(!S){S={};W.splice(1,0,S);}for(var U in Y){S[U]=Y[U];}return[T[0].length,""];};f.buildBlockOrder(f.dialects.Maruku.block);f.buildInlinePatterns(f.dialects.Maruku.inline);var B=Array.isArray||function(S){return Object.prototype.toString.call(S)=="[object Array]";};var d;if(Array.prototype.forEach){d=function(T,S,U){return T.forEach(S,U);};}else{d=function(T,S,V){for(var U=0;U<T.length;U++){S.call(V||T,T[U],U,T);}};}function D(S){return B(S)&&S.length>1&&typeof S[1]==="object"&&!(B(S[1]))?S[1]:undefined;}L.renderJsonML=function(U,S){S=S||{};S.root=S.root||false;var T=[];if(S.root){T.push(R(U));}else{U.shift();if(U.length&&typeof U[0]==="object"&&!(U[0] instanceof Array)){U.shift();}while(U.length){T.push(R(U.shift()));}}return T.join("\n\n");};function c(S){return S.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");}function R(X){if(typeof X==="string"){return c(X);}var S=X.shift(),U={},V=[];if(X.length&&typeof X[0]==="object"&&!(X[0] instanceof Array)){U=X.shift();}while(X.length){V.push(arguments.callee(X.shift()));}var W="";for(var T in U){W+=" "+T+'="'+c(U[T])+'"';}if(S=="img"||S=="br"||S=="hr"){return"<"+S+W+"/>";}else{return"<"+S+W+">"+V.join("")+"</"+S+">";}}function j(aa,X,Z){var U;Z=Z||{};var W=aa.slice(0);if(typeof Z.preprocessTreeNode==="function"){W=Z.preprocessTreeNode(W,X);}var Y=D(W);if(Y){W[1]={};for(U in Y){W[1][U]=Y[U];}Y=W[1];}if(typeof W==="string"){return W;}switch(W[0]){case"header":W[0]="h"+W[1].level;delete W[1].level;break;case"bulletlist":W[0]="ul";break;case"numberlist":W[0]="ol";break;case"listitem":W[0]="li";break;case"para":W[0]="p";break;case"markdown":W[0]="html";if(Y){delete Y.references;}break;case"code_block":W[0]="pre";U=Y?2:1;var S=["code"];S.push.apply(S,W.splice(U));W[U]=S;break;case"inlinecode":W[0]="code";break;case"img":W[1].src=W[1].href;delete W[1].href;break;case"linebreak":W[0]="br";break;case"link":W[0]="a";break;case"link_ref":W[0]="a";var T=X[Y.ref];if(T){delete Y.ref;Y.href=T.href;if(T.title){Y.title=T.title;}delete Y.original;}else{return Y.original;}break;case"img_ref":W[0]="img";var T=X[Y.ref];if(T){delete Y.ref;Y.src=T.href;if(T.title){Y.title=T.title;}delete Y.original;}else{return Y.original;}break;}U=1;if(Y){for(var V in W[1]){U=2;}if(U===1){W.splice(U,1);}}for(;U<W.length;++U){W[U]=arguments.callee(W[U],X,Z);}return W;}function r(T){var S=D(T)?2:1;while(S<T.length){if(typeof T[S]==="string"){if(S+1<T.length&&typeof T[S+1]==="string"){T[S]+=T.splice(S+1,1)[0];}else{++S;}}else{arguments.callee(T[S]);++S;}}}})((function(){if(typeof b!=="undefined"){return b.namespace("Markdown");}else{if(typeof exports==="undefined"){window.markdown={};return window.markdown;}else{return exports;}}})());},"gallery-2012.07.18-13-22");