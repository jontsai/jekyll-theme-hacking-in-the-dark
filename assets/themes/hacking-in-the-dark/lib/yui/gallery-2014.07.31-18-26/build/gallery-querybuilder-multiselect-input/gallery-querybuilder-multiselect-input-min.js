YUI.add("gallery-querybuilder-multiselect-input",function(e,t){e.QueryBuilder.MultiselectInput=function(e,t){this.qb=e,this.op_menu_name_pattern=t.field_prefix+"query_op_{i}",this.val_input_name_pattern=t.field_prefix+"query_val_{i}"},e.QueryBuilder.MultiselectInput.Strings={required:"Please enter at least one value."},e.QueryBuilder.MultiselectInput.prototype={create:function(t,n,r,i){i=i||["",null];if(r.length>1){var s=this.qb._createContainer();s.set("className",this.qb.getClassName("operator")),s.set("innerHTML",this._operationsMenu(this.operationName(t))),this.op_menu=s.one("select");var o=e.Node.getDOMNode(this.op_menu).options;for(var u=0;u<r.length;u++)o[u]=new Option(r[u].text,r[u].value);i[0]&&this.op_menu.set("value",i[0]),e.QueryBuilder.Env.has_bubble_problem&&this.op_menu.on("change",this.qb._notifyChanged,this.qb)}else this.db_query_equals=r[0];var a=this.qb._createContainer();return a.set("className",this.qb.getClassName("value")),a.set("innerHTML",this._valueInput(this.valueName(t))),this.value_input=a.one("input"),[s,a]},postCreate:function(t,n,r,i){i=i||["",null],e.Lang.later(1,this,function(){if(this.value_input){this.value_input.plug(e.Plugin.AutoComplete,{resultFilters:"phraseMatch",resultHighlighter:"phraseMatch",source:n.value_list,render:e.one("body")}),n.autocomplete&&n.autocomplete.containerClassName&&this.value_input.ac.get("boundingBox").addClass(n.autocomplete.containerClassName),this.value_input.plug(e.Plugin.MultivalueInput,{values:i[1]});try{this.value_input.focus()}catch(t){}}})},destroy:function(){this.value_input.unplug&&(this.value_input.unplug(e.Plugin.MultivalueInput),this.value_input.unplug(e.Plugin.AutoComplete)),this.op_menu=null,this.value_input=null},updateName:function(e){this.op_menu&&this.op_menu.setAttribute("name",this.operationName(e)),this.value_input.setAttribute("name",this.valueName(e))},toDatabaseQuery:function(){var e=this.op_menu?this.op_menu.get("value"):this.db_query_equals;return[[e,this.value_input.mvi.get("values")]]},validate:function(){return this.value_input.mvi.get("values").length===0?(this.qb.displayFieldMessage(this.value_input,e.QueryBuilder.MultiselectInput.Strings.required,"error"),!1):!0},operationName:function(t){return e.Lang.sub(this.op_menu_name_pattern,{i:t})},valueName:function(t){return e.Lang.sub(this.val_input_name_pattern,{i:t})},_operationsMenu:function(t){var n='<select name="{n}" class="{f} {c}" />';return e.Lang.sub(n,{n:t,f:e.FormManager.field_marker_class,c:this.qb.getClassName("field")})},_valueInput:function(t){var n='<input type="text" name="{n}" class="{f} {c}"/>';return e.Lang.sub(n,{n:t,f:e.FormManager.field_marker_class,c:this.qb.getClassName("field")})}},e.QueryBuilder.plugin_mapping["multiselect-input"]=e.QueryBuilder.MultiselectInput},"gallery-2013.05.29-23-38",{requires:["gallery-querybuilder","gallery-multivalue-input","autocomplete","autocomplete-filters","autocomplete-highlighters"]});
