YUI.add("gallery-deferred",function(g){var f=[].slice,b=g.Lang.isArray;function d(){this._subs={resolve:[],reject:[]};this._promise=new g.Promise(this);this._status="in progress";}g.mix(d.prototype,{promise:function(h){return g.Lang.isObject(h)?g.mix(h,this._promise,true):this._promise;},resolve:function(){this._result=f.call(arguments);this._notify(this._subs.resolve,this.promise(),this._result);this._subs={resolve:[]};this._status="resolved";return this;},reject:function(){this._result=f.call(arguments);this._notify(this._subs.reject,this.promise(),this._result);this._subs={reject:[]};this._status="rejected";return this;},then:function(n,i){var m=new g.Deferred(),l=this.promise(),j=this._subs.resolve||[],h=this._subs.reject||[];function k(o,p){return function(){var q=f.call(arguments);(g.soon||setTimeout)(function(){var s=o.apply(l,q),r;if(s&&typeof s.promise==="function"){r=s.promise();if(r.getStatus()!=="in progress"){m[p].apply(m,r.getResult());}else{s.promise().then(g.bind(m.resolve,m),g.bind(m.reject,m));}}else{m[p].apply(m,(b(s)?s:[s]));}},0);};}j.push((typeof n==="function")?k(n,"resolve"):g.bind("resolve",m));h.push((typeof i==="function")?k(i,"reject"):g.bind("reject",m));if(this._status==="resolved"){this.resolve.apply(this,this._result);}else{if(this._status==="rejected"){this.reject.apply(this,this._result);}}j=h=null;return m.promise();},getStatus:function(){return this._status;},getResult:function(){return this._result;},_notify:function(m,l,j){var k,h;if(m){for(k=0,h=m.length;k<h;++k){m[k].apply(l,j);}}}},true);g.Deferred=d;function e(i){var h=this;g.Array.each(["then","promise","getStatus","getResult"],function(j){h[j]=function(){return i[j].apply(i,arguments);};});}g.Promise=e;g.defer=function(j,i){var h=new g.Deferred();j(h);return h.promise();};g.when=function(){var j=f.call(arguments),h=new g.Deferred(),i=g.bind("reject",h),l=j.length,k=[];function m(n){return function(){var o=f.call(arguments);k[n]=o.length>1?o:o[0];l--;if(!l&&h.getStatus()!=="rejected"){h.resolve.apply(h,k);}};}g.Array.each(j,function(p,o){var q=m(o),n;if(typeof p==="function"){n=new g.Deferred();n.then(q,i);p.call(g,n);}else{if(p&&typeof p.then==="function"){p.then(q,i);}else{l--;k[o]=p;}}});j=null;if(!l){h.resolve.apply(h,k);}return h.promise();};function a(h){this.host=h.host;this._config=h;}a.prototype.then=function(h){return new g.Deferred().resolve().then(h).promise();};g.mix(a,{NS:"deferred",deferMethod:function(h){a.prototype[h]=function(){var k=this.host,i=f.call(arguments),l,j;if(typeof i[i.length-1]==="function"){l=i.pop();}j=this.then(function(){var m=new g.Deferred();k[h].apply(k,i.concat([function(){m.resolve.apply(m,arguments);}]));return l?m.then(l):m.promise();});return j.promise(new this.constructor(this._config));};},importMethod:function(h){a.prototype[h]=function(){var i=arguments,j=this.host;return this.then(function(){j[h].apply(j,i);});};}});g.Array.each(["hide","load","show","transition","once","onceAfter"],a.deferMethod);g.Array.each(["addClass","append","appendTo","blur","clearData","destroy","empty","focus","insert","insertBefore","prepend","remove","removeAttribute","removeChild","removeClass","replaceChild","replaceClass","select","set","setAttrs","setContent","setData","setStyle","setStyles","setX","setXY","setY","simulate","swapXY","toggleClass","wrap","unwrap"],a.importMethod);if(g.Node&&g.Plugin){g.Plugin.NodeDeferred=a;}function c(){}c.NAME="transaction";if(g.io){g.Transaction=c;g.mix(g.io,{_normalizeConfig:function(i,h){if(g.Lang.isFunction(i)){i={on:{complete:i}};}else{i=i||{};i.on=i.on||{};}return g.merge(i,h);},_eventsToCallbacks:function(i,h){if(h.success||h.failure){i=i.then(h.success,h.failure);}if(h.complete){i=i.then(h.complete,h.complete);}return i;},addMethod:function(h,i){g.io[h]=i;c.prototype[h]=i;},addMethods:function(h){g.Object.each(h,function(j,i){g.io.addMethod(i,j);});},then:function(h){return new g.Deferred().resolve().then(h).promise(new g.Transaction());}});g.io.addMethods({_deferIO:function(m,k){var j=new g.Deferred(),i=this,h=k.on,l;k.on={success:function(p,n){if(k.parser){try{n.data=k.parser(n.responseText);}catch(o){j.reject.apply(j,arguments);return;}}j.resolve.apply(j,arguments);},failure:function(){j.reject.apply(j,arguments);}};l=this.then(function(){var o=g.io(m,k),n=j.promise(new i.constructor());n.abort=function(){if(o){o.abort();}j.reject.apply(j,arguments);};return n;});if(h){l=g.io._eventsToCallbacks(l,h);}return l.promise(new g.Transaction());},_deferGet:function(l,j,h){var k,i;if(g.Lang.isFunction(h)){k=h;h={};}if(!h){h={};}i=this.then(function(){var m=new g.Deferred();g.Get[l](j,h,function(n){if(n){m.reject(n);}else{m.resolve();}});return m.promise();});if(k){i=i.then(k,k);}if(h.on){i=g.io._eventsToCallbacks(i,h.on);}return i.promise(new g.Transaction());},get:function(i,h){return this._deferIO(i,g.io._normalizeConfig(h,{method:"GET"}));},post:function(i,j,h){return this._deferIO(i,g.io._normalizeConfig(h,{method:"POST",data:j}));},put:function(i,j,h){return this._deferIO(i,g.io._normalizeConfig(h,{method:"PUT",data:j}));},del:function(i,j,h){return this._deferIO(i,g.io._normalizeConfig(h,{method:"DELETE",data:j}));},postForm:function(i,j,h){return this._deferIO(i,g.io._normalizeConfig(h,{method:"POST",form:{id:j}}));},script:function(){return this.js.apply(this,arguments);},js:function(i,h){return this._deferGet("js",i,h);},css:function(i,h){return this._deferGet("css",i,h);}});if(g.JSON){g.io.addMethod("getJSON",function(i,h){h=g.io._normalizeConfig(h);h.parser=g.JSON.parse;return this._deferIO(i,h);});}if(g.jsonp){g.io.addMethod("jsonp",function(k,i){var h,j;i=g.io._normalizeConfig(i);h=i.on;j=this.then(function(){var l=new g.Deferred(),m=function(){l.reject.apply(l,arguments);};i.on={success:function(o,n){l.resolve.apply(l,arguments);},failure:m,timeout:m};g.jsonp(k,i);return l.promise();});if(h){j=g.io._eventsToCallbacks(j,h);}return j.promise(new g.Transaction());});}}},"gallery-2012.10.17-20-00",{optional:["node","plugin","node-load","transition","io-base","json","jsonp"]});
