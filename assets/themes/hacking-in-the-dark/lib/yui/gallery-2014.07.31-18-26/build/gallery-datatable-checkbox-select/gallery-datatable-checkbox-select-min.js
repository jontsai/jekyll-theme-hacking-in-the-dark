YUI.add("gallery-datatable-checkbox-select",function(a){DtCheckboxSelect=function(){};a.mix(DtCheckboxSelect.prototype,{_subscrChkAll:null,_subscrChk:null,_chkRecords:[],tmplTH:'<input type="checkbox" class="{className}" title="{columnTitleTH}"/>',colSelect:"chkSelect",initializer:function(){return this;},destructor:function(){this._unbindCheckboxSelect();this._chkRecords=null;},checkboxSelectAll:function(){this._chkRecords=[];this.data.each(function(c){var b=this._getPKValues(c);if(b){this._chkRecords.push(b);}},this);this._uiCheckboxSetEach(true);this._uiAllChecksSet(true);this.fire("checkboxSetAll");},checkboxClearAll:function(){this._chkRecords=[];this._uiCheckboxSetEach(false);this._uiAllChecksSet(false);this.fire("checkboxClearAll");},_bindCheckboxSelect:function(){this._subscrChk=this.delegate("click",this._onCheckboxSelect,"tr ."+this.getClassName("checkbox","select"),this);this._subscrChkAll=this.delegate("click",this._onCheckboxSelectAll,"."+this.getClassName("checkbox","select","all"),this);},_unbindCheckboxSelect:function(){if(this._subscrChk){this._subscrChk.detach();}this._subscrChk=null;if(this._subscrChkAll){this._subscrChkAll.detach();}this._subscrChkAll=null;},_enableCheckboxSelect:function(){this._chkRecords=[];this._uiAddCheckboxTH();this._bindCheckboxSelect();},_disableCheckboxSelect:function(){this.checkboxClearAll();this._uiRemoveCheckboxTH();this._unbindCheckboxSelect();},_setCheckboxSelectMode:function(b){if(b){this._enableCheckboxSelect();}else{this._disableCheckboxSelect();}},_getCheckboxSelected:function(){var b=[];a.Array.each(this._chkRecords,function(c){var d=this._getRecordforPKvalue(c);b.push({tr:this.getRow(d),record:d,pkvalues:c});},this);return b;},_setCheckboxSelected:function(e){if(!a.Lang.isArray(e)){return false;}this.checkboxClearAll();var d=[],c,f,g,b;a.Array.each(e,function(h){f=this.data.item(h);g=this._getPKValues(f);c=this.getRow(f);if(f&&g){this._chkRecords.push(g);b=c.one("."+this.getClassName("checkbox","select"));if(b){b.set("checked",true);}}},this);return e;},_getCheckboxSelectedFlag:function(d){var b=this._getPKValues(d),c=false;if(a.Lang.isObject(b)){c=this._indexOfObjMatch(this._chkRecords,b);}else{c=a.Array.indexOf(this._chkRecords,b);}return(c!==-1)?true:false;},_onCheckboxSelect:function(f){var b=f.target,d=b.ancestor("tr"),g=this.getRecord(d),h=this._getPKValues(g);if(f.target.get("checked")){this._chkRecords.push(h);}else{var c=[];a.Array.each(this._chkRecords,function(e){if(e!==h){c.push(e);}});this._chkRecords=c;}},_onCheckboxSelectAll:function(d){var b=d.target,c=b.ancestor("tr"),f=this.getRecord(c);if(d.target.get("checked")){this.checkboxSelectAll();}else{this.checkboxClearAll();}},_uiAddCheckboxTH:function(){var b={key:this.colSelect,allowHTML:true,label:a.Lang.sub(this.tmplTH,{className:this.getClassName("checkbox","select","all"),columnTitleTH:"Select ALL records"}),formatter:function(e){var d=(this._getCheckboxSelectedFlag(e.record))?"checked":"";e.value='<input type="checkbox" class="'+this.getClassName("checkbox","select")+'" '+d+"/>";e.className+=" center";}};var c=this.get("columns");if(!this.getColumn(this.colSelect)){this.addColumn(b,0);this.syncUI();}},_uiRemoveCheckboxTH:function(){this.removeColumn(this.colSelect);this.syncUI();},_uiCheckboxSetEach:function(c){var b=this.get("srcNode").all("."+this.getClassName("data")+" ."+this.getClassName("checkbox","select"));b.each(function(d){d.set("checked",c);});},_uiAllChecksSet:function(c){var b=this.get("srcNode").one("."+this.getClassName("checkbox","select","all"));if(b){b.set("checked",c);}},_valPrimaryKeys:function(){var c=this.get("columns"),b=[];a.Array.each(c,function(e){if(e&&e.primaryKey&&e.primaryKey===true){var d=e.key||e.name||null;if(d){b.push(d);}}});return b;},_setPrimaryKeys:function(b){if(a.Lang.isArray(b)){pks=b;}else{if(a.Lang.isString(b)){pks=[b];}}return pks;},_getRecordforPKvalue:function(d){var c=this.get("primaryKeys");var b=this.data.filter(function(f){if(a.Lang.isObject(d)){var e=true;a.Object.each(d,function(h,g){if(f.get(g)!==h){e=false;}});if(e){return true;}}else{if(f.get(c[0])===d){return true;}}});return(b&&b.length===1)?b[0]:b;},_getPKValues:function(d){var c=this.get("primaryKeys");if(!c||!a.Lang.isArray(c)||!d){return false;}var b;if(c.length===1){b=d.get(c[0]);}else{b={};a.Array.each(c,function(e){if(e){b[e]=d.get(e);}});}return b;},_indexOfObjMatch:function(c,b){if(!a.Lang.isObject(b)||!a.Lang.isArray(c)){return -1;}var d=-1;a.Array.some(c,function(g,f){var e=true;a.Object.each(b,function(i,h){if(g[h]!==i){e=false;}});if(e){d=f;return true;}});return d;}});DtCheckboxSelect.ATTRS={checkboxSelectMode:{value:false,validator:a.Lang.isBoolean,setter:"_setCheckboxSelectMode"},checkboxSelected:{value:[],validator:a.Lang.isArray,setter:"_setCheckboxSelected",getter:"_getCheckboxSelected"},primaryKeys:{valueFn:"_valPrimaryKeys",setter:"_setPrimaryKeys"}};a.DataTable.CheckboxSelect=DtCheckboxSelect;a.Base.mix(a.DataTable,[a.DataTable.CheckboxSelect]);},"gallery-2012.09.12-20-02",{requires:["datatable-base","datatable-mutable","event-custom"],skinnable:false});