YUI.add("gallery-md-model",function(c){var h=c.Lang,m=c.Array,e=c.Object,n="change",r="loaded",b="error",k="saved",j="reset",v="isModified",x="isNew",t=".",p="Change",q="add",i="undo",f=function(){};c.GalleryModel=c.Base.create(NAME,c.Base,[],{_values:null,_loadedValues:null,_primaryKeys:null,initializer:function(y){this._values={};this._loadedValues={};this.publish(n,{defaultFn:this._defSetValue});this.publish(r,{defaultFn:this._defDataLoaded,preventedFn:this._stoppedDataLoaded,stoppedFn:this._stoppedDataLoaded});this.publish(k,{preventable:false});y=y||{};if(h.isObject(y.values)){this.after("init",this._setInitialValues);}},_setInitialValues:function(y){this.setValues(y.cfg.values,"init");this._set(v,false);this._set(x,true);this._loadedValues=c.clone(this._values);},destroy:function(z,B){if(h.isFunction(z)){B=z;z={};}else{if(!z){z={};}}B=B||f;var y=this,A=function(C){if(!C){m.each(y.lists.concat(),function(D){D.remove(y,z);});c.GalleryModel.superclass.destroy.call(y);}B.apply(y,arguments);};if(z.remove){this.sync("delete",z,A);}else{A();}return this;},getValue:function(y){return this._values[y];},getValues:function(){return c.clone(this._values);},setValue:function(y,z,A){var B=this._values[y];if(B!==z&&(this._primaryKeys.indexOf(y)===-1||h.isUndefined(B))){this.fire(n,{name:y,newVal:z,prevVal:B,src:A});}return this;},_defSetValue:function(z){var y=this;if(z.name){y._values[z.name]=z.newVal;y._set(v,true);}else{e.each(z.newVals,function(B,A){y.setValue(A,B,z.src);});}},setValues:function(A,B){var z=this,y={};e.each(A,function(D,C){y[C]=z.getValue(C);});this.fire(n,{newVals:A,prevVals:y,src:B});return z;},getChangedValues:function(){var A={},z,y=this._loadedValues;e.each(this._values,function(C,B){z=y[B];if(z!==C){A[B]={prevVal:z,newVal:C};}});return A;},getPKValues:function(){var z={},y=this;m.each(y._primaryKeys,function(A){z[A]=y._values[A];});return z;},getAsHTML:function(y){var z=this.getValue(y);return c.Escape.html(h.isValue(z)?String(z):"");},getAsURL:function(z){var A=this.getValue(z),y=[];if(z){return encodeURIComponent(h.isValue(A)?String(A):"");}e.each(A,function(C,B){if(h.isValue(C)){y.push(encodeURIComponent(B)+"="+encodeURIComponent(C));}});return y.join("&");},_defDataLoaded:function(z){var y=this;y.setValues(z.parsed,z.src);y._set(v,false);y._set(x,false);y._loadedValues=c.clone(y._values);z.callback.call(y,null,z.response);},_stoppedDataLoaded:function(y){y.details[0].callback.call(this,"Load event halted");},load:function(z,A){var y=this;if(h.isFunction(z)){A=z;z={};}else{if(!z){z={};}}A=A||f;y.sync("read",z,function(D,B){var C={options:z,response:B,src:"load",callback:A};if(D){C.error=D;y.fire(b,C);A.apply(y,arguments);}else{y._values={};C.parsed=y.parse(B);y.fire(r,C);}});return y;},parse:function(y){if(typeof y==="string"){try{return c.JSON.parse(y);}catch(z){this.fire(b,{error:z,response:y,src:"parse"});return null;}}return y;},save:function(z,A){var y=this;if(h.isFunction(z)){A=z;z={};}else{if(!z){z={};}}A=A||f;y._validate(y.getValues(),function(B){if(B){A.call(y,B);return;}y.sync(y.get(x)?"create":"update",z,function(E,C){var D={options:z,response:C,src:"save"};if(E){D.error=E;y.fire(b,D);}else{D.parsed=y.parse(C);D.callback=A;y._set(v,false);y._set(x,false);y._loadedValues=c.clone(y._values);y.fire(k,D);if(D.parsed){y.fire(r,D);return y;}}A.apply(y,arguments);});});return y;},reset:function(){this._values=c.clone(this._loadedValues);this.fire(j);return this;},sync:function(z,y,A){(A||f).call(this);},validate:function(y,z){(z||f).call(this);},_validate:function(z,A){var y=this;y.validate(z,function(B){if(h.isValue(B)){y.fire(b,{attributes:z,error:B,src:"validate"});A.call(y,B);return;}A.call(y);});},toJSON:function(){return this.getValues();},_isModifiedGetter:function(A,z){z=z.split(t);if(z.length>1){z=z[1];var y={};y[z]=this._values[z]!==this._loadedValues[z];return y;}return A;},_isNewGetter:function(A,z){z=z.split(t);if(z.length>1){z=z[1];var y={};y[z]=!this._loadedValues.hasOwnProperty(z);return y;}return A;},_primaryKeysSetter:function(y){if(this._primaryKeys&&this._primaryKeys.length){return c.Attribute.INVALID_VALUE;}y=new m(y);this._primaryKeys=y;return y;},_primaryKeysGetter:function(A,z){z=z.split(t);if(z.length>1){z=z[1];var y={};y[z]=A.indexOf(z)!==-1;return y;}return(A||[]).concat();}},{ATTRS:{isModified:{readOnly:true,value:false,validator:h.isBoolean,getter:"_isModifiedGetter"},isNew:{readOnly:true,value:true,validator:h.isBoolean,getter:"_isNewGetter"},primaryKeys:{setter:"_primaryKeysSetter",getter:"_primaryKeysGetter",lazyAdd:false,value:[]}}});c.GalleryModelSimpleUndo=function(){};c.GalleryModelSimpleUndo.prototype={initializer:function(){this._lastChange={};if(this._addPreserve){this._addPreserve("_lastChange");}this.after(n,this._trackChange);this.on([r,k,j],this._resetUndo);},_trackChange:function(y){if(y.name&&y.src!==i){this._lastChange[y.name]=y.prevVal;}},_resetUndo:function(){this._lastChange={};},undo:function(z){var y=this;if(z){if(y._lastChange[z]!==undefined){y.setValue(z,y._lastChange[z],i);delete y._lastChange[z];}}else{e.each(y._lastChange,function(B,A){if(B!==undefined){y.setValue(A,B,i);}});y._lastChange={};}return y;}};c.GalleryModelChronologicalUndo=function(){};c.GalleryModelChronologicalUndo.prototype={initializer:function(){this._changes=[];if(this._addPreserve){this._addPreserve("_changes");}this.after(n,this._trackChange);this.on([r,k,j],this._resetUndo);},_trackChange:function(y){if(y.src!==i){this._changes.push(y.details);}},_resetUndo:function(){this._changes=[];},undo:function(){var y=this._changes.pop();if(y){if(y.name){this.setValue(y.name,y.prevVal,i);}else{this.setValues(y.prevVals,i);}}if(this._changes.length===0){this._set(v,false);}return this;}};var w="index",o=function(){};o.prototype={_isYUIModelList:true,initializer:function(){this._shelves=[];this._currentIndex=0;this._addPreserve("_values","_loadedValues","_isNew","_isModified");},_setInitialValues:function(y){this.add(y.cfg.values);},_currentIndex:0,_shelves:null,_shelve:function(z){if(z===undefined){z=this._currentIndex;
}var y=this,A={};m.each(y._preserve,function(B){A[B]=y[B];});y._shelves[z]=A;},_fetch:function(z){if(z===undefined){z=this._currentIndex;}else{this._currentIndex=z;}var y=this,A=y._shelves[z];if(h.isUndefined(A)){this._initNew();}else{m.each(y._preserve,function(B){y[B]=A[B];});}},_addPreserve:function(){this._preserve=(this._preserve||[]).concat(Array.prototype.slice.call(arguments));},_initNew:function(){this._values={};this._loadedValues={};this._isNew=true;this._isModified=false;},add:function(z,A){var y=this;if(h.isArray(z)){m.each(z,function(C,B){y.add(C,(A?A+B:undefined));});return y;}if(y.get(v)||!y.get(x)){y._shelve();}if(A===undefined){A=y._shelves.length;}y._shelves.splice(A,0,{});y._currentIndex=A;y._initNew();y.setValues(z,q);return y;},each:function(z){var y=this;y._shelve();m.each(y._shelves,function(B,A){y._currentIndex=A;y._fetch(A);if(z.call(y,A)!==false){y._shelve(A);}});return y;},eachModified:function(z){var y=this;y._shelve();m.each(y._shelves,function(B,A){if(y._shelves[A][v]){y._currentIndex=A;y._fetch(A);if(z.call(y,A)!==false){y._shelve(A);}}});return y;},saveAllModified:function(){this.eachModified(this.save);return this;},_defDataLoaded:function(z){var y=this,A=y._shelves;if(h.isArray(z.parsed)){if(A.length&&(y.get(v)||!y.get(x))){y._shelve();}m.each(z.parsed,function(B){A.push({_values:B,_loadedValues:c.clone(B),isNew:false,isModified:false});});y._fetch();if(y._sort){y._sort();}z.callback.call(y,null,z.response);}else{c.GalleryModel.prototype._defDataLoaded.apply(y,arguments);}},size:function(){var y=0;m.each(this._shelves,function(){y+=1;});return y;},empty:function(){this._shelves=[];this._currentIndex=0;this.reset();return this;},_indexSetter:function(y){if(h.isNumber(y)&&y>=0&&y<this._shelves.length){this._shelve(this._currentIndex);this._currentIndex=y=parseInt(y,10);this._fetch(y);return y;}return c.Attribute.INVALID_VALUE;},_indexGetter:function(){return this._currentIndex;},_isNewGetter:function(z,y){if(y.split(t).length>1){return c.GalleryModel.prototype._isNewGetter.apply(this,arguments);}return this._isNew;},_isNewSetter:function(y){return(this._isNew=y);},_isModifiedGetter:function(z,y){if(y.split(t).length>1){return c.GalleryModel.prototype._isModifiedGetter.apply(this,arguments);}return this._isModified;},_isModifiedSetter:function(y){return(this._isModified=y);}};o.ATTRS={index:{value:0,setter:"_indexSetter",getter:"_indexGetter"},isNew:{setter:"_isNewSetter"},isModified:{setter:"_isModifiedSetter"}};c.GalleryModelMultiRecord=o;var s="sortField",a="sortDir",u="asc",d="desc",l=function(){};l.prototype={_compare:null,initializer:function(){if(this.get(s)===undefined){this._set(s,this.get("primaryKeys")[0]);}this._setCompare();this.after([s+p,a+p],this._sort);this.after(n,this._afterChange);},_setCompare:function(){var z=this.get(s),A=this.get(a)===u?1:-1,y=(h.isFunction(z)?z:function(B){return B[z];});this._compare=function(C,B){var E=y(C._values),D=y(B._values);return(E<D?-1:(E>D?1:0))*A;};},_sort:function(){this._setCompare();this._shelve();this._shelves.sort(this._compare);this._shelves.splice(this.size());this._fetch(0);},_afterChange:function(B){var E=B.name,y=this.get(s),A,z=this._currentIndex,D=this._shelves,C;if(E&&B.src!==q&&(h.isFunction(y)||E===y)){C=D.splice(z,1)[0];A=this._findIndex(C._values);D.splice(A,0,C);this._currentIndex=A;}},_findIndex:function(z){var E=this._shelves,y=0,D=E.length,A=0,B=this._compare,C={_values:z};while(y<D){A=Math.floor((D+y)/2);switch(B(C,E[A])){case 1:y=A+1;break;case -1:D=A;break;default:y=D=A;}}return y;},add:function(y){if(h.isArray(y)){m.each(y,this.add,this);return this;}var A=this._shelves,z=0;z=this._findIndex(y);this._currentIndex=z;A.splice(z,0,{});this._initNew();this.setValues(y,q);this._shelve(z);return this;},find:function(C,y){var B=this.get(s),A,z={};if(h.isFunction(B)){return null;}z[B]=C;A=this._findIndex(z);if(this._shelves[A]._values[B]!==C){return null;}if(y||arguments.length<2){this.set(w,A);}return A;}};l.ATTRS={sortField:{validator:function(y){return h.isString(y)||h.isFunction(y);}},sortDir:{validator:function(y){return y===d||y===u;},value:u}};c.GalleryModelSortedMultiRecord=l;var g=function(){};g.prototype={add:function(y){if(h.isArray(y)){m.each(y,this.add,this);return this;}if(this.get(v)||!this.get(x)){this._shelve();}this._currentIndex=y[this._primaryKeys[0]];this._initNew();this.setValues(y,q);return this;},_defDataLoaded:function(A){var y=this,B=y._shelves,z=y._primaryKeys[0];if(h.isUndefined(z)){return;}if(y.get(v)||!y.get(x)){y._shelve();}m.each(new m(A.parsed),function(C){B[C[z]]={_values:C,_loadedValues:c.clone(C),isNew:false,isModified:false};});m.some(B,function(D,C){y._fetch(C);return true;});A.callback.call(y,null,A.response);},next:function(){if(this.get(v)||!this.get(x)){this._shelve();}var A=this._shelves,z=this._currentIndex+1,y=A.length;while(z<y&&!A.hasOwnProperty(z)){z+=1;}if(z===y){return null;}this._fetch(z);return z;},previous:function(){if(this.get(v)||!this.get(x)){this._shelve();}var z=this._shelves,y=this._currentIndex-1;while(y>=0&&!z.hasOwnProperty(y)){y-=1;}if(y===-1){return null;}this._fetch(y);return y;}};c.GalleryModelPrimaryKeyIndex=g;},"gallery-2012.09.05-20-01",{requires:["base"],skinnable:false});