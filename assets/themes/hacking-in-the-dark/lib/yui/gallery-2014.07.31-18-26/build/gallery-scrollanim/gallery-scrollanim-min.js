YUI.add("gallery-scrollanim",function(e,t){"use strict";function u(e){u.superclass.constructor.apply(this,arguments),e.touchEnable&&(o=e.touchEnable)}var n=e.Attribute,r=e.Lang,i=e.Array,s=null,o=!1;u.NAME="scrollAnim",u.ATTRS={node:{value:s,setter:function(t){var r=e.one(t);return r?r:(e.fail("ScrollAnim: Invalid node given: "+t,"error"),n.INVALID_VALUE)},writeOnce:"initOnly"},animations:{value:s,setter:function(t){return r.isArray(t)?(i.each(t,function(t){var i;if(!r.isObject(t))return n.INVALID_VALUE;i=e.one(t.selector);if(!t.selector)return n.INVALID_VALUE;t.node=i}),t):n.INVALID_VALUE}},maxScroll:{value:{value:1e3}},tickSpeed:{value:100},scrollSpeed:{value:20},useRAF:{value:!0},tweenSpeed:{value:.3},startAt:{value:0},onStart:{value:null},onResize:{value:null},onUpdate:{value:null}},e.extend(u,e.Base,{keyframe:0,settings:{},page:null,started:!1,paused:!1,animation:null,touch:!1,touchStart:{x:0,y:0},scrollStart:0,scrollTopTweened:0,scrollTop:0,scrollDirection:0,autoScrollInterval:0,initializer:function(t){var n=this.get("node"),r=this.get("animations");this.settings=t,this.animation=r,this.requestAnimationFramePolyfill(),o&&(n.on("touchstart",e.bind(this.touchStartHandler,this)),n.on("touchmove",e.bind(this.touchMoveHandler,this)),n.on("touchend",e.bind(this.touchEndHandler,this))),e.on("mousewheel",e.bind(this.wheelHandler,this)),e.on("resize",e.bind(this.resizeHandler,this)),this.resize()},requestAnimationFramePolyfill:function(){var e=0,t=["ms","moz","webkit","o"],n;for(n=0;n<t.length&&!window.requestAnimationFrame;n+=1)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})},resize:function(){var e=this.get("node"),t=parseInt(e.getComputedStyle("width"),10),n=parseInt(e.getComputedStyle("height"),10),r=this.get("onResize");this.page={wWidth:t,wHeight:n,wCenter:{left:t/2,top:n/2}},r&&typeof r=="function"&&r(this.page),this.resetAnimatable(),this.setAnimatable(),this.start()},start:function(){var t=e.Lang.isFunction(this.get("startAt"))?this.get("startAt")():this.get("startAt"),n=this.get("onStart");!this.started&&t&&(this.scrollTopTweened=this.scrollTop=t),this.scrollTop+=1,this.started||(this.animationLoop(),this.started=!0),this.scrollTop-=1,n&&typeof n=="function"&&n()},animationLoop:function(){window.requestAnimationFrame(e.bind(this.animationLoop,this));if(this.paused)return;var t=this.get("tweenSpeed"),n=this.animation,r,i,s=this.get("onUpdate"),o,u;if(Math.ceil(this.scrollTopTweened)!==Math.floor(this.scrollTop)){this.scrollTopTweened+=t*(this.scrollTop-this.scrollTopTweened),this.scrollTopTweened=Math.round(this.scrollTopTweened*100)/100,this.scrollDirection=this.scrollTop>this.scrollTopTweened?1:-1;for(i in n)n.hasOwnProperty(i)&&(r=n[i],o=e.Lang.isFunction(r.startAt)?r.startAt():r.startAt,u=e.Lang.isFunction(r.endAt)?r.endAt():r.endAt,this.scrollTopTweened>=o&&this.scrollTopTweened<=u?(this.startAnimatable(r),this.render(r)):this.stopAnimatable(r));s&&typeof s=="function"&&s(this.scrollTopTweened)}},render:function(t){var n=e.Lang.isFunction(t.startAt)?t.startAt():t.startAt,r=e.Lang.isFunction(t.endAt)?t.endAt():t.endAt,i=(n-this.scrollTopTweened)/(n-r),s={},o,u,a,f,l,c,h,p,d,v;i=Math.max(0,Math.min(1,i)),t.lastProgress=i;if(t.keyframes)for(o=1;o<t.keyframes.length;o+=1){u=t.keyframes[o],a=t.keyframes[o-1],f=(a.position-i)/(a.position-u.position);if(f>=0&&f<=1){u.onProgress&&typeof u.onProgress=="function"&&u.onProgress(f,this.scrollDirection);for(l in u.properties)u.properties.hasOwnProperty(l)&&(l==="background-position"&&u.properties[l].hasOwnProperty("x")?(c=e.clone(u.properties[l]),h=e.clone(a.properties[l]),p="",e.Lang.isFunction(c.x)&&(c.x=c.x()),e.Lang.isFunction(c.y)&&(c.y=c.y()),e.Lang.isFunction(h.x)&&(h.x=h.x()),e.Lang.isFunction(h.y)&&(h.y=h.y()),typeof c.x=="number"?p+=this.getTweenedValue(h.x,c.x,f,1,u.ease)+"px":p+=c.x,p+=" ",typeof c.y=="number"?p+=this.getTweenedValue(h.y,c.y,f,1,u.ease)+"px":p+=c.y,s.backgroundPosition=p):(e.Lang.isFunction(u.properties[l])?d=u.properties[l]():d=u.properties[l],e.Lang.isFunction(a.properties[l])?v=a.properties[l]():v=a.properties[l],s[l]=this.getTweenedValue(v,d,f,1,u.ease)))}}t.node.setStyles(s),t.onProgress&&typeof t.onProgress=="function"&&t.onProgress(t,i)},destructor:function(){},startAnimatable:function(e){e._started||(e.onStartAnimate&&typeof e.onStartAnimate=="function"?e.onStartAnimate(e,this.scrollDirection):e.node.setStyle("display","block"),e._started=!0)},stopAnimatable:function(t){var n=e.Lang.isFunction(t.startAt)?t.startAt():t.startAt,r=e.Lang.isFunction(t.endAt)?t.endAt():t.endAt;if(t._started&&r<this.scrollTopTweened||t._started&&n>this.scrollTopTweened||this.scrollDirection<0&&t.lastProgress>0&&n>this.scrollTopTweened||this.scrollDirection>0&&t.lastProgress<1&&r<this.scrollTopTweened)this.render(t),t.onEndAnimate&&typeof t.onEndAnimate=="function"&&t.onEndAnimate(t,this.scrollDirection),t._started=!1},setAnimatable:function(){var t=this.get("animations");e.Object.each(t,function(t){t.lastProgress=0,r.isFunction(t.onInit)&&t.onInit(t),e.Array.each(t.keyframes,function(e){r.isFunction(e.onInit)&&e.onInit(t)})})},resetAnimatable:function(){var e=this.get("animation"),t,n;for(n in e)e.hasOwnProperty(n)&&(t=e[n],t._started&&delete t._started)},wheelHandler:function(e){var t=this.get("scrollSpeed"),n=e.wheelDelta;if(this.paused)return;this.scrollTop-=n*t,this.scrollTop<0&&(this.scrollTop=0),this.checkMaxScroll()},resizeHandler:function(){this.resize()},scrollTo:function(e){this.scrollTop=e},touchStartHandler:function(e){this.touchStart.x=e.touches[0].pageX,this.touchStart.y=e.touches[0].pageY,this.scrollStart=this.scrollTop},touchEndHandler
:function(){},touchMoveHandler:function(e){e.preventDefault();if(this.paused)return;var t={};t.x=this.touchStart.x-e.touches[0].pageX,t.y=this.touchStart.y-e.touches[0].pageY,Math.abs(t.y)>Math.abs(t.x)&&(this.scrollTop=Math.max(0,this.scrollStart+t.y),this.checkMaxScroll())},getTweenedValue:function(e,t,n,r,i){var s=t-e,o=n/r;return i||(i=TWEEN.Easing.Linear.EaseNone),i(o)*s+e},checkMaxScroll:function(){var e=this.get("maxScroll").value;this.scrollTop<0?this.scrollTop=0:this.scrollTop>e&&(this.scrollTop=e)}}),e.ScrollAnim=u},"0.0.1",{requires:["base","widget","yui-throttle","transition","event-mousewheel","event-resize","event-touch"],skinnable:!1});
