YUI.add("gallery-weighted-list",function(e,t){(function(e){"use strict";var t=e.Array,n=e.Lang,r=Math,i=t.each,s=r.floor,o=n.isArray,u=n.isFunction,a=t.iterate,f=t.map,l=r.random,c=t.reduce,h=t.some,p=function(n){this._array=[],this._random=e.Alea?(new e.Alea(o(n)?n:t(arguments))).random:l};p.prototype={add:function(e,t){var n=this,r=n._array;return!t&&t!==0&&(t=1),r.push({value:e,weight:t}),delete n._sum,delete n._totals,r.length-1},dedupe:function(e){var t=this._array,n=0,r,i,s,o=t.length,u={},a=new p;e||(e="sum");for(;n<o;n+=1)i=t[n],s=i.value,u.hasOwnProperty(s)?e==="sum"&&(r=u[s],a.updateWeight(r,a.weight(r)+i.weight)):u[s]=a.add(s,i.weight);return a},each:function(e,t){return i(this._array,function(n,r){e.call(t,n.value,r,n.weight)}),this},every:function(e,t){return!h(this._array,function(n,r){return!e.call(t,n.value,r,n.weight)})},filter:function(e,t){var n=new p;return i(this._array,function(r,i){var s=r.value,o=r.weight;e.call(t,s,i,o)&&n.add(s,o)}),n},find:function(e,t){var n=null;return h(this._array,function(r,i){var s=r.value;if(e.call(t,s,i,r.weight))return n=s,!0}),n},grep:function(e){var t=new p;return i(this._array,function(n){var r=n.value;e.test(r)&&t.add(r,n.weight)}),t},indexOf:function(e,t){var n=this,r=n._array,i=-1;return t=t||0,t<0&&(t+=r.length),h(r,function(r,s){if(s<t)return!1;if(n.itemsAreEqual(r.value,e))return i=s,!0}),i},invoke:function(e){var n=t(arguments,1,!0),r=new p;return i(this._array,function(t){var i=t.value,s=i&&i[e];r.add(u(s)?s.apply(i,n):null,t.weight)}),r},isEmpty:function(){return!this._array.length},item:function(e){!e&&e!==0&&(e=this._randomIndex());var t=this._array[e];return t?{index:e,value:t.value,weight:t.weight}:null},itemsAreEqual:function(e,t){return e===t},lastIndexOf:function(e,t){var n=this,r=n._array,i=r.length,s=-1;return!t&&t!==0&&(t=i-1),t<0&&(t+=r.length),a(r,-1,function(r,i){if(i>t)return!1;if(n.itemsAreEqual(r.value,e))return s=i,!0}),s},map:function(e,t){var n=new p;return i(this._array,function(r,i){var s=r.weight;n.add(e.call(t,r.value,i,s),r.weight)}),n},partition:function(e,t){var n=new p,r=new p;return i(this._array,function(i,s){var o=i.value,u=i.weight;(e.call(t,o,s,u)?n:r).add(o,u)}),{matches:n,rejects:r}},reduce:function(e,t,n){return c(this._array,e,function(e,r,i){return t.call(n,e,r.value,i,r.weight)})},reject:function(e,t){var n=new p;return i(this._array,function(r,i){var s=r.value,o=r.weight;e.call(t,s,i,o)||n.add(s,o)}),n},remove:function(e,t){var n=this,r=n._array,i=0,s=r.length-1;for(;s>=0;s-=1)if(n.itemsAreEqual(e,n.value(s))){r.splice(s,1),i+=1;if(!t)break}return i&&(delete n._sum,delete n._totals),i},removeIndex:function(e){var t=this;return t._array.splice(e,1),delete t._sum,delete t._totals,t},size:function(){return this._array.length},some:function(e,t){return h(this._array,function(n,r){return e.call(t,n.value,r,n.weight)})},update:function(e,t,n){var r=this;return!n&&n!==0&&(n=1),r._array[e]={value:t,weight:n},delete r._sum,delete r._totals,r},updateValue:function(e,t){return this.update(e,t,this.weight(e))},updateWeight:function(e,t){return this.update(e,this.value(e),t)},unique:function(e){e||(e="sum");var t=new p;return i(this._array,function(n){var r=n.value;h(t._array,function(i,s){if(i.value===r)return e==="sum"&&t.updateWeight(s,i.weight+n.weight),!0})||t.add(r,n.weight)}),t},toArray:function(){return f(this._array,function(e){return e.value})},toJSON:function(){return this.toArray()},toString:function(){return this.toArray().toString()},value:function(e){!e&&e!==0&&(e=this._randomIndex());var t=this._array[e];return t?t.value:null},weight:function(e){!e&&e!==0&&(e=this._randomIndex());var t=this._array[e];return t?t.weight:null},_randomIndex:function(){var e,t=this,n,r=0,i,o=t._sum,u,a=t._totals;if(!o||!a){t._update(),o=t._sum,a=t._totals;if(!o||!a||!a.length)return null}e=a.length-1,i=s(t._random()*o);while(e>=r){n=(e+r)/2,n<0?n=0:n=s(n),u=a[n];if(i===u){n+=1;break}if(i<u){if(n&&i>a[n-1])break;e=n-1}else i>u&&(r=n+1)}return n},_update:function(){var e=this,t=0,n=[];return i(e._array,function(e){t+=e.weight,n.push(t)}),e._sum=t,e._totals=n,e}},e.WeightedList=p})(e)},"gallery-2013.05.02-22-59",{optional:["gallery-alea"],requires:["array-extras","gallery-array-iterate"]});
