YUI.add("gallery-bt-container",function(e,t){var n="heightChange",r="widthChange",i="btSyncContent",s=e.Bottle.Device.getPositionFixedSupport(),o=function(e,t,n){var r,i=t&&s,o=n!==undefined?n:this.get("nativeScroll"),u=o?null:this.get("scrollView");r=this.get(e?"headerNode":"footerNode"),r&&(o&&i&&r.addClass("btFixed"),r.setStyles({top:e&&o&&i?0:"",bottom:!e&&o&&i?0:""}),s&&this.get("scrollNode").setStyle(e?"marginTop":"marginBottom",t&&o?r.get("offsetHeight")+"px":0),u&&this.get(t?"srcNode":"scrollNode").insert(r,e?0:undefined),this._syncScrollHeight())};e.namespace("Bottle").Container=e.Base.create("btcontainer",e.Widget,[e.WidgetChild,e.zui.Attribute],{initializer:function(){this._btcEventHandlers=new e.EventHandle([this.after(n,this._syncScrollHeight),this.on(r,this._syncScrollWidth)])},destructor:function(){this._btcEventHandlers.detach(),this.get("rendered")&&!this.get("nativeScroll")&&this.get("scrollView").destroy(!0),delete this._eventHandlers},renderUI:function(){var t=this.get("nativeScroll"),n=this.get("srcNode"),r=this.get("headerNode"),i=this.get("bodyNode"),s=this.get("footerNode"),o=t?i:e.Node.create('<div class="bt-container-scroll"></div>'),u=t?null:new e.ScrollView(e.merge(this.get("cfgScroll"),{axis:"y",srcNode:o}));this.set("scrollNode",o),this.set("scrollView",u);if(t){this.get("boundingBox").addClass("btFixedScroll"),this.set_again("headerFixed"),this.set_again("footerFixed");return}u.plug(e.zui.RAScroll,{horizontal:!1,cooperation:!0}),e.Bottle.Device.getTouchSupport()||u.plug(e.zui.ScrollHelper),n.append(o),o.append(r),o.append(i),o.append(s),u.render(),e.UA.ie&&e.UA.ie<8&&u.get("boundingBox").insert('<div class="btDummy"></div>',"before"),this.set_again("headerFixed"),this.set_again("footerFixed"),this.set_again("translate3D"),this._syncScrollHeight()},_syncScrollWidth:function(e){var t=this.get("scrollView");t&&t.set("width",e.newVal)},_syncScrollHeight:function(){var t=this.get("nativeScroll"),n=t?e.Bottle.Device.getBrowserHeight():this.get("height"),r,i,s=this.get("scrollView");if(!s||!n)return;e.later(1,this,function(){r=this.get("footerNode"),this.get("footerFixed")?n-=r.get("clientHeight"):r&&this.get("fullHeight")&&(i=r.previous(),i.setStyle("minHeight",n-i.getY()-r.get("clientHeight")+"px")),t||(n-=s.get("boundingBox").get("offsetTop"),s.set("height",n))})},updateContentSize:function(){var t=this.get("scrollView"),n,r;t?(t._uiDimensionsChange(),t&&t._maxScrollY&&t.scrollTo(t.get("scrollX"),Math.min(t.get("scrollY"),t._maxScrollY))):(n=this.get("contentBox").get("scrollHeight"),r=this.get("nativeScroll"),(!r||this.get("height"))&&this.set("height",n),r&&e.fire(i))},setContent:function(e,t){var n=this.get("contentBox"),r=this;e&&n.setHTML(e);if(!t)return;n.all("img").each(function(e){e.get("naturalWidth")||e.once("load",function(){r.updateContentSize()})})}},{ATTRS:{nativeScroll:{value:!0,validator:function(t){return e.Lang.isBoolean(t)&&!this.get("rendered")}},headerNode:{value:undefined,writeOnce:!0,setter:function(t){var n=e.one(t);if(n)return n.addClass("btHeader"),this.set("headerFixed",n.getData("position")==="fixed"),n}},footerNode:{value:undefined,writeOnce:!0,setter:function(t){var n=e.one(t);if(n)return n.addClass("btFooter"),this.set("footerFixed",n.getData("position")==="fixed"),n}},bodyNode:{writeOnce:!0},scrollNode:{writeOnce:!0},scrollView:{writeOnce:!0},cfgScroll:{value:{flick:{minDistance:10,minVelocity:.3}},writeOnce:!0,lazyAdd:!1},fullHeight:{value:!0,validator:e.Lang.isBoolean},translate3D:{value:!0,validator:e.Lang.isBoolean,setter:function(e){return this.get("scrollNode").toggleClass("bt-translate3d",e),e}},headerFixed:{value:!1,validator:e.Lang.isBoolean,setter:function(e){return o.apply(this,[!0,e]),e}},footerFixed:{value:!1,validator:e.Lang.isBoolean,setter:function(e){return o.apply(this,[!1,e]),e}}},HTML_PARSER:{headerNode:"> [data-role=header]",bodyNode:"> [data-role=body]",footerNode:"> [data-role=footer]",cfgScroll:function(t){try{return e.JSON.parse(t.getData("cfg-scroll"))}catch(n){}},fullHeight:function(e){return e.getData("full-height")==="false"?!1:!0},translate3D:function(e){return e.getData("translate3d")==="false"?!1:!0}}})},"gallery-2013.04.10-22-48",{requires:["scrollview","widget-child","json-parse","gallery-zui-attribute","gallery-zui-rascroll","gallery-zui-scrollhelper","gallery-bt-device"]});
