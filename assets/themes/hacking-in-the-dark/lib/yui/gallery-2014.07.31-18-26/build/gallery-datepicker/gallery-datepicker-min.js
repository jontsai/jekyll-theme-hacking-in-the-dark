YUI.add("gallery-datepicker",function(e,t){e.DatePicker=function(e){this.args=e,this.format="%Y-%m-%d",this.args.showTime&&(this.format+=" %H:%M:%S"),this.createFormElements(),this.createPopup()},e.DatePicker.prototype.createPopup=function(){var t=10055,n=e.one("body");this.container=e.Node.create("<div/>"),this.container.setStyle("display","none"),this.container.setStyle("position","absolute"),this.container.setStyle("zIndex",t+1),this.container.setStyles({display:"none",position:"absolute",zIndex:t+1,left:"0px",top:"0px"}),this.calendar=new e.Calendar({render:this.container,visible:!0}),this.calendar.on("selectionChange",function(e){this.setDate(e.newSelection[0]),this.hideContainer()},this),this.args.minimumDate&&this.setMinimumDate(this.args.minimumDate),this.args.maximumDate&&this.setMaximumDate(this.args.maximumDate),this.overlay=e.Node.create("<div/>"),this.overlay.setStyles({top:"0px",left:"0px",width:"100%",height:"100%",display:"none",position:"fixed",zIndex:t}),n.addClass("yui3-skin-sam"),n.append(this.overlay),n.append(this.container),this.overlay.on("click",this.hideContainer,this),this.container.on("click",function(e){e.stopPropagation()})},e.DatePicker.prototype.createFormElements=function(){this.input=e.one(this.args.input),this.calendarLauncher=e.Node.create('<input type="button"/>'),this.calendarLauncher.addClass("cal-launcher"),this.args.btnContent&&this.calendarLauncher.setHTML(this.args.btnContent),this.input.insert(this.calendarLauncher,"after"),this.calendarLauncher.on("click",this.showContainer,this),this.args.date&&this.setDate(this.args.date,!0)},e.DatePicker.prototype.getDate=function(){return this.parseDate(this.input.get("value"))},e.DatePicker.prototype.setDate=function(t,n){var r,i;n||(r=this.parseDate(this.input.get("value")),r&&(t.setHours(r.getHours()),t.setMinutes(r.getMinutes()),t.setSeconds(r.getSeconds()),t.setMilliseconds(r.getMilliseconds()))),i=e.DataType.Date.format(t,{format:this.format}),this.input.set("value",i)},e.DatePicker.prototype.setMinimumDate=function(e){this.minimumDate=e,this.setCustomRenderer()},e.DatePicker.prototype.setMaximumDate=function(e){this.maximumDate=e,this.setCustomRenderer()},e.DatePicker.prototype.setCustomRenderer=function(){if(this.customRenderer)return;var e,t,n,r;e=this,t=function(t){return e.maximumDate&&t>e.maximumDate?!1:e.minimumDate&&t<e.minimumDate?!1:!0},n=function(e,n){t(e)?n.removeClass("yui3-calendar-selection-disabled"):n.addClass("yui3-calendar-selection-disabled")},this.calendar.set("customRenderer",{filterFunction:n,rules:{all:"all"}}),r=this.calendar._canBeSelected,this.calendar._canBeSelected=function(n){return t(n)?r.call(e.calendar,n):!1},this.customRenderer=!0},e.DatePicker.prototype.parseDate=function(e){if(!e)return null;var t=e.match(/^(\d{4})(?:-(\d{1,2})(?:-(\d{1,2})(?:[ T](\d{1,2})(?::(\d{1,2})(?::(\d{1,2}))?)?)?)?)?$/);return t?new Date(t[1],t[2]-1||0,t[3]||1,t[4]||0,t[5]||0,t[6]||0):null},e.DatePicker.prototype.showContainer=function(e){e&&e.preventDefault(),this.onshow&&this.onshow();var t,n,r;t=this.calendarLauncher.getX(),n=this.calendarLauncher.getY()+parseInt(this.calendarLauncher.getComputedStyle("height"),10),this.container.setStyles({left:t,top:n}),r=this.parseDate(this.input.get("value")),r?(this.calendar._addDateToSelection(r,!0),this.calendar.set("date",r)):this.calendar.set("date",new Date),this.overlay.setStyle("display","block"),this.container.setStyle("display","block")},e.DatePicker.prototype.hideContainer=function(){this.overlay.setStyle("display","none"),this.container.setStyle("display","none")}},"gallery-2013.03.13-20-05",{requires:["yui-base","calendar","node","datatype-date"],skinnable:!0});
