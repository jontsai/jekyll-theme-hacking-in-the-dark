YUI.add("gallery-datatable-selection",function(e,t){function n(){}n.ATTRS={highlighted:{value:null,validator:function(t){return t instanceof e.Node||t===null}},selected:{value:null,validator:function(t){return t instanceof e.Node||t===null}},highlightMode:{value:"none",setter:"_setHighlightMode",validator:function(t){return e.Lang.isString(t)?t==="none"||t==="cell"||t==="row"?!0:!1:!1}},selectionMode:{value:"none",setter:"_setSelectionMode",validator:function(t){return e.Lang.isString(t)?t==="none"||t==="cell"||t==="row"?!0:!1:!1}},selectedRows:{value:[],validator:e.Lang.isArray,getter:"_getSelectedRows",setter:"_setSelectedRows"},selectedCells:{value:[],validator:e.Lang.isArray,setter:"_setSelectedCells",getter:"_getSelectedCells"},selectionMulti:{value:!1,validator:e.Lang.isBoolean}},e.mix(n.prototype,{_selections:null,_classHighlight:null,_classSelected:null,_clickModifiers:null,_subscrSelectComp:null,_subscrSelect:null,_subscrHighlight:null,initializer:function(){this._bindSelector()},destructor:function(){this._unbindSelector()},enableSelection:function(){this.disableSelection(),this._bindSelector()},disableSelection:function(){this.clearAll(),this._unbindSelector()},getColumnByTd:function(e){var t=this.getColumnNameByTd(e);return t?this.getColumn(t):null},getColumnNameByTd:function(t){var n=t.get("className").split(" "),r=new RegExp(this.getClassName("col")+"-(.*)"),i;return e.Array.some(n,function(t){var n=t.match(r);if(n&&e.Lang.isArray(n)&&n[1])return i=n[1],!0}),i||null},clearSelections:function(){this._selections=[],this.set("selected",null),this._clearAll(this._classSelected)},clearHighlighted:function(){this.set("highlighted",null),this._clearAll(this._classHighlight)},clearAll:function(){this.clearSelections(),this.clearHighlighted()},_bindSelector:function(){this._selections=[],this._subscrSelectComp=[],this._subscrSelectComp.push(this.on("highlightedChange",this._highlightChange)),this._subscrSelectComp.push(this.on("selectedChange",this._selectedChange)),this._classHighlight=this.getClassName("sel","highlighted"),this._classSelected=this.getClassName("sel","selected"),this._subscrSelectComp.push(this.after("sort",this._afterResetDataSelect)),this._clickModifiers={ctrlKey:null,altKey:null,metaKey:null,shiftKey:null,which:null,button:null}},_unbindSelector:function(){this._clearAll(this._classHighlight),this._clearAll(this._classSelected),this._subscrSelect&&this._subscrSelect.detach&&this._subscrSelect.detach(),this._subscrSelect=null,this._subscrHighlight&&this._subscrHighlight.detach&&this._subscrHighlight.detach(),this._subscrHighlight=null,this._subscrHighlight&&this._subscrHighlight.detach&&this._subscrHighlight.detach(),this._subscrHighlight=null,e.Array.each(this._subscrSelectComp,function(t){if(!t)return;e.Lang.isArray(t)?e.Array.each(t,function(e){e.detach()}):t.detach&&t.detach()}),this._subscrSelectComp=null,this._clickModifiers=null,this._selections=null,this._classHighlight=null,this._classSelected=null},_highlightChange:function(e){this._processNodeAction(e,"highlight",!0);return},_selectedChange:function(t){var n,r,i,s;e.UA.os.search("macintosh")===0?n=this.get("selectionMulti")===!0&&this._clickModifiers.metaKey===!0:n=this.get("selectionMulti")===!0&&this._clickModifiers.ctrlKey===!0,r=this.get("selectionMulti")===!0&&this._clickModifiers.shiftKey===!0,this._clearDOMSelection(),!n&&!r&&this._selections.length>1&&this.clearSelections(),r?this._processRange(t):(i=this._processNodeAction(t,"select",!n),n||(this._selections=[]),this.get("selectionMode")==="row"?this._selections.push(this._selectTr(i)):this._selections.push(this._selectTd(i))),this.fire("selected",{ochange:t,record:this.getRecord(t.newVal)}),s={selectionMode:this.get("selectionMode")},this.get("selectionMode")==="cell"?s.cells=this.get("selectedCells"):this.get("selectionMode")==="row"&&(s.rows=this.get("selectedRows")),this.fire("selection",s)},_processRange:function(t){var n=t.newVal,r=t.prevVal||null,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;if(n&&r){i=this.getRecord(n),s=this.data.indexOf(i),o=this.getColumnNameByTd(n),u=e.Array.indexOf(this.get("columns"),this.getColumn(o)),a=this.getRecord(r),f=this.data.indexOf(a),l=this.getColumnNameByTd(r),c=e.Array.indexOf(this.get("columns"),this.getColumn(l)),h=u-c,p=s-f;if(h!==null&&p!==null){e.Lang.isArray(this._selections)&&this.clearSelections();if(this.get("selectionMode")==="cell"){d=h<0?-1:1,v=p<0?-1:1,m=r;for(y=0;y<=Math.abs(p);y++)for(g=0;g<=Math.abs(h);g++)m=this.getCell(r,[v*y,d*g]),m&&(m.addClass(this._classSelected),w=this._selectTd(m),this._selections.push(w))}else if(this.get("selectionMode")==="row"){v=p<0?-1:1,b=this.getRow(f);for(y=0;y<=Math.abs(p);y++)b=this.getRow(f+v*y),b&&(b.addClass(this._classSelected),w=this._selectTr(b),this._selections.push(w))}}}},_getSelectedRows:function(){var t=[],n=[],r,i;return e.Array.each(this._selections,function(s){if(!s||!s.recClient)return;r=this.getRow(s.recClient),e.Array.indexOf(t,r)===-1&&(i=this.data.getByClientId(s.recClient),t.push(r),n.push({tr:r,record:i,recordIndex:this.data.indexOf(i),recordClientId:s.recClient}))},this),n},_getSelectedCells:function(){var t=[],n=this.get("columns"),r,i,s;return e.Array.each(this._selections,function(o){if(!o)return;if(o.td)r=this.getColumn(o.colName),i=o.tr,s=this.data.getByClientId(o.recClient),t.push({td:o.td,record:s,recordIndex:this.data.indexOf(s),recordClientId:o.recClient,column:r,columnName:o.colName,columnIndex:e.Array.indexOf(n,r)});else if(o.tr){i=o.tr,s=this.data.getByClientId(o.recClient);var u=i.all("td");u&&u.each(function(i){r=this.getColumnByTd(i),t.push({td:i,record:s,recordIndex:this.data.indexOf(s),recordClientId:o.recClient,column:r,columnName:r.key||r.name,columnIndex:e.Array.indexOf(n,r)})},this)}},this),t},_setSelectedCells:function(t){return this._selections=[],e.Lang.isArray(t)&&this.data.size()>t.length&&e.Array.each(t,function(t){var n,r,i,s,o;n=e.Lang.isNumber(t.record)||typeof t.record=="string"?this.getRow(t.record):n,r=e.Lang.isNumber(t.column)||typeof t.column=="string"?this.getColumn(t.column):r,n&&r&&(s=r.key||r.name,s&&(i=n.one("."+this.getClassName("col")+"-"+s),o=this._selectTd(i),o&&this._selections.push(o),i.addClass(this._classSelected)))},this),t},_setSelectedRows:function(t){return this._selections=[],e.Lang.isArray(t)&&this.data.size()>t.length&&e.Array.each(t,function(e){var t=this.getRow(e),n;t&&(n=this._selectTr(t),n&&this._selections.push(n),t.addClass(this._classSelected))},this),t},_selectTd:function(e){var t,n,r=!1;return e&&e.get("tagName").toLowerCase()==="td"&&(t=this.getRecord(e.ancestor()),n=this.getColumnByTd(e),r={td:e,tr:e.ancestor(),recClient:t?t.get("clientId"):null,colName:n.key||n.name||null}),r},_selectTr:function(e){var t,n=!1;return e&&e.get("tagName").toLowerCase()==="tr"&&(t=this.getRecord(e),n={tr:e,recClient:t?t.get("clientId"):null}),n},_afterResetDataSelect:function(){if(!this._selections||this._selections.length===0)return;var t,n,r=[],i,s,o=this.get("columns");this._clearAll(this._classSelected),e.Array.each(this._selections,function(u){this.get("selectionMode")==="row"&&u.recClient?(t=this.getRow(u.recClient),t&&(r.push(this._selectTr(t)),t.addClass(this._classSelected))):this.get("selectionMode")==="cell"&&u.recClient&&u.colName&&(t=this.getRow(u.recClient),s=this.getColumn(u.colName),i=e.Array.indexOf(o,s),n=t&&i>=0?t.all("td").item(i):null,t&&n&&(r.push(this._selectTd(n)),n.addClass(this._classSelected)))},this),this._selections=r},_processNodeAction:function(e,t,n){var r=e.newVal,i,s,o,u;return t==="highlight"?(o=t+"Mode",u=this._classHighlight):t==="select"&&(o="selectionMode",u=this._classSelected),this.get(o)==="cell"?(i=r||null,s=e.prevVal||null):this.get(o)==="row"&&(r&&(i=r.get("tagName").search(/td/i)===0?r.ancestor("tr"):r.get("tagName").search(/tr/i)===0?r:null),s=e.prevVal,s&&(s=s.get("tagName").search(/td/i)===0?s.ancestor("tr"):s.get("tagName").search(/tr/i)===0?s:null)),s&&n&&s.removeClass(u),i&&i.addClass(u),i},_clearAll:function(e){var t=this.get("boundingBox").one("."+this.getClassName("data"));t&&t.all("."+e).removeClass(e)},_setHighlightMode:function(e){this._subscrHighlight&&this._subscrHighlight.detach();if(e==="none")return;return e.toLowerCase&&(e=e.toLowerCase()),this._subscrHighlight=this.delegate("mouseover",function(e){var t=e.currentTarget;this.set("highlighted",t)},"tr td",this),this.clearHighlighted(),e},_setSelectionMode:function(e){var t=this;this._subscrSelect&&this._subscrSelect.detach();if(e==="none")return;return e.toLowerCase&&(e=e.toLowerCase()),this._subscrSelect=this.delegate("click",function(e){var n=e.currentTarget;t._clickModifiers={ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,shiftKey:e.shiftKey,which:e.which,button:e.button},t.set("selected",n)},"tr td",t),this.clearSelections(),e},_clearDOMSelection:function(){var t=e.config.win.getSelection?e.config.win.getSelection():e.config.doc.selection?e.config.doc.selection:null;t&&t.empty&&t.empty(),t&&t.removeAllRanges&&t.removeAllRanges()}}),e.DataTable.Selection=n,e.Base.mix(e.DataTable,[e.DataTable.Selection])},"gallery-2012.12.19-21-23",{skinnable:"true",requires:["base-build","datatable-base","event-custom"]});
