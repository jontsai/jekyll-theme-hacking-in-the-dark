YUI.add("gallery-datatable-celleditor-inline",function(e,t){var n=27,r=13,i=9,s=38,o=40,u=39,a=37;e.DataTable.BaseCellInlineEditor=e.Base.create("celleditor",e.View,[],{template:'<input type="text" class="{cssInput}" />',events:{input:{keypress:"processKeyPress",keydown:"processKeyDown",click:"_onClick",mouseleave:"_onMouseLeave"}},_subscr:null,_cssInput:"yui3-datatable-inline-input",_inputNode:!1,initializer:function(){return this._createUI(),this._bindUI(),this},destructor:function(){this._unbindUI(),this.fire("editorDestroyed")},_bindUI:function(){this.publish({editorSave:{defaultFn:this._defEditorSaveFn,emitFacade:!0,preventable:!0},editorCancel:{defaultFn:this._defEditorCancelFn,emitFacade:!0,preventable:!0}}),this._subscr=[],this._subscr.push(this.on("xyChange",this._setEditorXY))},_unbindUI:function(){e.Array.each(this._subscr,function(e){e&&e.detach&&e.detach()}),this._subscr=null},_defEditorSaveFn:function(e){this.set("value",e.newValue),this.hideEditor()},_defEditorCancelFn:function(){this.hideEditor()},showEditor:function(e){var t=this.get("container"),n=this.get("cell"),r=n.value||this.get("value"),i,s;e=n.td||e,i=e.getXY(),t.show(),this._resizeCont(t,e),t.setXY(i),this._inputNode.focus(),s=this.get("prepFn"),r=s&&s.call?s.call(this,r):r,this._inputNode.set("value",r),this.set("lastValue",r),this._set("visible",!0),this._set("hidden",!1),this.fire("editorShow",{td:e,cell:n,inputNode:this._inputNode,value:r})},saveEditor:function(e){if(e!==undefined&&e!==null){var t=this.get("saveFn");e=t&&t.call?t.call(this,e):e;if(e===undefined){this.cancelEditor();return}this.fire("editorSave",{td:this.get("cell").td,cell:this.get("cell"),oldValue:this.get("lastValue"),newValue:e})}},hideEditor:function(e){var t=this.get("container");t&&t.hide&&t.hide(),e===!0&&this._set("hidden",!0),this._set("visible",!1),this.fire("editorHide")},cancelEditor:function(){this.fire("editorCancel",{td:this.get("cell").td,cell:this.get("cell"),oldValue:this.get("lastValue")})},processKeyPress:function(t){var n=t.keyCode,i=t.target||this._inputNode,s=i.get("value"),o=this.get("keyFiltering"),u=String.fromCharCode(n),a=!0,f;n===r&&(t.preventDefault(),this.saveEditor(s)),o instanceof RegExp?a=u.match(o)?a:!1:e.Lang.isFunction(o)&&(f=o.call(this,t),a=f?!0:!1),a||t.preventDefault()},processKeyDown:function(e){var t=e.keyCode,r;switch(t){case n:e.preventDefault(),this.hideEditor();break;case s:r=e.ctrlKey?[-1,0]:null;break;case o:r=e.ctrlKey?[1,0]:null;break;case a:r=e.ctrlKey?[0,-1]:null;break;case u:r=e.ctrlKey?[0,1]:null;break;case i:r=e.shiftKey?[0,-1]:[0,1]}r&&(this.get("inputKeys")===!0&&this._set("keyDir",r),e.preventDefault())},_createUI:function(){var t=this.get("container"),n=e.Lang.sub(this.template,{cssInput:this._cssInput});t.setHTML(n),t.inDoc()||e.one("body").append(t),t.setStyle("zIndex",999),t.hide(),this._inputNode=t.one("input"),this.get("className")&&this._inputNode.addClass(this.get("className")),this.fire("editorCreated",{inputNode:this._inputNode,container:t})},_resizeCont:function(e,t){var n=this._parseStyle(t,"width"),r=this._parseStyle(t,"height"),i=this._parseStyle(t,"paddingLeft"),s=this._parseStyle(t,"paddingTop"),o=this._parseStyle(t,"borderLeftWidth");n+=i+o-1,r+=s,e.setStyle("width",n+"px"),e.setStyle("height",r+"px")},_parseStyle:function(e,t){return+e.getComputedStyle(t).replace(/px/,"")},_onClick:function(e){e.stopPropagation()},_onMouseLeave:function(){this.get("hideMouseLeave")&&this.hideEditor()},_setEditorXY:function(){this.hideEditor()}},{ATTRS:{name:{value:null,validator:e.Lang.isString},cell:{value:{}},value:{value:null},lastValue:{value:null},hostDT:{value:null,validator:function(t){return t instanceof e.DataTable}},prepFn:{value:null,validator:e.Lang.isFunction},saveFn:{value:null,validator:e.Lang.isFunction},hideMouseLeave:{value:!0,validator:e.Lang.isBoolean},className:{value:null,validator:e.Lang.isString},inputKeys:{value:!0,validator:e.Lang.isBoolean},keyDir:{value:[],readOnly:!0,validator:e.Lang.isArray},visible:{value:!1,readOnly:!0,validator:e.Lang.isBoolean},hidden:{value:!1,readOnly:!0,validator:e.Lang.isBoolean},xy:{value:null,validator:e.Lang.isArray},keyFiltering:{value:null},validator:{value:null}}}),e.DataTable.EditorOptions.inline={BaseViewClass:e.DataTable.BaseCellInlineEditor,name:"inline"},e.DataTable.EditorOptions.inlineNumber={BaseViewClass:e.DataTable.BaseCellInlineEditor,name:"inlineNumber",hideMouseLeave:!1,keyFiltering:/\.|\d|\-/,validator:/^\s*(\+|-)?((\d+(\.\d*)?)|(\.\d*))\s*$/,saveFn:function(e){var t=this.get("validator"),n;return t instanceof RegExp?n=t.test(e)?+e:undefined:n=+e,n}},e.DataTable.EditorOptions.inlineDate={BaseViewClass:e.DataTable.BaseCellInlineEditor,name:"inlineDate",dateFormat:"%D",keyFiltering:/\/|\d|\-/,prepFn:function(t){var n=this.get("dateFormat")||"%m/%d/%Y";return e.DataType.Date.format(t,{format:n})},saveFn:function(t){return e.DataType.Date.parse(t)||undefined}},e.DataTable.EditorOptions.inlineAC={BaseViewClass:e.DataTable.BaseCellInlineEditor,name:"inlineAC",hideMouseLeave:!1,after:{editorCreated:function(t){var n=t.inputNode,r=this.get("autocompleteConfig")||{},i=this;n&&e.Plugin.AutoComplete&&(r=e.merge(r,{alwaysShowList:!0,render:!0}),n.plug(e.Plugin.AutoComplete,r),n.ac.editor=i)}}}},"gallery-2013.01.16-21-05",{supersedes:[""],skinnable:"true",requires:["gallery-datatable-editable","view","base-build","event-mouseenter"],optional:[""]});
