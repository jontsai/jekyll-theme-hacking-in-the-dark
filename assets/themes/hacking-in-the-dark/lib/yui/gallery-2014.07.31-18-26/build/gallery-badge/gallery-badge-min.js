YUI.add("gallery-badge",function(e,t){var n=function(e){this._lazyAddAttrs=!1,e.node=e.host,n.superclass.constructor.call(this,e)};n.NAME="gallery-badge",n.NS="badge",n.ATTRS={node:{setter:function(t){return e.one(t)}},type:{value:"popular",setter:function(e){return e!=="user"&&this.set("username",""),e}},header:{value:"",getter:function(){var e="Popular Gallery Items";switch(this.get("type")){case"oncdn":e="Gallery Items on the CDN";break;case"featured":e="Featured Gallery Items";break;case"random":e="Random Gallery Item";break;case"user":e="My Gallery Items"}return e}},username:{value:"",setter:function(e){return e&&(this.set("header","My Gallery Items"),this._setStateVal("type","user")),e}},render:{value:!0},data:{value:{}}},e.extend(n,e.Base,{buildUI:function(t){this.set("data",t.data);if(t.data.error)return;var n=t.data,r=this.get("type"),i=e.Node.create("<h2>"+this.get("header")+"</h2>"),s=e.Node.create("<ul></ul>"),o=this.get("node");r!="random"?(r=="user"&&(i=e.Node.create('<h2><a href="http://yuilibrary.com/gallery/user/'+n.userinfo.username+'">'+n.userinfo.fullname+"'s Gallery Items</a></h2>")),e.each(n.modules,function(e){s.append('<li><a href="'+e.url+'">'+e.title+"</a></li>")})):s.append('<li><a href="'+n.modules.url+'">'+n.modules.title+"</a></li>"),o.set("innerHTML",""),o.append(i),o.append(s)},getSQL:function(){var e=this.get("type"),t;return e=="user"?t="select * from yui.gallery.user where (username = '"+this.get("username")+"')":t="select * from yui.gallery."+e,t},updateUserUI:function(e){e.newVal!==""&&this.updateUI()},updateUI:function(t){var n=this.getSQL(),r;r=new e.yql(n,e.bind(function(e){e.query&&e.query.results&&e.query.results.json&&this.fire("dataReturned",{data:e.query.results.json})},this),{env:"http://yuilibrary.com/yql/yui.env"})},initializer:function(){this.after("typeChange",e.bind(this.updateUI,this)),this.after("usernameChange",e.bind(this.updateUserUI,this)),this.publish("dataReturned",{type:"datareturned",defaultFn:this.buildUI}),this.get("render")&&this.render()},render:function(){this.updateUI()},refresh:function(){this.updateUI()},destructor:function(){this.get("node").set("innerHTML","")}}),e.namespace("Plugin"),e.Plugin.Badge=n},"gallery-2012.12.05-21-01",{requires:["node","event","gallery-yql","base"],supersedes:[],optional:[],skinnable:!1});
