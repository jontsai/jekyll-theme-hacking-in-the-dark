YUI.add("gallery-contextmenu-view",function(e,t){e.ContextMenuView=e.Base.create("contextmenu",e.View,[],{events:{".yui3-contextmenu-menuitem":{click:"_selectMenuItem"}},template:'<div class="yui3-contextmenu-overlay"></div>',templateMicro:'<div class="<%= this.menuClass %>"><% Y.Array.each( this.options, function(m,i){ %><div class="yui3-contextmenu-menuitem <%= this.menuItemClass %>" data-cmenu="<%= i %>"><%== (m[this.menuItemText]!==undefined) ? m[this.menuItemText] : m %></div><% },this); %></div>',_subscr:null,_overlayDX:5,_overlayDY:11,initializer:function(){var e=this.get("trigger").node,t=this.get("trigger").target;return this._subscr=[],this._subscr.push(e.delegate("contextmenu",this._onContextMenu,t,this),this.get("overlay").on("mouseleave",this.hideOverlay,this)),this},destructor:function(){e.Array.each(this._subscr,function(e){e&&e.detach&&e.detach()}),this._subscr=null,this._subscrTarget&&(this._subscrTarget.detach(),this._subscrTarget=null),this.get("overlay")&&(this.get("overlay").destroy({remove:!0}),this.set("overlay",null))},render:function(){return this},showOverlay:function(e){var t=this.get("offsetXY")||[this._overlayDX,this._overlayDY];this.get("overlay").set("xy",[e.pageX+t[0],e.pageY+t[1]]),this.get("overlay").show()},hideOverlay:function(){if(!this.get("overlay"))return;this.fire("contextMenuHide"),this.get("overlay").hide()},_valOverlay:function(){var t=this.get("container")||null,n,r;return t?(t.empty(),n=new e.Overlay({srcNode:t,visible:!1,zIndex:99,constrain:!0}),r=this._buildOverlayContent(),r&&n.set("bodyContent",r),n.render(),n):!1},_buildOverlayContent:function(){var t=this.get("menuTemplate"),n=t?e.merge(t):null,r=n?n.templateEngine:null,i=new e.Template(r),s=n?n.template||this.templateMicro:null,o=this.get("menuItemTemplate"),u=this.get("menuItems")||null,a,f;return!n&&o&&u?(a="",e.Array.each(u,function(t,n){f=e.Lang.sub(o,{menuClass:t.className||"yui3-contextmenu-menuitem",menuIndex:n,menuContent:e.Lang.isString(t)?t:t.label||"unknown"}),a+=f})):(delete n.templateEngine,delete n.template,n.options=n.options||n.menuItems||u,!u&&n.options&&this._set("menuItems",n.options),n.menuClass=n.menuClass||"yui3-contextmenu-menu",n.menuItemClass=n.menuItemClass||"",n.menuItemText=n.menuItemText||"label",a=i.render(s,n)),a},_onContextMenu:function(e){e.preventDefault(),this._clearDOMSelection();var t=e.currentTarget;this._set("contextTarget",t),this.showOverlay(e),this.fire("contextMenuShow",e)},_selectMenuItem:function(e){var t=e.target,n=+t.getData("cmenu"),r=this.get("menuItems");r&&r.length>0&&this._set("selectedMenu",{evt:e,menuItem:r[n],menuIndex:n}),this.hideOverlay(),this.fire("contextMenuHide",e),this.fire("select",e)},_clearDOMSelection:function(){var t=e.config.win.getSelection?e.config.win.getSelection():e.config.doc.selection?e.config.doc.selection:null;t&&t.empty&&t.empty(),t&&t.removeAllRanges&&t.removeAllRanges()}},{ATTRS:{container:{valueFn:function(){return e.Node.create(this.template)}},trigger:{value:{node:null,target:""},writeOnce:!0},contextTarget:{value:null,readOnly:!0},menuItemTemplate:{value:'<div class="yui3-contextmenu-menuitem {menuClass}" data-cmenu="{menuIndex}">{menuContent}</div>'},menuItems:{value:null,validator:e.Lang.isArray},menuTemplate:{valueFn:function(){return this.templateMicro}},overlay:{valueFn:"_valOverlay",writeOnce:!0,validator:function(t){return t instanceof e.Overlay}},offsetXY:{value:[5,11],validator:e.Lang.isArray},selectedMenu:{value:null,readOnly:!0}}})},"gallery-2013.01.23-21-59",{skinnable:"true",requires:["base-build","view","overlay","event-mouseenter","template"]});
