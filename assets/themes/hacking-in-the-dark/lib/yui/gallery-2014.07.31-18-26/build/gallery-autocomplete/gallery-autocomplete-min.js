YUI.add("gallery-ac-plugin",function(C){function E(){E.superclass.constructor.apply(this,arguments);}var B="autocomplete",K=C.Lang,D=C.Array.each,F={query:function(P){var L=this,O=L.get("dataSource"),N=P.value,M=C.bind(G,L);if(O){O.sendRequest({request:L.get("queryTemplate")(N),callback:{success:M,failure:M}});}}};C.Plugin.ACPlugin=C.extend(E,C.Plugin.Base,{initializer:function(){var L=this,M=L.get("host");I(L,M);var N=F;D(["query","load","show","hide","next","previous"],function(O){L.publish("ac:"+O,{broadcast:1,bubbles:1,context:L,preventable:true,defaultFn:N[O]||null,prefix:"ac"});},L);J(M);},destructor:function(){C.detach(C.stamp(this)+"|");},open:function(){this.fire("ac:show");},next:function(L){L.preventDefault();this.fire("ac:next");},previous:function(L){L.preventDefault();this.fire("ac:previous");},close:function(){this.fire("ac:hide");}},{NAME:"ACPlugin",NS:"ac",ATTRS:{queryValue:{getter:function(){return this.get("host").get("value");},setter:function(L){this.get("host").set("value",L);return(this._cachedValue=L);}},dataSource:{validator:function(L){return L&&K.isFunction(L.sendRequest);}},minQueryLength:{value:3,validator:K.isNumber},queryTemplate:{value:encodeURIComponent,setter:function(L){return(K.isFunction(L)?L:function(M){return L.replace(/(^|[^\\])((\\{2})*)\{query\}/,"$1$2"+encodeURIComponent(M)).replace(/(^|[^\\])((\\{2})*)\\(\{query\})/,"$1$2$4");});}}}});function I(L,N){var M=C.stamp(this)+"|";C.on(M+"valueChange",H,N,L);C.on(M+"key",L.next,N,"down:40",L);C.on(M+"key",L.previous,N,"down:38",L);C.on(M+"key",L.close,N,"down:27",L);}function H(M){var L=M.value;if(!L){return this.close();}if(L===this._cachedValue||L.length<this.get("minQueryLength")){return;}this._cachedValue=L;this.fire("ac:query",{value:M.value});}function A(L){return function(){if(L){L.setAttribute(B,"on");}L=null;};}function J(L){var N=C.Node.getDOMNode(L),O=N.getAttribute(B);if((O&&O!=="off")||O===null||O===undefined){var M=A(N);C.on("beforeunload",M,window);C.on("unload",M,window);}N.setAttribute(B,"off");}function G(M){var L=(M&&M.response&&M.response.results)?M.response.results:M;if(L&&!(L&&("length" in L)&&L.length===0)){this.fire("ac:load",{results:L,query:this.get("queryValue")});}}},"gallery-2010.01.27-20",{requires:["node","plugin","gallery-value-change","event-key"],optional:["event-custom"]});YUI.add("gallery-ac-widget",function(B){function D(){D.superclass.constructor.apply(this,arguments);}var A="_bound",E="selectedIndex",I="_selectedIndex",G="_originalValue",C=B.Array.each,F="queryValue";B.ACWidget=B.extend(D,B.Widget,{initializer:function(){var J=this;J.after({queryChanged:J.syncUI,dataChanged:J.syncUI});J.hide();},renderUI:function(){var J=this.get("ac");if(!J){return;}J.get("host").insert(this.get("boundingBox"),"after");this.setSize();return;},setSize:function(){return this.set("width",this.get("ac").get("host").getComputedStyle("width"));},bindUI:function(M){var N=this,J=N.get("contentBox"),L=N.get("ac"),K=B.stamp(N)+"|";if(M&&L!==M&&N[A]){B.detach(K);N[A]=0;}M=M||L;if(M&&!N[A]){N[A]=1;J.delegate(K+"click",N.click,"li",N);B.on(K+"click",N.hide,document);M.on(K+"ac:load",function(O){N.setAttrs({query:O.query,data:O.results}).syncUI().show();});M.on(K+"ac:query",function(O){N.set("query",O.value).syncUI();});M.on(K+"ac:next",N.next,N);M.on(K+"ac:previous",N.previous,N);M.on(K+"ac:hide",N.hide,N);}return N;},syncUI:function(){var J=this,L=J.get("data"),K=J.get("query");if(!L){return J;}J[I]=-1;J[G]="";J.get("contentBox").set("content",J.getListMarkup(L));return J;},getListMarkup:function(M){var L=this,J=L.get("listTpl"),K=[];C(M,function(N){K.push(L.getItemMarkup(N));});return J.replace(/\{list\}/g,K.join(""));},getItemMarkup:function(J){return this.get("itemTpl").replace(/\{term\}/g,J).replace(/\{hilite\}/g,this.getHiliteMarkup(J));},getHiliteMarkup:function(M){var K=this,J=H(K.get("query")).split(/\s+/);out=M;var L=new RegExp("("+J.join("|")+")","g"),N=K.get("hiliteTpl").replace(/\$/g,"\\$").replace(/\{term\}/g,"$1");return out.replace(L,N);},next:function(){var J=this;return(J.get("visible")?J.selectNext():J.get("data")?J.show():J);},selectNext:function(){return this.set(E,this.get(E)+1);},selectPrevious:function(){return this.set(E,this.get(E)-1);},previous:function(){return this.get("visible")?this.selectPrevious():this;},item:function(J){return this.get("contentBox").one(this.get("itemSelector").replace(/\{n\}/g,H(J+1)));},click:function(L){var J=this,K=J.get("ac"),M=L.currentTarget.get("text");K.set(F,M);J[I]=-1;J._currentValue=M;K.get("host").focus();J.hide();}},{NAME:"ACWidget",ATTRS:{ac:{setter:function(J){if(!this[A]){return;}this.bindUI(J);},validator:function(J){return true;}},data:{validator:function(J){return J&&J.length>0;}},query:{value:""},listTpl:{value:"<ul>{list}</ul>"},itemTpl:{value:"<li>{hilite}</li>"},itemSelector:{value:"ul li:nth-child({n})"},hiliteTpl:{value:"<em>{term}</em>"}}});D.ATTRS[E]={value:-1,validator:function(J){var K=this.get("data");return K&&B.Lang.isNumber(J);},getter:function(){return this[I];},setter:function(L){var Q=this,N=Q.get(E),O=Q.get("data"),J=O&&O.length,P=Q.get("ac"),K=this.getClassName("selected");if(isNaN(N)){N=-1;}if(!O||!J){return;}while(L<-1){L+=J+1;}L=(L+1)%(J+1)-1;N=(N+1)%(J+1)-1;Q[I]=L;if(N===-1){Q[G]=P.get(F);}if(N===L){return;}var R=Q.get("contentBox").one("."+K);if(R){R.removeClass(K);}if(L===-1){P.set(F,this[G]);}else{var M=Q.item(L);if(M){M.addClass(K);}P.set(F,O[L]);}return L;}};function H(J){return(""+J).replace(/([\^\/.*+?|()[\]{}\\])/g,"\\$1");}},"gallery-2010.01.27-20",{requires:["widget","gallery-ac-plugin"]});YUI.add("gallery-autocomplete",function(A){},"gallery-2010.01.27-20",{use:["gallery-ac-plugin"]});