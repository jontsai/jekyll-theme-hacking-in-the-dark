YUI.add("gallery-composite-image",function(e,t){(function(e){"use strict";var t="f32",n="f64",r="number",i="s16",s="s32",o="s8",u="u16",a="u32",f="u8",l=!0,c=ArrayBuffer,h=DataView,p=e.Lang,d=Object,v=e.Array,m=e.cached,g=d.defineProperties,y=v.each,b=v.flatten,w=d.freeze,E=p.isArray,S=v.map,x=v.reduce,T=function(){this._init.apply(this,arguments)};e.namespace("Composite").Image=e.mix(T,{dataTypes:{f32:t,f64:n,s16:i,s32:s,s8:o,u16:u,u32:a,u8:f},defaultChannels:[f,f,f,f],defaultDimensions:[512,512],prototype:{clear:function(){var e=this;return e._data=new c(e.pixelCount*e._pixelSize),e},clone:function(){var e=this;return new T({channels:e.channels,data:e._data.slice(0),dimensions:e.dimensions,littleEndian:e._littleEndian})},eachPixelIndex:function(e){var t=this,n=t.pixelCount,r=0;for(;r<n;r+=1)e(r,t);return t},eachPixelLocation:function(e){var t=this,n=t.dimensions,r=n.length,i=0,s=t.pixelCount,o=0,u=[];for(;i<r;i+=1)u[i]=0;for(;o<s;o+=1){e(u.slice(),o,t);for(i=0;i<r;i+=1){u[i]+=1;if(u[i]<n[i])break;u[i]=0}}return t},getDataArray:function(){var e=this,t=e._dataView;return t instanceof h?function(){var t=e.channels.length,n=[];return e.eachPixelIndex(function(r){for(var i=0;i<t;i+=1)n.push(e._getValue(r,i))}),n}():v(t)},getPixelIndex:function(){return this._getPixelIndex.apply(this,b(arguments))},getPixelValues:function(e,t){var n=this;return S(t||n.channels,t?function(t){return n.getValue(e,t)}:function(t,r){return n.getValue(e,r)})},getValue:function(e,t){return this._getValue(typeof e===r?e:this.getPixelIndex(e),t)},setDataArray:function(e){var t=this,n=t.channels.length,r=0;return t.eachPixelIndex(function(i){for(var s=0;s<n;s+=1)t._setValue(i,s,e[r]),r+=1})},setPixelValues:function(e,t,n){var r=this;return y(n||t,n?function(n,i){r.setValue(e,n,t[i])}:function(t,n){r.setValue(e,n,t)}),r},setValue:function(e,t,n){return this._setValue(typeof e===r?e:this.getPixelIndex(e),t,n)},toJSON:function(){var e=this,t=e._littleEndian,n={channels:e.channels,data:e.getDataArray(),dimensions:e.dimensions};return t&&(n.littleEndian=t),n},toString:function(){return"image["+this.dimensions.join("x")+"] "+this.channels},validate:function(e){return e=e||this._data,e instanceof c&&e.byteLength===this.pixelCount*this._pixelSize},_init:function(e){e=e||{};var t=this,n=w((e.channels||T.defaultChannels).slice()),r=[],i,s=w((e.dimensions||T.defaultDimensions).slice()),o=x(s,1,function(e,t){return e*t}),u=x(n,0,function(e,t){return r.push(e),!i&&i!==null?i=t:i&&i!==t&&(i=null),e+ +t.substr(1)/8}),a=e.data,f;g(t,{channels:{enumerable:l,value:n},dimensions:{enumerable:l,value:s},pixelCount:{enumberable:l,value:o},_channelOffsets:{enumerable:l,value:w(r)},_data:{enumerable:l,get:function(){return f},set:function(e){f=e,t._dataView=T._getDataView(f,i)}},_dataType:{enumerable:l,value:i},_pixelSize:{enumerable:l,value:u}}),t._getPixelIndex=T._getGetPixelIndexMethod.apply(t,s),t._getValue=T._getGetValueMethod(r,u,i),t._setValue=T._getSetValueMethod(r,u,i),t.validate(a)?t._data=a:(t.clear(),E(a)&&t.setDataArray(a)),t._littleEndian=!!e.littleEndian}},_getDataView:function(e,t){return new(T._getDataViewConstructor(t))(e)},_getDataViewConstructor:m(function(e){switch(e){case t:return Float32Array;case n:return Float64Array;case i:return Int16Array;case s:return Int32Array;case o:return Int8Array;case u:return Uint16Array;case a:return Uint32Array;case f:return Uint8ClampedArray}return h}),_getGetPixelIndexMethod:m(function(){var e=arguments,t=e.length;return m(function(){var n=arguments,r,i=0,s,o;for(r=0;r<t;r+=1){o=n[r];for(s=r-1;s>=0;s-=1)o*=e[s];i+=o}return i})}),_getGetValueMethod:m(function(e,t,n){var r=e.length;return n?function(e,t){return this._dataView[e*r+t]}:function(n,r){return this._dataView["get"+T._getTypeName(this.channels[r])](n*t+e[r],this.littleEndian)}}),_getSetValueMethod:m(function(e,t,n){var r=e.length;return n?function(e,t,n){return this._dataView[e*r+t]=n,this}:function(n,r,i){var s=this;return s._dataView["set"+T._getTypeName(s.channels[r])](n*t+e[r],i,s.littleEndian),s}}),_getTypeName:m(function(e){var t=e.charAt(0);return(t==="f"?"Float":t==="s"?"Int":"Uint")+e.substr(1)})},l)})(e)},"gallery-2013.05.29-23-38",{requires:["array-extras"]});
