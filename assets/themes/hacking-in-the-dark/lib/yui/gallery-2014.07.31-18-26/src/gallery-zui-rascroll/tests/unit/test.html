<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable = no">
 <meta name="apple-mobile-web-app-capable" content="yes">
 <meta name="apple-mobile-web-app-status-bar-style" content="black">
 <meta name="format-detection" content="telephone=no">
 <title>Test ZUI RAScroll</title>
</head>
<body class="yui3-skin-sam">
<div id="scroll1">
 <div>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  <div id="scroll2">
   <div style="width:1000px">
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
   </div>
  </div>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  <div id="scroll3">
   <div style="width:1000px">
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
    test content with a b c d e f g h i j k l m n o p q r s t u v w x y z
   </div>
  </div>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
  test content with a b c d e f g h i j k l</br>
 </div>
</div>
</body>
<script src="/build/yui/yui-debug.js"></script>
<script>
YUI({
    coverage: ['gallery-zui-rascroll'],
    filter: (window.location.search.match(/[?&]filter=([^&]+)/) || [])[1] || 'raw'
}).use('test', 'node-event-simulate', 'gallery-zui-rascroll', function (Y) {
    var scroll3 = new Y.ScrollView({srcNode: '#scroll3', width:300, render: true}),
        scroll2 = new Y.ScrollView({srcNode: '#scroll2', width:300, render: true}),
        scroll1 = new Y.ScrollView({srcNode: '#scroll1', height: 400, width: 300, render: true}),
        testSuite = new Y.Test.Suite('ZUI rascroll'),
        dragTime = 100,
        testDelay = 500,

        doDrag = function (dxy, ms, scroll) {
            var node = scroll.get('contentBox'),
                xy = [10, 10],
                d, x, y;

            node.simulate('mousedown', {clientX: xy[0], clientY: xy[1]});
            x = xy[0];
            y = xy[1];
            for (d in dxy) {
                x = x + dxy[d][0];
                y = y + dxy[d][1];
                node.simulate('mousemove', {clientX: x, clientY: y});
            }
            Y.later(ms, null, function () {
                node.simulate('mouseup', {clientX: x, clientY: y});
            });
        },

        testDrag = function (test, dxy, scr, moved) {
            var sx = scr.get('scrollX'),
                sy = scr.get('scrollY');

            if (Y.UA.phantomjs) {
                return;
            }

            doDrag(dxy, dragTime, scr);

            test.wait(function () {
                if (moved) {
                    Y.Assert.isTrue((sx != scr.get('scrollX')) || (sy != scr.get('scrollY')));
                } else {
                    Y.Assert.areSame(sx, scr.get('scrollX'));
                    Y.Assert.areSame(sy, scr.get('scrollY'));
                }
            }, testDelay);
        };

    scroll1.plug(Y.zui.RAScroll, {horizontal: false, cooperation: true});
    scroll2.plug(Y.zui.RAScroll);
    scroll3.plug(Y.zui.RAScroll);

    testSuite.add(new Y.Test.Case({
        name: 'Test Vertical Scroll',

        testScroll1Down: function () {
            testDrag(this, [[0, 10]], scroll1);
        },

        testScroll1Up: function () {
            testDrag(this, [[0, -10]], scroll1, true);
        },

        testScroll2Down: function () {
            testDrag(this, [[0, 10]], scroll2);
        },

        testScroll2Up: function () {
            testDrag(this, [[0, -10]], scroll2);
        },

        testScroll3Down: function () {
            testDrag(this, [[0, 10]], scroll3);
        },

        testScroll3Up: function () {
            testDrag(this, [[0, -10]], scroll3);
        }
    }));

    testSuite.add(new Y.Test.Case({
        name: 'Test Horizontal Scroll',

        testScroll1Left: function () {
            testDrag(this, [[-10, 0]], scroll1);
        },

        testScroll1Right: function () {
            testDrag(this, [[10, 0]], scroll1);
        },

        testScroll2Left: function () {
            testDrag(this, [[-10, 0]], scroll2, true);
        },

        testScroll2Right: function () {
            testDrag(this, [[10, 0]], scroll2, true);
        },

        testScroll3Left: function () {
            testDrag(this, [[-10, 0]], scroll3, true);
        },

        testScroll3Right: function () {
            testDrag(this, [[10, 0]], scroll3, true);
        }
    }));

    testSuite.add(new Y.Test.Case({
        name: 'Test oblique move on V Scroll',

        testScroll1UL: function () {
            testDrag(this, [[-5, -10]], scroll1, true);
        },

        testScroll1LU: function () {
            testDrag(this, [[-10, -5]], scroll1);
        },

        testScroll1UR: function () {
            testDrag(this, [[5, -10]], scroll1, true);
        },

        testScroll1RU: function () {
            testDrag(this, [[10, -5]], scroll1);
        },

        testScroll1DL: function () {
            testDrag(this, [[-5, 10]], scroll1, true);
        },

        testScroll1LD: function () {
            testDrag(this, [[-10, 5]], scroll1);
        },

        testScroll1DR: function () {
            testDrag(this, [[5, 10]], scroll1, true);
        },

        testScroll1RD: function () {
            testDrag(this, [[10, 5]], scroll1);
        }
    }));

    testSuite.add(new Y.Test.Case({
        name: 'Test oblique move on H Scroll',

        testScroll1UL: function () {
            testDrag(this, [[-5, -10]], scroll2);
        },

        testScroll1LU: function () {
            testDrag(this, [[-10, -5]], scroll2, true);
        },

        testScroll1UR: function () {
            testDrag(this, [[5, -10]], scroll2);
        },

        testScroll1RU: function () {
            testDrag(this, [[10, -5]], scroll2, true);
        },

        testScroll1DL: function () {
            testDrag(this, [[-5, 10]], scroll2);
        },

        testScroll1LD: function () {
            testDrag(this, [[-10, 5]], scroll2, true);
        },

        testScroll1DR: function () {
            testDrag(this, [[5, 10]], scroll2);
        },

        testScroll1RD: function () {
            testDrag(this, [[10, 5]], scroll2, true);
        }
    }));

    testSuite.add(new Y.Test.Case({
        name: 'Test free move and H/V lock',

        testScroll1VFree: function () {
            testDrag(this, [[0, -10], [10, 0]], scroll1, true);
        },

        testScroll1HLock: function () {
            testDrag(this, [[10, 0], [0, -10]], scroll1);
        },

        testScroll2VLock: function () {
            testDrag(this, [[0, -10], [-10, 0]], scroll2);
        },

        testScroll2HFree: function () {
            testDrag(this, [[-10, 0], [0, -10]], scroll2, true);
        }

    }));

    Y.Test.Runner.add(testSuite);
    Y.Test.Runner.run();
});
</script>
</html>
